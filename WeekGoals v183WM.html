<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=95vw; max-width: 950px;">
    <title>Week Goals</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.4.0/docx.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 200vh;
            background-color: #f0f0f0;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }

        table {
            border-collapse: collapse;
            width: 95vw;
            max-width: 950px;
            margin-top: 20px;
        }

        td {
            border: 1px solid #ccc;
            background-color: white;
            text-align: left;
            vertical-align: top;
            padding: 20px;
            resize: both;
            overflow: auto;
            width: 200px;
            height: 230px;
            cursor: text;
            font-size: 1.0em;
            line-height: 1.2;
        }

        table h3 {
            font-weight: bold;
            font-size: 1.2em;
            margin: 0;
        }

        #toolbar, #secondary-toolbar, #bottom-toolbar {
            margin-bottom: 10px;
            width: 95vw;
            max-width: 950px;
            text-align: center;
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            align-items: center;
            justify-content: center;
        }

        button {
            margin-right: 5px;
            padding: 5px 5px;
            border: none;
            background-color: #007BFF;
            color: white;
            font-size: 12px;
            cursor: pointer;
            border-radius: 2px;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #0056b3;
        }

        .custom-bullet-list {
            padding-left: 20px;
        }

        .custom-bullet-list li {
            margin-bottom: 0px;
        }

        #contextMenu {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.1s ease, transform 0.1s ease;
        }

        .options-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.1s ease, transform 0.1s ease;
        }

        .options-menu button {
            display: block;
            background: white;
            color: black;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            text-align: left;
            width: 100%;
            font-size: 14px;
        }

        .options-menu button:hover {
            background-color: #007BFF;
            color: white;
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            width: auto;
            min-width: 130px;
            box-shadow: 1px 1px 2px 0px rgba(0,0,0,0.1);
            z-index: 1000;
            margin-top: 2px;
            padding: 5px;
            text-align: center;
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .dropdown-content.show {
            display: block;
            opacity: 1;
            transform: scale(1);
        }

        .dropdown-content iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        .dropdown-content button {
            display: block;
            width: 100%;
            background-color: #8B4513;
            color: white;
            padding: 5px;
            margin: 2px 0;
            text-align: left;
            border-radius: 3px;
            font-size: 12px;
        }

        .dropdown-content button:hover {
            background-color: #6B3A0F;
        }

        #sidebar {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100%;
            background-color: #fff;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.3);
            transition: right 0.3s ease;
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #sidebar.open {
            right: 0;
        }

        #sidebar h3 {
            margin-top: 0;
            font-size: 1.2em;
        }

        #sidebar iframe {
            width: 100%;
            height: 80%;
            border: none;
            margin-bottom: 10px;
        }

        #sidebar .notes-area {
            width: 100%;
            height: 20%;
            border: 1px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            background-color: #f9f9f9;
        }

        #sidebar-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff4444;
            padding: 5px 10px;
        }

        #tablesContainer, #pageTitle {
            width: 95vw;
            max-width: 950px;
        }

        .separator {
            color: #666;
            margin: 0 2px;
            font-size: 12px;
        }

        button.gray {
            background-color: #6c757d;
        }

        button.gray:hover {
            background-color: #5a6268;
        }

.cell-action-button {
    float: right;
    color: white;
    font-size: 12px;
    padding: 2px 5px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
    margin-left: 5px;
}

.cell-action-button:hover {
    opacity: 0.9;
}

    </style>
</head>
<body>

<h2 id="pageTitle" contenteditable="true">WeekGoals-0423Weekxx(Sxx)</h2>

<div id="toolbar">
    <!-- Utility -->
    <button onclick="insertTimestamp()">+Time</button>
    <button onclick="openWin3('https://yangwm2005.github.io/p/WeekGoals v183WM.html')" style="background-color:green;" title="New blank window for next week.">New WeekGoals</button>
    <!-- Office Starting Dropdown -->
    <div class="dropdown">
        <button class="btn btn-blue dropdown-toggle" style="background-color:#8B4513;width:40px;white-space:nowrap;" title="Office Starting">O ▼</button>
        <div class="dropdown-content">
            <button onclick="openWindow('https://yangwm2005.github.io/p/self-chat v209T8b.html', 1050, 600)" title="Keep the progress">1. Self-chat</button>
            <button onclick="openWindow('https://yangwm2005.github.io/p/preview v183.html', 1050, 600)" title="Organize your file in a folder with quick view">2. Timer on/folder</button>
            <button onclick="openWindow('https://yangwm2005.github.io/p/TreeWM v215h.html', 1050, 600)" title="Tree organization system to make life structure in thinking">3. Daily-Goals</button>
            <button onclick="openWindow('https://yangwm2005.github.io/p/2frame-selfchat.html', 1050, 600)" title="Tree organization system to make life structure in thinking">4. Tea making</button>
            <button onclick="openWindow('https://yangwm2005.github.io/p/2frame-selfchat.html', 1050, 600)" title="Tree organization system to make life structure in thinking">5. Inboxes</button>
            <button onclick="openWindow('https://yangwm2005.github.io/p/Bullet-2f v1.html', 1050, 600)" title="Quick add and access the information to Inbox New">6. BulletJoural</button>
            <button onclick="openWindow('https://tasksboard.com/app', 1050, 600)" title="Quick add and access the information to Inbox New">7. TaskBoards</button>
            <button onclick="openWindow('https://app.any.do/tasks/next-seven-days', 1050, 600)" title="Daily Mind setting determining">8. Any.Do</button>
            <button onclick="openWindow('https://yangwm2005.github.io/p/dynalist-m232.html', 1050, 600)" title="Quick add and access the information to Inbox New">9. Unclutter</button>
        </div>
    </div>
    <!-- Quick Access Dropdowns -->
    <div class="dropdown">
        <button class="btn btn-blue dropdown-toggle" style="background-color:#8B4513;width:30px;white-space:nowrap;" title="Class teaching quick short cuts">Q▼</button>
        <div class="dropdown-content">
            <iframe src="https://yangwm2005.github.io/p/q-desk.html" frameborder="0" scrolling="yes"></iframe>
        </div>
    </div>
    <div class="dropdown">
        <button class="btn btn-blue dropdown-toggle" style="background-color:#8B4513;width:30px;white-space:nowrap;" title="Class teaching quick short cuts">C▼</button>
        <div class="dropdown-content">
            <iframe src="https://yangwm2005.github.io/p/class-quick.html" frameborder="0" scrolling="yes"></iframe>
        </div>
    </div>
    <div class="dropdown">
        <button class="btn btn-blue dropdown-toggle" style="background-color:#8B4513;width:30px;white-space:nowrap;" title="Quick Inbox enter">I▼</button>
        <div class="dropdown-content">
            <iframe src="https://yangwm2005.github.io/p/inbox-q.html" frameborder="0" scrolling="yes"></iframe>
        </div>
    </div>

    <span class="separator">|</span>
    <!-- Text Formatting -->
    <button onclick="document.execCommand('bold')">Bold</button>
    <button onclick="document.execCommand('italic')">Italic</button>
    <button onclick="document.execCommand('underline')">Underline</button>
    <button onclick="document.execCommand('strikethrough')" style="background-color:green;">Strike</button>
    <button onclick="insertBulletPoint()" style="background-color:green;">• Bullet</button>
    <button onclick="document.execCommand('insertUnorderedList')">Bullet-List</button>
    <button onclick="insertSubBullet()">Sub</button>
    <button onclick="insertCheckbox()" style="background-color:green;">Checkbox</button>
    <button onclick="document.execCommand('insertOrderedList')">1.2.3...</button>
    <button onclick="insertChecklist()">Checklist</button>
    <button onclick="document.execCommand('insertHorizontalRule')">HR</button>
    <span class="separator">|</span>
    <!-- Table Management -->
    <button onclick="addNewTable()">Add New Table</button>
    <button onclick="addReview()" style="background-color:green;">Add Review</button>
    <span class="separator">|</span>
    <!-- File Operations -->
    <button id="saveButton" onclick="saveFile()" style="background-color:purple;">Save</button>
    <button id="openButton" onclick="openFile()" class="gray">Open</button>
    <button id="printButton" onclick="printContent()" class="gray">Print</button>
    <span class="separator">|</span>
    <!-- Tools Dropdown -->
    <div class="dropdown">
        <button class="btn btn-blue dropdown-toggle" style="background-color:#8B4513;" title="Tools and Resources">Tools ▼</button>
        <div class="dropdown-content">
            <button onclick="openWindow('https://yangwm2005.github.io/p/self-chat v209T8b.html', 800, 600)" title="Self-Chat to organize the thoughts and ideas!">Chat</button>
            <button onclick="openWin3('https://yangwm2005.github.io/p/Dynalist-wkgoals.html')" title="SOP system to follow">DN-WeekGoals</button>
            -- Inboxes --
            <button onclick="openWin3('https://yangwm2005.github.io/p/Bullet-2f v1.html')" title="More todo reminder">Bullet-classic</button>
            <button onclick="openWin3('https://tasksboard.com/app')" title="More todo reminder">gTasks</button>
            <button onclick="openWin3('https://www.twobird.com/inbox')" title="More todo reminder">TwoBird</button>
            -- Notes --
            <button onclick="openWin3('https://app.upbase.io/')" title="More todo reminder">Upbase</button>
            <button onclick="openWin3('https://dayone.me/')" title="Progress and idea checking">DayOne</button>
            <button onclick="openWin3('https://www.remnote.com/')" title="Keep good in this Daily system">RemNote</button>
            <button onclick="openWin3('https://app.capacities.io/e5ae7243-9fcc-4448-85d1-dd6b2f8ff516')" title="Keep good in this Daily system">Capacities</button>
            <button onclick="openWin3('https://quiro.io')" title="Tracking and record here.">Quiro</button>
            <button onclick="openWin3('https://www.messenger.com/c/562747265686808/t/9442275295796092')" title="Keep records in the flash collections">DayNotes-Mesg</button>
            <button onclick="openWin3('https://www.messenger.com/c/562747265686808/t/26832981966316736')" title="Keep records in the flash collections">Freelances-Mesg</button>
            <button onclick="openWin3('https://www.messenger.com/c/562747265686808/t/5729255993817306')" title="Keep records in the flash collections">WeekNotes-Mesg</button>
            <button onclick="openWin3('https://timestripe.com/horizons/')" title="Make up the plan">Timestripe</button>
        </div>
    </div>
    <span class="separator">|</span>
    <!-- Sidebar -->
    <button onclick="toggleSidebar()" style="background-color:#ff9900;color:blue;">Sidebar</button>
</div>

<div id="tablesContainer">
    <table id="mainTable">
        <tr>
            <td contenteditable="true">
                <h3>Week Due
                 <button onclick="insertCheckboxInCell(this)" class="cell-action-button" style="background-color:#4CAF50;">+✓</button>             
                </h3><br><div><input type="checkbox" style="margin-right: 5px;"></div>
            </td>
            <td contenteditable="true">
                <h3>Projects
                 <button onclick="insertCheckboxInCell(this)" class="cell-action-button" style="background-color:#4CAF50;">+✓</button>             
                </h3><br><div><input type="checkbox" style="margin-right: 5px;"></div>
            </td>
        </tr>
        <tr>
            <td contenteditable="true">
                <h3>Social&Class
                <button onclick="insertCheckboxInCell(this)" class="cell-action-button" style="background-color:#4CAF50;">+✓</button>             
                </h3><br><div><input type="checkbox" style="margin-right: 5px;"></div>
            </td>
            <td contenteditable="true">
                <h3>Chance&Remind&Inbox
                <button onclick="insertCheckboxInCell(this)" class="cell-action-button" style="background-color:#4CAF50;">+✓</button>             
                </h3><br><div><input type="checkbox" style="margin-right: 5px;"></div>
            </td>
        </tr>
    </table>

    <div id="secondary-toolbar">
        <!-- Formatting -->
        <button onclick="insertTimestamp()">+Time</button>
        <button onclick="document.execCommand('bold')">Bold</button>
        <button onclick="document.execCommand('italic')">Italic</button>
        <button onclick="document.execCommand('underline')">Underline</button>
        <button onclick="document.execCommand('strikethrough')" style="background-color:green;">strike</button>
        <button onclick="document.execCommand('insertHorizontalRule')">HR</button>
        <button onclick="insertBulletPoint()" style="background-color:green;">• Bullet</button>
        <button onclick="document.execCommand('insertUnorderedList')">Bullet-List</button>
        <button onclick="insertSubBullet()">Sub</button>
        <button onclick="insertCheckbox()" style="background-color:green;">Checkbox</button>
        <button onclick="document.execCommand('insertOrderedList')">1.2.3...</button>
        <button onclick="insertChecklist()">Checklist</button>
        <span class="separator">|</span>
        <!-- File Operations -->
        <button id="saveButton" onclick="saveFile()" style="background-color:purple;">Save as File</button>
        <button id="openButton" onclick="openFile()" class="gray">Open File</button>
        <button id="printButton" onclick="printContent()" class="gray">Print</button>
        <span class="separator">|</span>
        <!-- Tools -->
        <button onclick="openWin3('https://www.messenger.com/c/562747265686808/t/9442275295796092')" style="background-color:#8B4513;" title="Keep records in the flash collections">DayNotes-Mesg</button>
        <button onclick="openWin3('https://timestripe.com/horizons/')" style="background-color:#8B4513;" title="Make up the plan">Timestripe</button>
    </div>

    <table>
        <tr>
            <td contenteditable="true">
                <h3>2nd life</h3><div><ul class="custom-bullet-list"><li></li></ul></div>
            </td>
            <td contenteditable="true">
                <h3>Month Goals</h3><div><ul class="custom-bullet-list"><li></li></ul></div>
            </td>
        </tr>
    </table>
</div>

<div id="bottom-toolbar">
    <button onclick="addNewTable()">Add New Table</button>
    <button onclick="addReview()" style="background-color:green;">Add Review</button>
</div>

<!-- Sidebar -->
<div id="sidebar">
    <h3>Sidebar</h3>
    <iframe src="https://yangwm2005.github.io/p/self-chat v209T7b.html" title="Embedded Website"></iframe>
    <div contenteditable="true" class="notes-area">Notes</div>
    <button id="sidebar-close" onclick="toggleSidebar()">Close</button>
</div>

<!-- Context Menu -->
<div id="contextMenu" class="options-menu">
    <button onclick="applyFormat('bold')">Bold</button>
    <button onclick="applyFormat('copy')">Copy</button>
    <button onclick="applyFormat('paste')">Paste</button>
    <button onclick="applyFormat('strikeThrough')">Strikeout</button>
</div>

<script>
    window.addEventListener("beforeunload", function(e) {
        e.preventDefault();
        e.returnValue = "";
    });

    let menu = null;
    let placeholder = null;

    function openWin(url) {
        window.open(url, "_blank", "width=600, height=600, toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes");
    }

    function openWin3(url) {
        window.open(url, "_blank", "width=1100, height=700, screenX=200,screenY=80, toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes");
    }

    function openWindow(url, width, height) {
        window.open(url, "_blank", `width=${width}, height=${height}, toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes`);
    }

    function insertTimestamp() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const timestamp = `${hours}:${minutes} `;
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();
            range.insertNode(document.createTextNode(timestamp));
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

function printContent() {
    const pageTitle = document.getElementById('pageTitle').innerText.trim();
    const tables = document.querySelectorAll('#tablesContainer table');

    let maxColumns = 0;
    tables.forEach(table => {
        table.querySelectorAll('tr').forEach(row => {
            const columns = row.querySelectorAll('td').length;
            maxColumns = Math.max(maxColumns, columns);
        });
    });

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <html>
        <head>
            <title>${pageTitle}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                h2 { text-align: center; }
                table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                td { border: 1px solid #ccc; padding: 10px; vertical-align: top; width: ${100 / maxColumns}%; }
                /* Hide buttons in print output */
                .cell-action-button { display: none !important; }
                /* Style checkboxes for print */
                input[type="checkbox"] { 
                    -webkit-appearance: checkbox !important;
                    appearance: checkbox !important;
                    width: 13px;
                    height: 13px;
                }
            </style>
        </head>
        <body>
            <h2>${pageTitle}</h2>
    `);

    tables.forEach(table => {
        const rows = table.querySelectorAll('tr');
        printWindow.document.write('<table>');
        rows.forEach(row => {
            printWindow.document.write('<tr>');
            row.querySelectorAll('td').forEach(cell => {
                // Clone the cell to modify it without affecting the original
                const cellClone = cell.cloneNode(true);
                // Remove all buttons from the cloned cell
                const buttons = cellClone.querySelectorAll('.cell-action-button, button');
                buttons.forEach(button => button.remove());
                printWindow.document.write(`<td>${cellClone.innerHTML}</td>`);
            });
            printWindow.document.write('</tr>');
        });
        printWindow.document.write('</table>');
    });

    printWindow.document.write(`</body></html>`);
    printWindow.document.close();
    printWindow.print();
}

    function addNewTable() {
        const newTable = document.createElement('table');
        newTable.innerHTML = `
            <tr>
                <td contenteditable="true">
                    <h3>NewGoal</h3><br><div><input type="checkbox" style="margin-right: 5px;"></div>
                </td>
                <td contenteditable="true">
                    <h3>AnotherGoal</h3><br><div><input type="checkbox" style="margin-right: 5px;"></div>
                </td>
            </tr>`;
        document.getElementById('tablesContainer').appendChild(newTable);
    }

    function addReview() {
        const newTable = document.createElement('table');
        newTable.innerHTML = `
            <tr>
                <td contenteditable="true">
                    <h3>Input</h3><div><ul class="custom-bullet-list"><li></li></ul></div>
                </td>
                <td contenteditable="true">
                    <h3>Output</h3><div><ul class="custom-bullet-list"><li></li></ul></div>
                </td>
            </tr>`;
        document.getElementById('tablesContainer').appendChild(newTable);
    }

    async function saveFile() {
        try {
            const defaultTitle = document.getElementById('pageTitle').innerText.trim() || 'Untitled';
            const options = {
                suggestedName: `${defaultTitle}.html`,
                types: [
                    {
                        description: 'HTML Files',
                        accept: {
                            'text/html': ['.html'],
                        },
                    },
                ],
            };

            const fileHandle = await window.showSaveFilePicker(options);
            const writableStream = await fileHandle.createWritable();
            await writableStream.write(document.documentElement.outerHTML);
            await writableStream.close();
            console.log('File saved successfully.');
        } catch (error) {
            console.error('Error saving file:', error);
        }
    }

    async function openFile() {
        try {
            const [fileHandle] = await window.showOpenFilePicker({
                types: [
                    {
                        description: 'HTML Files',
                        accept: {
                            'text/html': ['.html'],
                        },
                    },
                ],
            });

            const file = await fileHandle.getFile();
            const content = await file.text();
            document.documentElement.innerHTML = content;
            console.log('File opened successfully.');
        } catch (error) {
            console.error('Error opening file:', error);
        }
    }

    function insertBulletPoint() {
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            const parentBlock = range.startContainer.parentElement;
            const editor = parentBlock.closest('[contenteditable="true"]');
            if (!editor) return;
            let ul = parentBlock.closest('ul');
            if (!ul || parentBlock === editor) {
                ul = document.createElement('ul');
                ul.classList.add('custom-bullet-list');
                range.insertNode(ul);
            }
            const li = document.createElement('li');
            li.appendChild(document.createTextNode('\u200B'));
            ul.appendChild(li);
            const newRange = document.createRange();
            newRange.setStart(li, 0);
            newRange.setEnd(li, 0);
            selection.removeAllRanges();
            selection.addRange(newRange);
        }
    }

    function insertSubBullet() {
        document.execCommand('indent');
    }

    function insertCheckbox() {
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.style.marginRight = '5px';
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();
            const parentBlock = range.startContainer.parentElement;
            const editor = parentBlock.closest('[contenteditable="true"]');
            if (!editor || parentBlock === editor) {
                const newLine = document.createElement('div');
                newLine.appendChild(checkbox);
                newLine.appendChild(document.createTextNode(' '));
                range.insertNode(newLine);
            } else {
                range.insertNode(document.createTextNode(' '));
                range.insertNode(checkbox);
            }
            const newRange = document.createRange();
            newRange.setStartAfter(checkbox);
            newRange.setEndAfter(checkbox);
            selection.removeAllRanges();
            selection.addRange(newRange);
        }
    }

    function insertChecklist() {
        const list = document.createElement('ul');
        list.style.listStyleType = 'none';
        list.style.padding = '0';
        const labels = [' ', ' ', ' '];
        let firstCheckbox = null;
        labels.forEach((label, index) => {
            const listItem = document.createElement('li');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            if (index === 0) {
                firstCheckbox = checkbox;
            }
            listItem.appendChild(checkbox);
            listItem.appendChild(document.createTextNode(' ' + label));
            list.appendChild(listItem);
        });
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();
            const container = document.createElement('div');
            container.appendChild(list);
            range.insertNode(container);
            if (firstCheckbox) {
                const newRange = document.createRange();
                newRange.setStartAfter(firstCheckbox);
                newRange.setEndAfter(firstCheckbox);
                selection.removeAllRanges();
                selection.addRange(newRange);
            }
        }
    }

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('open');
    }

    document.addEventListener('click', function(event) {
        const sidebar = document.getElementById('sidebar');
        const sidebarButton = document.querySelector('button[onclick="toggleSidebar()"]');
        if (sidebar.classList.contains('open') && 
            !sidebar.contains(event.target) && 
            event.target !== sidebarButton) {
            sidebar.classList.remove('open');
        }
    });

    document.addEventListener("mouseup", function (event) {
        const selection = window.getSelection();
        if (selection.toString().trim() !== "") {
            const contextMenu = document.getElementById("contextMenu");
            contextMenu.style.display = "block";
            contextMenu.style.left = `${event.pageX}px`;
            contextMenu.style.top = `${event.pageY}px`;
            contextMenu.style.opacity = "1";
            contextMenu.style.transform = "scale(1)";
        }
    });

    document.addEventListener("mousedown", function (event) {
        const contextMenu = document.getElementById("contextMenu");
        if (event.target !== contextMenu && !contextMenu.contains(event.target)) {
            contextMenu.style.display = "none";
        }
    });

    window.applyFormat = function (format) {
        const contextMenu = document.getElementById("contextMenu");
        contextMenu.style.display = "none";
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            switch (format) {
                case "bold":
                    document.execCommand("bold");
                    break;
                case "copy":
                    document.execCommand("copy");
                    break;
                case "paste":
                    navigator.clipboard.readText().then((text) => {
                        range.deleteContents();
                        range.insertNode(document.createTextNode(text));
                    }).catch((err) => {
                        console.error("Failed to paste: ", err);
                        alert("Paste failed. Please ensure the page is served over HTTPS or localhost.");
                    });
                    break;
                case "strikeThrough":
                    document.execCommand("strikeThrough");
                    break;
            }
        }
    };

    function isCursorAtBeginningOfLine() {
        const selection = window.getSelection();
        if (!selection.rangeCount) return false;
        const range = selection.getRangeAt(0);
        if (!range.collapsed) return false;
        if (range.startContainer.nodeType === Node.TEXT_NODE && range.startOffset === 0) return true;
        if (range.startOffset === 0) {
            const node = range.startContainer;
            const parentBlock = node.parentElement;
            if (parentBlock.getAttribute('contenteditable') === 'true' && 
                (parentBlock.firstChild === node || node.previousSibling === null)) {
                return true;
            }
            if (node.nodeType === Node.ELEMENT_NODE && 
                (node.tagName === 'DIV' || node.tagName === 'P')) {
                return true;
            }
        }
        return false;
    }

    document.addEventListener("keydown", function (event) {
        if (event.key === "/" && isCursorAtBeginningOfLine()) {
            event.preventDefault();
            if (placeholder) removePlaceholder();
            if (menu) menu.remove();
            const selection = window.getSelection();
            if (!selection.rangeCount) return;
            const range = selection.getRangeAt(0);
            placeholder = insertPlaceholder(range);
            showMenu(range.startContainer.parentElement, range);
        }
    });

    function insertPlaceholder(range) {
        const span = document.createElement("span");
        span.textContent = "/";
        span.style.color = "black";
        span.classList.add("slash-placeholder");
        range.insertNode(span);
        return span;
    }

    function showMenu(target, range) {
        menu = document.createElement("div");
        menu.classList.add("options-menu");
        menu.innerHTML = `
            <button onclick="applyOption('bullet')">• Bullet List</button>
            <button onclick="applyOption('checkbox')">☑ Checklist</button>
            <button onclick="applyOption('number')">1. Number List</button>
            <button onclick="applyOption('hr')">— Horizontal Line</button>
        `;
        document.body.appendChild(menu);
        const rect = target.getBoundingClientRect();
        menu.style.left = `${rect.left}px`;
        menu.style.top = `${rect.top + window.scrollY + 25}px`;
        requestAnimationFrame(() => {
            menu.style.opacity = "1";
            menu.style.transform = "scale(1)";
        });
        document.addEventListener("click", closeMenuOnClickOutside, true);
    }

    function closeMenuOnClickOutside(event) {
        if (menu && !menu.contains(event.target)) {
            cleanupMenu();
        }
    }

    function cleanupMenu() {
        if (menu) {
            menu.remove();
            menu = null;
        }
        removePlaceholder();
        document.removeEventListener("click", closeMenuOnClickOutside, true);
    }

    function removePlaceholder() {
        if (placeholder) {
            placeholder.remove();
            placeholder = null;
        }
    }

    window.applyOption = function(option) {
        const selection = window.getSelection();
        if (!selection.rangeCount) return;
        const range = selection.getRangeAt(0);
        range.deleteContents();
        switch(option) {
            case "bullet":
                insertBulletPoint();
                break;
            case "number":
                document.execCommand("insertOrderedList");
                break;
            case "checkbox":
                insertCheckbox();
                break;
            case "hr":
                document.execCommand("insertHorizontalRule");
                break;
        }
        cleanupMenu();
    };

    document.addEventListener('DOMContentLoaded', function() {
        const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
        dropdownToggles.forEach(toggle => {
            toggle.addEventListener('click', function(event) {
                event.stopPropagation();
                const dropdown = this.parentElement;
                const dropdownContent = dropdown.querySelector('.dropdown-content');
                document.querySelectorAll('.dropdown-content').forEach(content => {
                    if (content !== dropdownContent) {
                        content.classList.remove('show');
                    }
                });
                dropdownContent.classList.toggle('show');
            });
        });
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown-content').forEach(content => {
                    content.classList.remove('show');
                });
            }
        });
    });


function insertCheckboxInCell(button) {
    // Find the parent cell
    const cell = button.closest('td');
    
    // Create a new line with checkbox
    const newLine = document.createElement('div');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.style.marginRight = '5px';
    
    // Add some space after the checkbox
    const space = document.createTextNode(' ');
    
    // Create a zero-width space to position cursor
    const zeroWidthSpace = document.createTextNode('\u200B');
    
    newLine.appendChild(checkbox);
    newLine.appendChild(space);
    newLine.appendChild(zeroWidthSpace);
    
    // Append to the cell
    cell.appendChild(newLine);
    
    // Set focus to the new line
    const range = document.createRange();
    range.setStart(zeroWidthSpace, 0);
    range.setEnd(zeroWidthSpace, 0);
    
    const selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
    
    // Scroll to the new checkbox if needed
    newLine.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

document.addEventListener('keydown', function(event) {
    // Check if Enter key was pressed
    if (event.key === 'Enter') {
        const selection = window.getSelection();
        if (!selection.rangeCount) return;
        
        const range = selection.getRangeAt(0);
        const container = range.startContainer;
        
        // Find the current line element (could be div, p, li, etc.)
        let currentLine = container;
        while (currentLine && currentLine.nodeType === Node.TEXT_NODE) {
            currentLine = currentLine.parentNode;
        }
        
        if (!currentLine) return;
        
        // Check if current line has a checkbox
        const hasCheckbox = currentLine.querySelector('input[type="checkbox"]');
        
        // Check if current line starts with a bullet
        const hasBullet = currentLine.textContent.trim().startsWith('•') || 
                         currentLine.querySelector('span[style*="margin-right: 5px"]');
        
        // Prevent default Enter behavior
        event.preventDefault();
        
        // Create new line based on current line type
        if (hasCheckbox) {
            insertNewCheckboxLine(currentLine);
        } else if (hasBullet) {
            insertNewBulletLine(currentLine);
        } else {
            // Default behavior - just insert a new line
            document.execCommand('insertParagraph', false);
        }
    }
});

function insertNewCheckboxLine(currentLine) {
    const newLine = document.createElement('div');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.style.marginRight = '5px';
    
    // Add some space after the checkbox
    const space = document.createTextNode(' ');
    
    newLine.appendChild(checkbox);
    newLine.appendChild(space);
    
    // Insert after current line
    currentLine.parentNode.insertBefore(newLine, currentLine.nextSibling);
    
    // Set focus to the new line
    const range = document.createRange();
    range.setStart(space, 1);
    range.collapse(true);
    
    const selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);
}


</script>

<footer>
    Copyright © 2025 Dr. Wen-Ming Yang 20250519 v1.83 Week Goals setting (checkbox add in cells) WM
</footer>
</body>
</html>