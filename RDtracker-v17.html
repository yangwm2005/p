<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Research Findings Tracker</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-top: 20px;
            flex: 1;
        }
        
        .sidebar {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }
        
        .content-area {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
            color: var(--primary-color);
        }
        
        .person-list, .project-list {
            list-style-type: none;
            margin-bottom: 20px;
        }
        
        .person-item, .project-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background-color: var(--light-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .person-item:hover, .project-item:hover {
            background-color: #d6dbdf;
        }
        
        .person-item.active, .project-item.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .findings-count {
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .finding-card {
            background-color: white;
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .finding-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-right: 80px;
        }
        
        .finding-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .finding-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .finding-content {
            margin-bottom: 10px;
        }
        
        .finding-connections {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .connection-tag {
            background-color: var(--light-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }
        
        .connection-tag i {
            margin-right: 5px;
            color: var(--secondary-color);
        }
        
        .add-finding-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            margin-top: 20px;
            transition: background-color 0.3s;
            width: 100%;
            justify-content: center;
        }
        
        .add-finding-btn:hover {
            background-color: #27ae60;
        }
        
        .add-finding-btn i {
            margin-right: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: white;
            padding: 10px 0;
            z-index: 10;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            position: sticky;
            bottom: 0;
            background: white;
            padding: 10px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #bdc3c7;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #a6acaf;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-btn {
            background-color: var(--dark-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }
        
        .file-btn i {
            margin-right: 5px;
        }
        
        .file-btn:hover {
            background-color: #2c3e50;
        }
        
        .view-toggle {
            display: flex;
            margin-bottom: 15px;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-btn.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .summary-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .recent-findings {
            margin-top: 20px;
        }
        
        .config-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .config-btn i {
            margin-right: 5px;
        }
        
        .config-btn:hover {
            background-color: #c0392b;
        }
        
        .action-buttons {
            position: absolute;
            top: 15px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        
        .edit-btn {
            color: var(--secondary-color);
        }
        
        .edit-btn:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .delete-btn {
            color: var(--accent-color);
        }
        
        .delete-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .inline-edit {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .inline-edit.active {
            display: block;
        }
        
        .inline-edit textarea {
            min-height: 80px;
        }
        
        .inline-edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .edit-field {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        
        .edit-field:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .welcome-message {
            background-color: #e8f4fd;
            border-left: 4px solid var(--secondary-color);
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .welcome-message h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .welcome-message ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .welcome-message li {
            margin-bottom: 8px;
        }
        
        /* Global search highlighting */
        .search-highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid #ffeaa7;
            font-weight: 600;
        }
        
        .global-search {
            transition: all 0.3s ease;
            margin-top: 15px;
            max-width: 400px;
        }
        
        .search-results-info {
            background-color: var(--light-color);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            border-left: 4px solid var(--secondary-color);
        }
        
        /* New styles for cross-search */
        .cross-search-container {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            max-width: 400px;
        }
        
        .cross-search {
            flex: 1;
            transition: all 0.3s ease;
        }
        
        .cross-search:focus-within {
            transform: scale(1.02);
        }
        
        .cross-search-results {
            background-color: #e8f4fd;
            border-left: 4px solid var(--success-color);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .search-tabs {
            display: flex;
            margin-bottom: 15px;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ddd;
            max-width: 400px;
        }
        
        .search-tab {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .search-tab.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        /* Filter styles */
        .filter-panel {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: none;
        }
        
        .filter-panel.active {
            display: block;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .filter-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            margin-bottom: 10px;
        }
        
        .filter-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            font-weight: normal;
            cursor: pointer;
        }
        
        .filter-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .filter-tag {
            background-color: var(--light-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-tag .remove-filter {
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .date-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        /* Lab Overview Button */
        .overview-btn {
            background-color: var(--warning-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            margin-left: 10px;
            transition: background-color 0.3s;
        }

        .overview-btn:hover {
            background-color: #e67e22;
        }

        .overview-btn i {
            margin-right: 5px;
        }

        /* Pagination Styles */
        .pagination-controls {
            background-color: white;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .pagination-info {
            font-size: 0.9rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .pagination-buttons {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pagination-btn {
            background-color: var(--light-color);
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: var(--secondary-color);
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-numbers {
            display: flex;
            gap: 5px;
            margin: 0 10px;
        }

        .page-number {
            background-color: var(--light-color);
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--dark-color);
            min-width: 40px;
        }

        .page-number:hover {
            background-color: #d6dbdf;
        }

        .page-number.active {
            background-color: var(--secondary-color);
            color: white;
        }

        /* Copyright Footer */
        .copyright-footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .copyright-footer p {
            margin: 0;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Responsive adjustments for pagination */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .file-actions {
                flex-direction: column;
            }
            
            .summary-stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .action-buttons {
                position: static;
                justify-content: flex-end;
                margin-bottom: 10px;
            }
            
            .global-search, .cross-search-container {
                max-width: 100%;
            }
            
            .cross-search-container {
                flex-direction: column;
            }
            
            .filter-options {
                grid-template-columns: 1fr;
            }
            
            .date-range {
                grid-template-columns: 1fr;
            }
            
            .pagination-controls {
                flex-direction: column;
                text-align: center;
            }
            
            .pagination-buttons {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .page-numbers {
                margin: 10px 0;
            }
        }

/* Website Button Styles */
.website-btn {
    background-color: var(--success-color);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    margin-left: 10px;
    transition: background-color 0.3s;
}

.website-btn:hover {
    background-color: #27ae60;
}

.website-btn i {
    margin-right: 5px;
}

    </style>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>Lab Research Findings Tracker</h1>
                    <p class="subtitle">Track, connect, and collaborate on research discoveries</p>
                    
                    <!-- Search Tabs -->
                    <div class="search-tabs">
                        <button class="search-tab active" id="search-findings-tab">Search Findings</button>
                        <button class="search-tab" id="search-all-tab">Search Everything</button>
                    </div>
                    
                    <!-- Global Search Bar for Findings -->
                    <div class="global-search" id="findings-search">
                        <div style="position: relative;">
                            <input type="text" id="global-search" placeholder="Search across all findings..." 
                                   style="width: 100%; padding: 10px 40px 10px 15px; border: 1px solid #ddd; border-radius: 25px; font-size: 0.9rem;">
                            <i class="fas fa-search" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #7f8c8d;"></i>
                        </div>
                    </div>
                    
                    <!-- Cross Search Bar for Everything -->
                    <div class="cross-search-container" id="cross-search" style="display: none;">
                        <div class="cross-search" style="position: relative;">
                            <input type="text" id="cross-search-input" placeholder="Search members, projects & findings..." 
                                   style="width: 100%; padding: 10px 40px 10px 15px; border: 1px solid #ddd; border-radius: 25px; font-size: 0.9rem;">
                            <i class="fas fa-search" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #7f8c8d;"></i>
                        </div>
                        <button class="btn btn-secondary" id="advanced-search-btn" style="padding: 10px 15px; border-radius: 25px; white-space: nowrap;">
                            <i class="fas fa-sliders-h"></i> Filters
                        </button>
                    </div>

                    <!-- Filter Panel -->
                    <div class="filter-panel" id="filter-panel">
                        <div class="filter-header">
                            <h3 style="margin: 0; font-size: 1.1rem;">Filter Results</h3>
                            <button class="btn btn-secondary" id="close-filters" style="padding: 5px 10px;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="filter-options">
                            <div class="filter-group">
                                <h4>Content Types</h4>
                                <label>
                                    <input type="checkbox" id="filter-members" checked> Team Members
                                </label>
                                <label>
                                    <input type="checkbox" id="filter-projects" checked> Projects
                                </label>
                                <label>
                                    <input type="checkbox" id="filter-findings" checked> Findings
                                </label>
                            </div>
                            
                            <div class="filter-group">
                                <h4>Date Range</h4>
                                <div class="date-range">
                                    <div>
                                        <label for="date-from">From</label>
                                        <input type="date" id="date-from">
                                    </div>
                                    <div>
                                        <label for="date-to">To</label>
                                        <input type="date" id="date-to">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <h4>Team Members</h4>
                                <div id="member-filters">
                                    <!-- Member checkboxes will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="filter-group">
                                <h4>Projects</h4>
                                <div id="project-filters">
                                    <!-- Project checkboxes will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="filter-tags" id="active-filters">
                            <!-- Active filter tags will be populated by JavaScript -->
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-secondary" id="clear-filters">
                                <i class="fas fa-times"></i> Clear All
                            </button>
                            <button class="btn btn-primary" id="apply-filters">
                                <i class="fas fa-check"></i> Apply Filters
                            </button>
                        </div>
                    </div>
                </div>
<div>
    <button class="overview-btn" id="overview-btn">
        <i class="fas fa-home"></i> Lab Overview
    </button>
    <button class="config-btn" id="config-btn">
        <i class="fas fa-cog"></i> Configure Lab
    </button>
    <button class="website-btn" id="website-btn">
        <i class="fas fa-external-link-alt"></i> Config (R)
    </button>
</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <div class="sidebar">
                <div class="view-toggle">
                    <button class="toggle-btn active" id="view-people">People</button>
                    <button class="toggle-btn" id="view-projects">Projects</button>
                </div>
                
<div id="people-view">
    <h2 class="section-title">Lab Members</h2>
    <div class="search-box">
        <input type="text" id="search-person" placeholder="Search team members...">
    </div>
    <button class="add-finding-btn" id="add-finding-btn" style="margin-bottom: 20px;">
        <i class="fas fa-plus"></i> Add New Finding
    </button>
    <ul class="person-list" id="person-list">
        <!-- Person items will be populated by JavaScript -->
    </ul>
</div>
                
<div id="projects-view" style="display: none;">
    <h2 class="section-title">Research Projects</h2>
    <div class="search-box">
        <input type="text" id="search-project" placeholder="Search projects...">
    </div>
    <button class="add-finding-btn" id="add-finding-btn-projects" style="margin-bottom: 20px;">
        <i class="fas fa-plus"></i> Add New Finding
    </button>
    <ul class="project-list" id="project-list">
        <!-- Project items will be populated by JavaScript -->
    </ul>
</div>
                
                <button class="add-finding-btn" id="add-finding-btn">
                    <i class="fas fa-plus"></i> Add New Finding
                </button>
                
                <div class="file-actions">
                    <button class="file-btn" id="save-data">
                        <i class="fas fa-save"></i> Save Data
                    </button>
                    <button class="file-btn" id="load-data">
                        <i class="fas fa-folder-open"></i> Load Data
                    </button>
                    <button class="file-btn" id="clear-data" style="background-color: var(--accent-color);">
                        <i class="fas fa-trash"></i> Clear All Data
                    </button>
                </div>
            </div>
            
            <div class="content-area">
                <h2 class="section-title" id="view-title">Lab Overview</h2>
                
                <!-- Pagination Controls -->
                <div class="pagination-controls" id="pagination-controls" style="display: none;">
                    <div class="pagination-info" id="pagination-info"></div>
                    <div class="pagination-buttons">
                        <button class="pagination-btn" id="first-page" title="First Page">
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="pagination-btn" id="prev-page" title="Previous Page">
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <div class="page-numbers" id="page-numbers"></div>
                        <button class="pagination-btn" id="next-page" title="Next Page">
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="pagination-btn" id="last-page" title="Last Page">
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                </div>
                
                <div id="findings-container">
                    <div id="overview-content">
                        <!-- Overview content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Copyright Footer -->
    <footer class="copyright-footer">
        <div class="container">
            <p>Copyright © Dr. Wen-Ming Yang Lab 2025. All rights reserved. (v1.7)</p>
        </div>
    </footer>
    
    <!-- Modal for adding/editing findings -->
    <div class="modal" id="finding-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Finding</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="finding-form">
                <div class="form-group">
                    <label for="finding-title">Title</label>
                    <input type="text" id="finding-title" required>
                </div>
                
                <div class="form-group">
                    <label for="finding-person">Team Member</label>
                    <select id="finding-person" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="finding-project">Project</label>
                    <select id="finding-project" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="finding-date">Date</label>
                    <input type="date" id="finding-date" required>
                </div>
                
                <div class="form-group">
                    <label for="finding-content">Finding Details</label>
                    <textarea id="finding-content" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="finding-next-steps">Next Steps / Approaches</label>
                    <textarea id="finding-next-steps"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="weekly-talk">Weekly Talk Content</label>
                    <textarea id="weekly-talk" placeholder="Summary of discussion from weekly one-on-one meeting"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Connect to Other Findings</label>
                    <div id="connection-options">
                        <!-- Connection checkboxes will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-finding">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Finding</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal for configuring lab members and projects -->
    <div class="modal" id="config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Lab Settings</h2>
                <button class="close-modal" id="close-config-modal">&times;</button>
            </div>
            <div id="config-content">
                <div class="form-group">
                    <h3>Lab Members</h3>
                    <p class="help-text">Add your lab members to get started</p>
                    <div id="members-list">
                        <!-- Members list will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-member-btn" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Member
                    </button>
                </div>
                
                <div class="form-group">
                    <h3>Research Projects</h3>
                    <p class="help-text">Add your research projects to organize findings</p>
                    <div id="projects-config-list">
                        <!-- Projects list will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-project-btn" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Project
                    </button>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-config">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-config-btn">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Empty data - users start with a blank slate
        let labMembers = [];
        let researchProjects = [];
        let researchFindings = [];

        // Global search variables
        let currentSearchTerm = '';
        let searchResults = [];
        let currentCrossSearchTerm = '';
        let crossSearchResults = {
            members: [],
            projects: [],
            findings: []
        };
        let currentSearchMode = 'findings'; // 'findings' or 'cross'

        // Filter state
        let activeFilters = {
            contentTypes: {
                members: true,
                projects: true,
                findings: true
            },
            dateRange: {
                from: null,
                to: null
            },
            members: [],
            projects: []
        };

        // Pagination variables
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentPaginatedItems = [];

        // DOM elements
        const personList = document.getElementById('person-list');
        const projectList = document.getElementById('project-list');
        const findingsContainer = document.getElementById('findings-container');
        const overviewContent = document.getElementById('overview-content');
        const viewTitle = document.getElementById('view-title');
        const addFindingBtn = document.getElementById('add-finding-btn');
        const findingModal = document.getElementById('finding-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelFinding = document.getElementById('cancel-finding');
        const findingForm = document.getElementById('finding-form');
        const findingPersonSelect = document.getElementById('finding-person');
        const findingProjectSelect = document.getElementById('finding-project');
        const connectionOptions = document.getElementById('connection-options');
        const searchPersonInput = document.getElementById('search-person');
        const searchProjectInput = document.getElementById('search-project');
        const viewPeopleBtn = document.getElementById('view-people');
        const viewProjectsBtn = document.getElementById('view-projects');
        const peopleView = document.getElementById('people-view');
        const projectsView = document.getElementById('projects-view');
        const saveDataBtn = document.getElementById('save-data');
        const loadDataBtn = document.getElementById('load-data');
        const configBtn = document.getElementById('config-btn');
        const configModal = document.getElementById('config-modal');
        const closeConfigModal = document.getElementById('close-config-modal');
        const cancelConfig = document.getElementById('cancel-config');
        const membersList = document.getElementById('members-list');
        const projectsConfigList = document.getElementById('projects-config-list');
        const addMemberBtn = document.getElementById('add-member-btn');
        const addProjectBtn = document.getElementById('add-project-btn');
        const saveConfigBtn = document.getElementById('save-config-btn');
        const searchFindingsTab = document.getElementById('search-findings-tab');
        const searchAllTab = document.getElementById('search-all-tab');
        const findingsSearch = document.getElementById('findings-search');
        const crossSearch = document.getElementById('cross-search');
        const crossSearchInput = document.getElementById('cross-search-input');
        const advancedSearchBtn = document.getElementById('advanced-search-btn');
        const filterPanel = document.getElementById('filter-panel');
        const closeFilters = document.getElementById('close-filters');
        const filterMembers = document.getElementById('filter-members');
        const filterProjects = document.getElementById('filter-projects');
        const filterFindings = document.getElementById('filter-findings');
        const dateFrom = document.getElementById('date-from');
        const dateTo = document.getElementById('date-to');
        const memberFilters = document.getElementById('member-filters');
        const projectFilters = document.getElementById('project-filters');
        const activeFiltersContainer = document.getElementById('active-filters');
        const clearFilters = document.getElementById('clear-filters');
        const applyFilters = document.getElementById('apply-filters');
        
        // Pagination DOM elements
        const paginationControls = document.getElementById('pagination-controls');
        const paginationInfo = document.getElementById('pagination-info');
        const pageNumbers = document.getElementById('page-numbers');
        const firstPageBtn = document.getElementById('first-page');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const lastPageBtn = document.getElementById('last-page');
        const overviewBtn = document.getElementById('overview-btn');

        // Current view state
        let currentView = 'overview'; // 'overview', 'people', or 'projects'
        let currentSelection = null; // ID of selected person or project

        // Save data to localStorage
        function saveToLocalStorage() {
            const data = {
                labMembers,
                researchProjects,
                researchFindings,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('labResearchData', JSON.stringify(data));
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('labResearchData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.labMembers && data.researchProjects && data.researchFindings) {
                        labMembers = data.labMembers;
                        researchProjects = data.researchProjects;
                        researchFindings = data.researchFindings;
                        return true;
                    }
                } catch (error) {
                    console.error('Error loading data from localStorage:', error);
                }
            }
            return false;
        }

        // Initialize the application
        function init() {
            // Try to load data from localStorage first
            const loaded = loadFromLocalStorage();
            
            renderPersonList();
            renderProjectList();
            showOverview();
            setupEventListeners();
            populateFilterOptions();
            setupLabOverviewButton();
            
            // Set today's date as default in the form
            document.getElementById('finding-date').valueAsDate = new Date();
            
            if (loaded) {
                console.log('Data loaded successfully from localStorage');
            }
        }

        // Lab Overview button functionality
        function setupLabOverviewButton() {
            overviewBtn.addEventListener('click', () => {
                currentView = 'overview';
                currentSelection = null;
                currentPage = 1;
                currentSearchTerm = '';
                currentCrossSearchTerm = '';
                document.getElementById('global-search').value = '';
                crossSearchInput.value = '';
                showOverview();
                updateViewToggle();
            });
        }

        // Pagination functions
        function setupPagination(items, containerId, renderFunction) {
            const totalItems = items.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            if (totalPages <= 1) {
                paginationControls.style.display = 'none';
                currentPaginatedItems = items;
                renderFunction(currentPaginatedItems, containerId);
                return;
            }
            
            paginationControls.style.display = 'flex';
            
            // Calculate current page items
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
            currentPaginatedItems = items.slice(startIndex, endIndex);
            
            // Update pagination info
            paginationInfo.textContent = `Showing ${startIndex + 1}-${endIndex} of ${totalItems} items`;
            
            // Render page numbers
            renderPageNumbers(totalPages);
            
            // Update button states
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
            lastPageBtn.disabled = currentPage === totalPages;
            
            // Render the items
            renderFunction(currentPaginatedItems, containerId);
        }

        function renderPageNumbers(totalPages) {
            pageNumbers.innerHTML = '';
            
            // Show max 5 page numbers at a time
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, startPage + 4);
            
            // Adjust if we're near the end
            if (endPage - startPage < 4) {
                startPage = Math.max(1, endPage - 4);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `page-number ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    refreshCurrentView();
                });
                pageNumbers.appendChild(pageBtn);
            }
        }

        function goToFirstPage() {
            currentPage = 1;
            refreshCurrentView();
        }

        function goToPrevPage() {
            if (currentPage > 1) {
                currentPage--;
                refreshCurrentView();
            }
        }

        function goToNextPage() {
            const totalItems = currentPaginatedItems.length * Math.ceil(currentPaginatedItems.length / itemsPerPage);
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            if (currentPage < totalPages) {
                currentPage++;
                refreshCurrentView();
            }
        }

        function goToLastPage() {
            const totalItems = currentPaginatedItems.length * Math.ceil(currentPaginatedItems.length / itemsPerPage);
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            currentPage = totalPages;
            refreshCurrentView();
        }

        // Populate filter options with current members and projects
        function populateFilterOptions() {
            // Populate member filters
            memberFilters.innerHTML = '';
            labMembers.forEach(member => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="checkbox" value="${member.id}" data-type="member"> ${member.name}
                `;
                memberFilters.appendChild(label);
            });

            // Populate project filters
            projectFilters.innerHTML = '';
            researchProjects.forEach(project => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="checkbox" value="${project.id}" data-type="project"> ${project.name}
                `;
                projectFilters.appendChild(label);
            });
        }

        // Update active filter tags display
        function updateActiveFilterTags() {
            activeFiltersContainer.innerHTML = '';
            
            // Content type filters
            Object.entries(activeFilters.contentTypes).forEach(([type, isActive]) => {
                if (!isActive) {
                    const tag = document.createElement('div');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        ${type.charAt(0).toUpperCase() + type.slice(1)} 
                        <button class="remove-filter" data-type="contentType" data-value="${type}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    activeFiltersContainer.appendChild(tag);
                }
            });
            
            // Date range filter
            if (activeFilters.dateRange.from || activeFilters.dateRange.to) {
                const tag = document.createElement('div');
                tag.className = 'filter-tag';
                let dateText = 'Date: ';
                if (activeFilters.dateRange.from && activeFilters.dateRange.to) {
                    dateText += `${activeFilters.dateRange.from} to ${activeFilters.dateRange.to}`;
                } else if (activeFilters.dateRange.from) {
                    dateText += `From ${activeFilters.dateRange.from}`;
                } else {
                    dateText += `To ${activeFilters.dateRange.to}`;
                }
                tag.innerHTML = `
                    ${dateText}
                    <button class="remove-filter" data-type="dateRange">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                activeFiltersContainer.appendChild(tag);
            }
            
            // Member filters
            activeFilters.members.forEach(memberId => {
                const member = labMembers.find(m => m.id == memberId);
                if (member) {
                    const tag = document.createElement('div');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        Member: ${member.name}
                        <button class="remove-filter" data-type="member" data-value="${memberId}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    activeFiltersContainer.appendChild(tag);
                }
            });
            
            // Project filters
            activeFilters.projects.forEach(projectId => {
                const project = researchProjects.find(p => p.id == projectId);
                if (project) {
                    const tag = document.createElement('div');
                    tag.className = 'filter-tag';
                    tag.innerHTML = `
                        Project: ${project.name}
                        <button class="remove-filter" data-type="project" data-value="${projectId}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    activeFiltersContainer.appendChild(tag);
                }
            });
        }

        // Apply filters to search results
        function applySearchFilters(results) {
            let filteredResults = {
                members: [...results.members],
                projects: [...results.projects],
                findings: [...results.findings]
            };

            // Filter by content types
            if (!activeFilters.contentTypes.members) {
                filteredResults.members = [];
            }
            if (!activeFilters.contentTypes.projects) {
                filteredResults.projects = [];
            }
            if (!activeFilters.contentTypes.findings) {
                filteredResults.findings = [];
            }

            // Filter by date range (for findings only)
            if (activeFilters.dateRange.from || activeFilters.dateRange.to) {
                filteredResults.findings = filteredResults.findings.filter(findingId => {
                    const finding = researchFindings.find(f => f.id === findingId);
                    const findingDate = new Date(finding.date);
                    
                    let fromValid = true;
                    let toValid = true;
                    
                    if (activeFilters.dateRange.from) {
                        const fromDate = new Date(activeFilters.dateRange.from);
                        fromValid = findingDate >= fromDate;
                    }
                    
                    if (activeFilters.dateRange.to) {
                        const toDate = new Date(activeFilters.dateRange.to);
                        toDate.setHours(23, 59, 59, 999); // End of day
                        toValid = findingDate <= toDate;
                    }
                    
                    return fromValid && toValid;
                });
            }

            // Filter by members (for findings only)
            if (activeFilters.members.length > 0) {
                filteredResults.findings = filteredResults.findings.filter(findingId => {
                    const finding = researchFindings.find(f => f.id === findingId);
                    return activeFilters.members.includes(finding.personId);
                });
            }

            // Filter by projects (for findings only)
            if (activeFilters.projects.length > 0) {
                filteredResults.findings = filteredResults.findings.filter(findingId => {
                    const finding = researchFindings.find(f => f.id === findingId);
                    return activeFilters.projects.includes(finding.projectId);
                });
            }

            return filteredResults;
        }

        // Global search functionality for findings
        function performGlobalSearch(searchTerm) {
            currentSearchTerm = searchTerm.toLowerCase().trim();
            searchResults = [];
            
            if (!currentSearchTerm) {
                // If search is empty, clear highlights and show normal view
                clearSearchHighlights();
                refreshCurrentView();
                return;
            }
            
            // Search through all findings
            researchFindings.forEach(finding => {
                const searchableText = `
                    ${finding.title} 
                    ${finding.content} 
                    ${finding.nextSteps} 
                    ${finding.weeklyTalk || ''}
                `.toLowerCase();
                
                if (searchableText.includes(currentSearchTerm)) {
                    searchResults.push(finding.id);
                }
            });
            
            // Apply highlights and refresh view
            refreshCurrentViewWithSearch();
        }

        // Cross search functionality for everything
        function performCrossSearch(searchTerm) {
            currentCrossSearchTerm = searchTerm.toLowerCase().trim();
            crossSearchResults = {
                members: [],
                projects: [],
                findings: []
            };
            
            if (!currentCrossSearchTerm) {
                // If search is empty, clear highlights and show normal view
                clearSearchHighlights();
                refreshCurrentView();
                return;
            }
            
            // Search through lab members
            labMembers.forEach(member => {
                const searchableText = `
                    ${member.name}
                    ${member.role}
                `.toLowerCase();
                
                if (searchableText.includes(currentCrossSearchTerm)) {
                    crossSearchResults.members.push(member.id);
                }
            });
            
            // Search through research projects
            researchProjects.forEach(project => {
                const searchableText = `
                    ${project.name}
                    ${project.description}
                `.toLowerCase();
                
                if (searchableText.includes(currentCrossSearchTerm)) {
                    crossSearchResults.projects.push(project.id);
                }
            });
            
            // Search through research findings
            researchFindings.forEach(finding => {
                const searchableText = `
                    ${finding.title} 
                    ${finding.content} 
                    ${finding.nextSteps} 
                    ${finding.weeklyTalk || ''}
                `.toLowerCase();
                
                if (searchableText.includes(currentCrossSearchTerm)) {
                    crossSearchResults.findings.push(finding.id);
                }
            });
            
            // Apply filters to search results
            const filteredResults = applySearchFilters(crossSearchResults);
            
            // Show cross search results
            showCrossSearchResults(filteredResults);
        }

        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${escapeRegex(searchTerm)})`, 'gi');
            return text.replace(regex, '<mark class="search-highlight">$1</mark>');
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function clearSearchHighlights() {
            // This will be handled when we re-render without search terms
        }

        function refreshCurrentViewWithSearch() {
            if (currentView === 'overview') {
                showOverview();
            } else if (currentView === 'people' && currentSelection) {
                showPersonSummary(currentSelection);
            } else if (currentView === 'projects' && currentSelection) {
                showProjectSummary(currentSelection);
            }
        }

        // Clear search
        function clearSearch() {
            if (currentSearchMode === 'findings') {
                document.getElementById('global-search').value = '';
                currentSearchTerm = '';
                searchResults = [];
            } else {
                crossSearchInput.value = '';
                currentCrossSearchTerm = '';
                crossSearchResults = { members: [], projects: [], findings: [] };
            }
            refreshCurrentView();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This action cannot be undone!')) {
                if (confirm('This will permanently delete all lab members, projects, and findings. Are you absolutely sure?')) {
                    // Clear all data arrays
                    labMembers = [];
                    researchProjects = [];
                    researchFindings = [];
                    
                    // Clear localStorage
                    localStorage.removeItem('labResearchData');
                    
                    // Reset UI
                    renderPersonList();
                    renderProjectList();
                    currentSelection = null;
                    currentView = 'overview';
                    showOverview();
                    
                    alert('All data has been cleared successfully.');
                }
            }
        }

        // Show cross search results
        function showCrossSearchResults(results = null) {
            const displayResults = results || crossSearchResults;
            
            currentView = 'overview';
            currentSelection = null;
            viewTitle.textContent = 'Cross Search Results';
            
            const totalResults = 
                displayResults.members.length + 
                displayResults.projects.length + 
                displayResults.findings.length;
            
            let html = '';
            
            if (totalResults === 0) {
                html = `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-search"></i>
                        <h3>No results found</h3>
                        <p>No matches found for "<strong>${currentCrossSearchTerm}</strong>" with current filters</p>
                        <button class="btn btn-secondary" id="clear-cross-search" style="margin-top: 15px;">
                            Clear Search
                        </button>
                    </div>
                `;
            } else {
                html = `
                    <div class="cross-search-results">
                        <i class="fas fa-search"></i> 
                        Found ${totalResults} results for "<strong>${currentCrossSearchTerm}</strong>"
                        ${Object.keys(activeFilters).some(key => 
                            Array.isArray(activeFilters[key]) ? activeFilters[key].length > 0 : 
                            typeof activeFilters[key] === 'object' ? Object.values(activeFilters[key]).some(v => v !== null && v !== true) : 
                            false
                        ) ? '<span style="margin-left: 10px;">(with filters applied)</span>' : ''}
                        <button class="btn btn-secondary" id="clear-cross-search" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;">
                            Clear Search
                        </button>
                    </div>
                    
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-value">${displayResults.members.length}</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${displayResults.projects.length}</div>
                            <div class="stat-label">Projects</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${displayResults.findings.length}</div>
                            <div class="stat-label">Findings</div>
                        </div>
                    </div>
                `;
                
                // Show matching members
                if (displayResults.members.length > 0) {
                    html += `
                        <div class="summary-card">
                            <div class="summary-header">
                                <h3 class="summary-title">Matching Team Members</h3>
                            </div>
                            <div class="recent-findings">
                                ${displayResults.members.map(memberId => {
                                    const member = labMembers.find(m => m.id === memberId);
                                    const findingsCount = researchFindings.filter(f => f.personId === memberId).length;
                                    
                                    const displayName = highlightText(member.name, currentCrossSearchTerm);
                                    const displayRole = highlightText(member.role, currentCrossSearchTerm);
                                    
                                    return `
                                        <div class="finding-card" style="cursor: pointer;" data-member-id="${member.id}">
                                            <div class="finding-header">
                                                <div class="finding-title">${displayName}</div>
                                            </div>
                                            <div class="finding-meta">
                                                <strong>Role:</strong> ${displayRole} | 
                                                <strong>Findings:</strong> ${findingsCount}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Show matching projects
                if (displayResults.projects.length > 0) {
                    html += `
                        <div class="summary-card">
                            <div class="summary-header">
                                <h3 class="summary-title">Matching Projects</h3>
                            </div>
                            <div class="recent-findings">
                                ${displayResults.projects.map(projectId => {
                                    const project = researchProjects.find(p => p.id === projectId);
                                    const findingsCount = researchFindings.filter(f => f.projectId === projectId).length;
                                    
                                    const displayName = highlightText(project.name, currentCrossSearchTerm);
                                    const displayDesc = highlightText(project.description, currentCrossSearchTerm);
                                    
                                    return `
                                        <div class="finding-card" style="cursor: pointer;" data-project-id="${project.id}">
                                            <div class="finding-header">
                                                <div class="finding-title">${displayName}</div>
                                            </div>
                                            <div class="finding-content">
                                                <p>${displayDesc}</p>
                                            </div>
                                            <div class="finding-meta">
                                                <strong>Findings:</strong> ${findingsCount}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Show matching findings
                if (displayResults.findings.length > 0) {
                    html += `
                        <div class="summary-card">
                            <div class="summary-header">
                                <h3 class="summary-title">Matching Findings</h3>
                            </div>
                            <div class="recent-findings">
                                ${displayResults.findings.map(findingId => {
                                    const finding = researchFindings.find(f => f.id === findingId);
                                    const member = labMembers.find(m => m.id === finding.personId);
                                    const project = researchProjects.find(p => p.id === finding.projectId);
                                    
                                    const displayTitle = highlightText(finding.title, currentCrossSearchTerm);
                                    const displayContent = highlightText(finding.content, currentCrossSearchTerm);
                                    const displayNextSteps = highlightText(finding.nextSteps, currentCrossSearchTerm);
                                    const displayWeeklyTalk = finding.weeklyTalk ? 
                                        highlightText(finding.weeklyTalk, currentCrossSearchTerm) : '';
                                    
                                    return `
                                        <div class="finding-card">
                                            <div class="action-buttons">
                                                <button class="action-btn edit-btn" data-id="${finding.id}" title="Edit finding">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="action-btn delete-btn" data-id="${finding.id}" title="Delete finding">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            <div class="finding-header">
                                                <div class="finding-title">${displayTitle}</div>
                                                <div class="finding-date">${formatDate(finding.date)}</div>
                                            </div>
                                            <div class="finding-meta">
                                                <strong>Researcher:</strong> ${member.name} | 
                                                <strong>Project:</strong> ${project.name}
                                            </div>
                                            <div class="finding-content">
                                                <p>${displayContent}</p>
                                            </div>
                                            ${finding.nextSteps ? `
                                            <div class="finding-next-steps">
                                                <strong>Next Steps:</strong> ${displayNextSteps}
                                            </div>
                                            ` : ''}
                                            ${finding.weeklyTalk ? `
                                            <div class="finding-weekly-talk">
                                                <strong>Weekly Discussion:</strong> ${displayWeeklyTalk}
                                            </div>
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            overviewContent.innerHTML = html;
            
            // Add event listeners for clear search button
            const clearCrossSearchBtn = document.getElementById('clear-cross-search');
            if (clearCrossSearchBtn) {
                clearCrossSearchBtn.addEventListener('click', clearSearch);
            }
            
            // Add event listeners for member and project cards
            document.querySelectorAll('[data-member-id]').forEach(card => {
                card.addEventListener('click', () => {
                    const memberId = parseInt(card.dataset.memberId);
                    currentView = 'people';
                    currentSelection = memberId;
                    showPersonSummary(memberId);
                    updateViewToggle();
                });
            });
            
            document.querySelectorAll('[data-project-id]').forEach(card => {
                card.addEventListener('click', () => {
                    const projectId = parseInt(card.dataset.projectId);
                    currentView = 'projects';
                    currentSelection = projectId;
                    showProjectSummary(projectId);
                    updateViewToggle();
                });
            });
            
            // Add event listeners for inline editing and deletion
            addInlineEditListeners();
        }

        // Switch between search modes
        function switchSearchMode(mode) {
            currentSearchMode = mode;
            
            // Update tab styles
            searchFindingsTab.classList.toggle('active', mode === 'findings');
            searchAllTab.classList.toggle('active', mode === 'cross');
            
            // Show/hide search fields
            findingsSearch.style.display = mode === 'findings' ? 'block' : 'none';
            crossSearch.style.display = mode === 'cross' ? 'flex' : 'none';
            
            // Hide filter panel when switching modes
            filterPanel.classList.remove('active');
            
            // Clear any existing searches
            clearSearch();
        }

        // Toggle filter panel
        function toggleFilterPanel() {
            filterPanel.classList.toggle('active');
        }

        // Apply filters from UI
        function applyFiltersFromUI() {
            // Content types
            activeFilters.contentTypes.members = filterMembers.checked;
            activeFilters.contentTypes.projects = filterProjects.checked;
            activeFilters.contentTypes.findings = filterFindings.checked;
            
            // Date range
            activeFilters.dateRange.from = dateFrom.value || null;
            activeFilters.dateRange.to = dateTo.value || null;
            
            // Members
            activeFilters.members = [];
            memberFilters.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                activeFilters.members.push(parseInt(checkbox.value));
            });
            
            // Projects
            activeFilters.projects = [];
            projectFilters.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                activeFilters.projects.push(parseInt(checkbox.value));
            });
            
            // Update active filter tags
            updateActiveFilterTags();
            
            // Re-run current search with filters
            if (currentSearchMode === 'cross' && currentCrossSearchTerm) {
                performCrossSearch(currentCrossSearchTerm);
            }
            
            // Hide filter panel
            filterPanel.classList.remove('active');
        }

        // Clear all filters
        function clearAllFilters() {
            // Reset content types
            filterMembers.checked = true;
            filterProjects.checked = true;
            filterFindings.checked = true;
            
            // Reset date range
            dateFrom.value = '';
            dateTo.value = '';
            
            // Reset member and project filters
            memberFilters.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            projectFilters.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Reset active filters state
            activeFilters = {
                contentTypes: {
                    members: true,
                    projects: true,
                    findings: true
                },
                dateRange: {
                    from: null,
                    to: null
                },
                members: [],
                projects: []
            };
            
            // Update UI
            updateActiveFilterTags();
            
            // Re-run current search without filters
            if (currentSearchMode === 'cross' && currentCrossSearchTerm) {
                performCrossSearch(currentCrossSearchTerm);
            }
        }

        // Remove specific filter
        function removeFilter(type, value = null) {
            switch (type) {
                case 'contentType':
                    activeFilters.contentTypes[value] = true;
                    document.getElementById(`filter-${value}`).checked = true;
                    break;
                case 'dateRange':
                    activeFilters.dateRange.from = null;
                    activeFilters.dateRange.to = null;
                    dateFrom.value = '';
                    dateTo.value = '';
                    break;
                case 'member':
                    activeFilters.members = activeFilters.members.filter(id => id != value);
                    memberFilters.querySelector(`input[value="${value}"]`).checked = false;
                    break;
                case 'project':
                    activeFilters.projects = activeFilters.projects.filter(id => id != value);
                    projectFilters.querySelector(`input[value="${value}"]`).checked = false;
                    break;
            }
            
            // Update UI and re-run search
            updateActiveFilterTags();
            if (currentSearchMode === 'cross' && currentCrossSearchTerm) {
                performCrossSearch(currentCrossSearchTerm);
            }
        }

        // Render the list of lab members
        function renderPersonList(filter = '') {
            personList.innerHTML = '';
            
            if (labMembers.length === 0) {
                personList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-users"></i>
                        <p>No lab members yet</p>
                        <small>Click "Configure Lab" to add team members</small>
                    </div>
                `;
                return;
            }
            
            const filteredMembers = labMembers.filter(member => 
                member.name.toLowerCase().includes(filter.toLowerCase())
            );
            
            if (filteredMembers.length === 0) {
                personList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-search"></i>
                        <p>No matching team members</p>
                    </div>
                `;
                return;
            }
            
            filteredMembers.forEach(member => {
                const findingsCount = researchFindings.filter(f => f.personId === member.id).length;
                
                const li = document.createElement('li');
                li.className = 'person-item';
                li.dataset.id = member.id;
                li.innerHTML = `
                    <div>
                        <div class="person-name">${member.name}</div>
                        <div class="person-role">${member.role}</div>
                    </div>
                    <div class="findings-count">${findingsCount}</div>
                `;
                
                li.addEventListener('click', () => {
                    currentView = 'people';
                    currentSelection = member.id;
                    showPersonSummary(member.id);
                    updateViewToggle();
                });
                personList.appendChild(li);
            });
            
            // Populate the person select in the form
            populatePersonSelect();
        }

        // Render the list of projects
        function renderProjectList(filter = '') {
            projectList.innerHTML = '';
            
            if (researchProjects.length === 0) {
                projectList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-flask"></i>
                        <p>No projects yet</p>
                        <small>Click "Configure Lab" to add research projects</small>
                    </div>
                `;
                return;
            }
            
            const filteredProjects = researchProjects.filter(project => 
                project.name.toLowerCase().includes(filter.toLowerCase())
            );
            
            if (filteredProjects.length === 0) {
                projectList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-search"></i>
                        <p>No matching projects</p>
                    </div>
                `;
                return;
            }
            
            filteredProjects.forEach(project => {
                const findingsCount = researchFindings.filter(f => f.projectId === project.id).length;
                
                const li = document.createElement('li');
                li.className = 'project-item';
                li.dataset.id = project.id;
                li.innerHTML = `
                    <div>
                        <div class="project-name">${project.name}</div>
                        <div class="project-description">${project.description}</div>
                    </div>
                    <div class="findings-count">${findingsCount}</div>
                `;
                
                li.addEventListener('click', () => {
                    currentView = 'projects';
                    currentSelection = project.id;
                    showProjectSummary(project.id);
                    updateViewToggle();
                });
                projectList.appendChild(li);
            });
            
            // Populate the project select in the form
            populateProjectSelect();
        }

        // Populate the person select in the form
        function populatePersonSelect() {
            findingPersonSelect.innerHTML = '';
            
            if (labMembers.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No team members available';
                option.disabled = true;
                option.selected = true;
                findingPersonSelect.appendChild(option);
                return;
            }
            
            labMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                findingPersonSelect.appendChild(option);
            });
        }

        // Populate the project select in the form
        function populateProjectSelect() {
            findingProjectSelect.innerHTML = '';
            
            if (researchProjects.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No projects available';
                option.disabled = true;
                option.selected = true;
                findingProjectSelect.appendChild(option);
                return;
            }
            
            researchProjects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                findingProjectSelect.appendChild(option);
            });
        }

        // FIXED: Render configuration for lab members
        function renderMembersConfig() {
            console.log('Rendering members config, current members:', labMembers);
            membersList.innerHTML = '';
            
            labMembers.forEach((member) => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'form-group';
                memberDiv.style.display = 'flex';
                memberDiv.style.gap = '10px';
                memberDiv.style.alignItems = 'center';
                
                memberDiv.innerHTML = `
                    <input type="text" value="${member.name}" class="member-name" data-id="${member.id}" placeholder="Name" style="flex: 2;">
                    <input type="text" value="${member.role}" class="member-role" data-id="${member.id}" placeholder="Role" style="flex: 1;">
                    <button type="button" class="btn btn-secondary remove-member" data-id="${member.id}" style="padding: 5px 10px;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                // Add event listener for remove button
                const removeBtn = memberDiv.querySelector('.remove-member');
                removeBtn.addEventListener('click', () => {
                    const memberId = parseInt(removeBtn.dataset.id);
                    console.log('Remove member clicked:', memberId);
                    
                    if (researchFindings.some(f => f.personId === memberId)) {
                        alert('Cannot remove a team member who has findings recorded. Please reassign their findings first.');
                        return;
                    }
                    
                    if (labMembers.length <= 1) {
                        alert('You must have at least one lab member.');
                        return;
                    }
                    
                    labMembers = labMembers.filter(m => m.id !== memberId);
                    renderMembersConfig();
                });
                
                membersList.appendChild(memberDiv);
            });
        }

        // FIXED: Render configuration for projects
        function renderProjectsConfig() {
            console.log('Rendering projects config, current projects:', researchProjects);
            projectsConfigList.innerHTML = '';
            
            researchProjects.forEach((project) => {
                const projectDiv = document.createElement('div');
                projectDiv.className = 'form-group';
                projectDiv.style.display = 'flex';
                projectDiv.style.gap = '10px';
                projectDiv.style.alignItems = 'center';
                
                projectDiv.innerHTML = `
                    <input type="text" value="${project.name}" class="project-name" data-id="${project.id}" placeholder="Project Name" style="flex: 2;">
                    <input type="text" value="${project.description}" class="project-desc" data-id="${project.id}" placeholder="Description" style="flex: 1;">
                    <button type="button" class="btn btn-secondary remove-project" data-id="${project.id}" style="padding: 5px 10px;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                // Add event listener for remove button
                const removeBtn = projectDiv.querySelector('.remove-project');
                removeBtn.addEventListener('click', () => {
                    const projectId = parseInt(removeBtn.dataset.id);
                    console.log('Remove project clicked:', projectId);
                    
                    if (researchFindings.some(f => f.projectId === projectId)) {
                        alert('Cannot remove a project that has findings recorded. Please reassign those findings first.');
                        return;
                    }
                    
                    if (researchProjects.length <= 1) {
                        alert('You must have at least one research project.');
                        return;
                    }
                    
                    researchProjects = researchProjects.filter(p => p.id !== projectId);
                    renderProjectsConfig();
                });
                
                projectsConfigList.appendChild(projectDiv);
            });
        }

        // Show overview of the lab
        function showOverview() {
            currentView = 'overview';
            currentSelection = null;
            viewTitle.textContent = 'Lab Overview';
            
            const totalFindings = researchFindings.length;
            const totalMembers = labMembers.length;
            const totalProjects = researchProjects.length;
            
            // Calculate recent findings (last 30 days)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentFindings = researchFindings.filter(f => new Date(f.date) >= thirtyDaysAgo);
            
            // Filter findings if search is active
            const displayFindings = currentSearchTerm ? 
                researchFindings.filter(f => searchResults.includes(f.id)) : 
                researchFindings; // Show all findings in overview now
            
            overviewContent.innerHTML = `
                ${totalFindings === 0 && totalMembers === 0 && totalProjects === 0 ? `
                <div class="welcome-message">
                    <h3>Welcome to your Lab Research Findings Tracker!</h3>
                    <p>Get started by following these steps:</p>
                    <ol>
                        <li><strong>Configure your lab</strong> - Click the "Configure Lab" button to add your team members and research projects</li>
                        <li><strong>Add your first finding</strong> - Once you have team members and projects, click "Add New Finding" to record research discoveries</li>
                        <li><strong>Connect findings</strong> - Link related findings across different team members to generate new ideas</li>
                        <li><strong>Track progress</strong> - Use the summary views to monitor research progress and weekly discussions</li>
                    </ol>
                    <p>Your data is stored locally in your browser. Use the "Save Data" button to back up your work.</p>
                </div>
                ` : ''}
                
                ${currentSearchTerm ? `
                <div class="search-results-info">
                    <i class="fas fa-search"></i> 
                    Found ${searchResults.length} results for "<strong>${currentSearchTerm}</strong>"
                    <button class="btn btn-secondary" id="clear-search" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;">
                        Clear Search
                    </button>
                </div>
                ` : ''}
                
                <div class="summary-card">
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-value">${totalFindings}</div>
                            <div class="stat-label">Total Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${totalMembers}</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${totalProjects}</div>
                            <div class="stat-label">Research Projects</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${recentFindings.length}</div>
                            <div class="stat-label">Recent Findings</div>
                        </div>
                    </div>
                    
                    ${totalFindings === 0 ? `
                    <div class="empty-state" style="padding: 20px;">
                        <i class="fas fa-microscope"></i>
                        <h3>No findings yet</h3>
                        <p>Add your first research finding to get started</p>
                        <button class="btn btn-primary" id="first-finding-btn" style="margin-top: 15px;">
                            <i class="fas fa-plus"></i> Add First Finding
                        </button>
                    </div>
                    ` : ''}
                </div>
                
                <div id="findings-list-container">
                    <!-- Findings will be rendered here with pagination -->
                </div>
            `;
            
            // Render findings with pagination
            if (displayFindings.length > 0) {
                setupPagination(displayFindings, 'findings-list-container', renderFindingsList);
            }
            
            // Add event listener for first finding button
            if (totalFindings === 0) {
                const firstFindingBtn = document.getElementById('first-finding-btn');
                if (firstFindingBtn) {
                    firstFindingBtn.addEventListener('click', () => {
                        if (labMembers.length === 0 || researchProjects.length === 0) {
                            alert('Please configure your lab members and projects first.');
                            configBtn.click();
                        } else {
                            addFindingBtn.click();
                        }
                    });
                }
            }
            
            // Add event listeners for clear search buttons
            const clearSearchBtn = document.getElementById('clear-search');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
            
            updateViewToggle();
        }

        // Function to render findings list
        function renderFindingsList(findings, containerId) {
            const container = document.getElementById(containerId);
            
            const html = `
                <div class="summary-card">
                    <div class="summary-header">
                        <h3 class="summary-title">
                            ${currentSearchTerm ? 'Search Results' : 'All Findings'}
                            ${currentSearchTerm ? ` (${researchFindings.filter(f => searchResults.includes(f.id)).length})` : ` (${researchFindings.length})`}
                        </h3>
                    </div>
                    <div class="recent-findings">
                        ${findings.map(finding => {
                            const member = labMembers.find(m => m.id === finding.personId);
                            const project = researchProjects.find(p => p.id === finding.projectId);
                            
                            // Apply highlighting if search is active
                            const displayTitle = currentSearchTerm ? 
                                highlightText(finding.title, currentSearchTerm) : finding.title;
                            const displayContent = currentSearchTerm ? 
                                highlightText(finding.content, currentSearchTerm) : finding.content;
                            const displayNextSteps = currentSearchTerm ? 
                                highlightText(finding.nextSteps, currentSearchTerm) : finding.nextSteps;
                            const displayWeeklyTalk = currentSearchTerm && finding.weeklyTalk ? 
                                highlightText(finding.weeklyTalk, currentSearchTerm) : finding.weeklyTalk;
                            
                            return `
                                <div class="finding-card">
                                    <div class="action-buttons">
                                        <button class="action-btn edit-btn" data-id="${finding.id}" title="Edit finding">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn delete-btn" data-id="${finding.id}" title="Delete finding">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <div class="finding-header">
                                        <div class="finding-title edit-field" data-id="${finding.id}" data-field="title">${displayTitle}</div>
                                        <div class="finding-date">${formatDate(finding.date)}</div>
                                    </div>
                                    <div class="finding-meta">
                                        <strong>Researcher:</strong> ${member.name} | 
                                        <strong>Project:</strong> ${project.name}
                                    </div>
                                    <div class="finding-content">
                                        <p class="edit-field" data-id="${finding.id}" data-field="content">${displayContent}</p>
                                    </div>
                                    <div class="finding-next-steps">
                                        <strong>Next Steps:</strong> <span class="edit-field" data-id="${finding.id}" data-field="nextSteps">${displayNextSteps}</span>
                                    </div>
                                    ${finding.weeklyTalk ? `
                                    <div class="finding-weekly-talk">
                                        <strong>Weekly Discussion:</strong> <span class="edit-field" data-id="${finding.id}" data-field="weeklyTalk">${displayWeeklyTalk}</span>
                                    </div>
                                    ` : ''}
                                    <div class="inline-edit" id="edit-${finding.id}">
                                        <!-- Inline edit form will be populated here -->
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Add event listeners for inline editing and deletion
            addInlineEditListeners();
        }

        // Show summary for a specific person
        function showPersonSummary(personId) {
            const member = labMembers.find(m => m.id === personId);
            if (!member) return;
            
            // Update active state in person list
            document.querySelectorAll('.person-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.id) === personId) {
                    item.classList.add('active');
                }
            });
            
            viewTitle.textContent = `${member.name} - Summary`;
            
            const personFindings = researchFindings.filter(f => f.personId === personId);
            
            // Filter findings if search is active
            const displayFindings = currentSearchTerm ? 
                personFindings.filter(f => searchResults.includes(f.id)) : 
                personFindings;
            
            const personProjects = [...new Set(displayFindings.map(f => f.projectId))].map(id => 
                researchProjects.find(p => p.id === id)
            );
            
            overviewContent.innerHTML = `
                ${currentSearchTerm ? `
                <div class="search-results-info">
                    <i class="fas fa-search"></i> 
                    Found ${displayFindings.length} results for "<strong>${currentSearchTerm}</strong>" in ${member.name}'s findings
                    <button class="btn btn-secondary" id="clear-search" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;">
                        Clear Search
                    </button>
                </div>
                ` : ''}
                
                <div class="summary-card">
                    <div class="summary-header">
                        <h3 class="summary-title">${member.name}</h3>
                        <div class="person-role">${member.role}</div>
                    </div>
                    
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-value">${personFindings.length}</div>
                            <div class="stat-label">Total Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${personProjects.length}</div>
                            <div class="stat-label">Projects Involved</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${displayFindings.length}</div>
                            <div class="stat-label">${currentSearchTerm ? 'Matching' : 'Recent'} Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${countConnections(personFindings)}</div>
                            <div class="stat-label">Connections</div>
                        </div>
                    </div>
                    
                    ${personProjects.length > 0 ? `
                    <div class="summary-info">
                        <h3>Projects</h3>
                        <ul>
                            ${personProjects.map(project => `
                                <li>${project.name} - ${personFindings.filter(f => f.projectId === project.id).length} findings</li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
                
                <div class="summary-card">
                    <div class="summary-header">
                        <h3 class="summary-title">${currentSearchTerm ? 'Matching Findings' : 'Recent Findings'}</h3>
                    </div>
                    <div class="recent-findings">
                        ${displayFindings.length > 0 ? 
                            displayFindings.map(finding => {
                                const project = researchProjects.find(p => p.id === finding.projectId);
                                
                                // Apply highlighting if search is active
                                const displayTitle = currentSearchTerm ? 
                                    highlightText(finding.title, currentSearchTerm) : finding.title;
                                const displayContent = currentSearchTerm ? 
                                    highlightText(finding.content, currentSearchTerm) : finding.content;
                                const displayNextSteps = currentSearchTerm ? 
                                    highlightText(finding.nextSteps, currentSearchTerm) : finding.nextSteps;
                                const displayWeeklyTalk = currentSearchTerm && finding.weeklyTalk ? 
                                    highlightText(finding.weeklyTalk, currentSearchTerm) : finding.weeklyTalk;
                                
                                return `
                                    <div class="finding-card">
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" data-id="${finding.id}" title="Edit finding">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn delete-btn" data-id="${finding.id}" title="Delete finding">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div class="finding-header">
                                            <div class="finding-title edit-field" data-id="${finding.id}" data-field="title">${displayTitle}</div>
                                            <div class="finding-date">${formatDate(finding.date)}</div>
                                        </div>
                                        <div class="finding-meta">
                                            <strong>Project:</strong> ${project.name}
                                        </div>
                                        <div class="finding-content">
                                            <p class="edit-field" data-id="${finding.id}" data-field="content">${displayContent}</p>
                                        </div>
                                        <div class="finding-next-steps">
                                            <strong>Next Steps:</strong> <span class="edit-field" data-id="${finding.id}" data-field="nextSteps">${displayNextSteps}</span>
                                        </div>
                                        ${finding.weeklyTalk ? `
                                        <div class="finding-weekly-talk">
                                            <strong>Weekly Discussion:</strong> <span class="edit-field" data-id="${finding.id}" data-field="weeklyTalk">${displayWeeklyTalk}</span>
                                        </div>
                                        ` : ''}
                                        <div class="inline-edit" id="edit-${finding.id}">
                                            <!-- Inline edit form will be populated here -->
                                        </div>
                                    </div>
                                `;
                            }).join('') 
                            : 
                            '<div class="empty-state" style="padding: 20px;"><i class="fas fa-microscope"></i><p>No findings recorded for this team member</p></div>'
                        }
                    </div>
                </div>
            `;
            
            // Add event listeners for clear search buttons
            const clearSearchBtn = document.getElementById('clear-search');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
            
            // Add event listeners for inline editing and deletion
            addInlineEditListeners();
        }

        // Show summary for a specific project
        function showProjectSummary(projectId) {
            const project = researchProjects.find(p => p.id === projectId);
            if (!project) return;
            
            // Update active state in project list
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.id) === projectId) {
                    item.classList.add('active');
                }
            });
            
            viewTitle.textContent = `${project.name} - Summary`;
            
            const projectFindings = researchFindings.filter(f => f.projectId === projectId);
            
            // Filter findings if search is active
            const displayFindings = currentSearchTerm ? 
                projectFindings.filter(f => searchResults.includes(f.id)) : 
                projectFindings;
            
            const projectMembers = [...new Set(displayFindings.map(f => f.personId))].map(id => 
                labMembers.find(m => m.id === id)
            );
            
            overviewContent.innerHTML = `
                ${currentSearchTerm ? `
                <div class="search-results-info">
                    <i class="fas fa-search"></i> 
                    Found ${displayFindings.length} results for "<strong>${currentSearchTerm}</strong>" in ${project.name}
                    <button class="btn btn-secondary" id="clear-search" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;">
                        Clear Search
                    </button>
                </div>
                ` : ''}
                
                <div class="summary-card">
                    <div class="summary-header">
                        <h3 class="summary-title">${project.name}</h3>
                        <div class="project-description">${project.description}</div>
                    </div>
                    
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-value">${projectFindings.length}</div>
                            <div class="stat-label">Total Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${projectMembers.length}</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${displayFindings.length}</div>
                            <div class="stat-label">${currentSearchTerm ? 'Matching' : 'Recent'} Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${countConnections(projectFindings)}</div>
                            <div class="stat-label">Connections</div>
                        </div>
                    </div>
                    
                    ${projectMembers.length > 0 ? `
                    <div class="summary-info">
                        <h3>Team Members</h3>
                        <ul>
                            ${projectMembers.map(member => `
                                <li>${member.name} (${member.role}) - ${projectFindings.filter(f => f.personId === member.id).length} findings</li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
                
                <div class="summary-card">
                    <div class="summary-header">
                        <h3 class="summary-title">${currentSearchTerm ? 'Matching Findings' : 'Recent Findings'}</h3>
                    </div>
                    <div class="recent-findings">
                        ${displayFindings.length > 0 ? 
                            displayFindings.map(finding => {
                                const member = labMembers.find(m => m.id === finding.personId);
                                
                                // Apply highlighting if search is active
                                const displayTitle = currentSearchTerm ? 
                                    highlightText(finding.title, currentSearchTerm) : finding.title;
                                const displayContent = currentSearchTerm ? 
                                    highlightText(finding.content, currentSearchTerm) : finding.content;
                                const displayNextSteps = currentSearchTerm ? 
                                    highlightText(finding.nextSteps, currentSearchTerm) : finding.nextSteps;
                                const displayWeeklyTalk = currentSearchTerm && finding.weeklyTalk ? 
                                    highlightText(finding.weeklyTalk, currentSearchTerm) : finding.weeklyTalk;
                                
                                return `
                                    <div class="finding-card">
                                        <div class="action-buttons">
                                            <button class="action-btn edit-btn" data-id="${finding.id}" title="Edit finding">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn delete-btn" data-id="${finding.id}" title="Delete finding">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div class="finding-header">
                                            <div class="finding-title edit-field" data-id="${finding.id}" data-field="title">${displayTitle}</div>
                                            <div class="finding-date">${formatDate(finding.date)}</div>
                                        </div>
                                        <div class="finding-meta">
                                            <strong>Researcher:</strong> ${member.name}
                                        </div>
                                        <div class="finding-content">
                                            <p class="edit-field" data-id="${finding.id}" data-field="content">${displayContent}</p>
                                        </div>
                                        <div class="finding-next-steps">
                                            <strong>Next Steps:</strong> <span class="edit-field" data-id="${finding.id}" data-field="nextSteps">${displayNextSteps}</span>
                                        </div>
                                        ${finding.weeklyTalk ? `
                                        <div class="finding-weekly-talk">
                                            <strong>Weekly Discussion:</strong> <span class="edit-field" data-id="${finding.id}" data-field="weeklyTalk">${displayWeeklyTalk}</span>
                                        </div>
                                        ` : ''}
                                        <div class="inline-edit" id="edit-${finding.id}">
                                            <!-- Inline edit form will be populated here -->
                                        </div>
                                    </div>
                                `;
                            }).join('') 
                            : 
                            '<div class="empty-state" style="padding: 20px;"><i class="fas fa-microscope"></i><p>No findings recorded for this project</p></div>'
                        }
                    </div>
                </div>
            `;
            
            // Add event listeners for clear search buttons
            const clearSearchBtn = document.getElementById('clear-search');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
            
            // Add event listeners for inline editing and deletion
            addInlineEditListeners();
        }

        // Count total connections for a set of findings
        function countConnections(findings) {
            return findings.reduce((total, finding) => total + finding.connections.length, 0);
        }

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Update view toggle buttons
        function updateViewToggle() {
            if (currentView === 'overview' || currentView === 'people') {
                viewPeopleBtn.classList.add('active');
                viewProjectsBtn.classList.remove('active');
                peopleView.style.display = 'block';
                projectsView.style.display = 'none';
            } else {
                viewPeopleBtn.classList.remove('active');
                viewProjectsBtn.classList.add('active');
                peopleView.style.display = 'none';
                projectsView.style.display = 'block';
            }
        }

        // Add event listeners for inline editing and deletion
        function addInlineEditListeners() {
            // Edit buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const findingId = parseInt(e.currentTarget.dataset.id);
                    const finding = researchFindings.find(f => f.id === findingId);
                    if (finding) {
                        openFindingModal(finding);
                    }
                });
            });
            
            // Delete buttons
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const findingId = parseInt(e.currentTarget.dataset.id);
                    if (confirm('Are you sure you want to delete this finding?')) {
                        deleteFinding(findingId);
                    }
                });
            });
            
            // Inline edit fields
            document.querySelectorAll('.edit-field').forEach(field => {
                field.addEventListener('click', (e) => {
                    const findingId = parseInt(e.currentTarget.dataset.id);
                    const fieldName = e.currentTarget.dataset.field;
                    const finding = researchFindings.find(f => f.id === findingId);
                    
                    if (finding) {
                        showInlineEditForm(finding, fieldName);
                    }
                });
            });
        }

        // Show inline edit form for a specific field
        function showInlineEditForm(finding, fieldName) {
            const editDiv = document.getElementById(`edit-${finding.id}`);
            const fieldValue = finding[fieldName] || '';
            
            // Determine input type based on field
            let inputType = 'text';
            if (fieldName === 'content' || fieldName === 'nextSteps' || fieldName === 'weeklyTalk') {
                inputType = 'textarea';
            }
            
            editDiv.innerHTML = `
                <div class="form-group">
                    <label>Edit ${fieldName.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</label>
                    ${inputType === 'textarea' ? 
                        `<textarea id="inline-edit-${finding.id}-${fieldName}">${fieldValue}</textarea>` :
                        `<input type="text" id="inline-edit-${finding.id}-${fieldName}" value="${fieldValue}">`
                    }
                </div>
                <div class="inline-edit-actions">
                    <button type="button" class="btn btn-secondary cancel-inline-edit" data-id="${finding.id}">Cancel</button>
                    <button type="button" class="btn btn-primary save-inline-edit" data-id="${finding.id}" data-field="${fieldName}">Save</button>
                </div>
            `;
            
            editDiv.classList.add('active');
            
            // Add event listeners for inline edit actions
            const cancelBtn = document.querySelector(`.cancel-inline-edit[data-id="${finding.id}"]`);
            const saveBtn = document.querySelector(`.save-inline-edit[data-id="${finding.id}"]`);
            
            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    editDiv.classList.remove('active');
                });
            }
            
            if (saveBtn) {
                saveBtn.addEventListener('click', (e) => {
                    const findingId = parseInt(e.currentTarget.dataset.id);
                    const field = e.currentTarget.dataset.field;
                    const value = document.getElementById(`inline-edit-${findingId}-${field}`).value;
                    
                    updateFindingField(findingId, field, value);
                    editDiv.classList.remove('active');
                });
            }
        }

        // Update a specific field in a finding
        function updateFindingField(findingId, field, value) {
            const findingIndex = researchFindings.findIndex(f => f.id === findingId);
            if (findingIndex !== -1) {
                researchFindings[findingIndex][field] = value;
                
                // Save to localStorage
                saveToLocalStorage();
                
                // Refresh the current view
                refreshCurrentView();
                
                // Update counts in sidebar
                renderPersonList();
                renderProjectList();
            }
        }

        // Delete a finding
        function deleteFinding(findingId) {
            const findingIndex = researchFindings.findIndex(f => f.id === findingId);
            if (findingIndex !== -1) {
                researchFindings.splice(findingIndex, 1);
                
                // Remove connections to this finding from other findings
                researchFindings.forEach(finding => {
                    finding.connections = finding.connections.filter(connId => connId !== findingId);
                });
                
                // Save to localStorage
                saveToLocalStorage();
                
                // Refresh the current view
                refreshCurrentView();
                
                // Update counts in sidebar
                renderPersonList();
                renderProjectList();
            }
        }

        function refreshCurrentView() {
            // Reset to page 1 when changing views (except for pagination navigation)
            if (!event || !event.target.closest('.pagination-btn') && !event.target.closest('.page-number')) {
                currentPage = 1;
            }
            
            if (currentSearchMode === 'findings' && currentSearchTerm) {
                refreshCurrentViewWithSearch();
            } else if (currentSearchMode === 'cross' && currentCrossSearchTerm) {
                showCrossSearchResults();
            } else {
                if (currentView === 'overview') {
                    showOverview();
                } else if (currentView === 'people' && currentSelection) {
                    showPersonSummary(currentSelection);
                } else if (currentView === 'projects' && currentSelection) {
                    showProjectSummary(currentSelection);
                }
            }
        }

        // FIXED: Setup event listeners
        function setupEventListeners() {
// Add event listener for both Add Finding buttons
const addFindingBtns = document.querySelectorAll('#add-finding-btn, #add-finding-btn-projects');
addFindingBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        if (labMembers.length === 0 || researchProjects.length === 0) {
            alert('Please configure your lab members and projects first.');
            configBtn.click();
            return;
        }
        openFindingModal();
    });
});

// Website button event listener
document.getElementById('website-btn').addEventListener('click', openWebsitePopup);
            
            closeModal.addEventListener('click', () => closeFindingModal());
            cancelFinding.addEventListener('click', () => closeFindingModal());
            
            findingForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveFinding();
            });
            
            searchPersonInput.addEventListener('input', (e) => {
                renderPersonList(e.target.value);
            });
            
            searchProjectInput.addEventListener('input', (e) => {
                renderProjectList(e.target.value);
            });
            
            // Global search functionality for findings
            document.getElementById('global-search').addEventListener('input', (e) => {
                performGlobalSearch(e.target.value);
            });
            
            // Cross search functionality for everything
            crossSearchInput.addEventListener('input', (e) => {
                performCrossSearch(e.target.value);
            });
            
            // Add Enter key support for search
            document.getElementById('global-search').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performGlobalSearch(e.target.value);
                }
            });
            
            crossSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performCrossSearch(e.target.value);
                }
            });
            
            // Search mode tabs
            searchFindingsTab.addEventListener('click', () => {
                switchSearchMode('findings');
            });
            
            searchAllTab.addEventListener('click', () => {
                switchSearchMode('cross');
            });
            
            // Filter functionality
            advancedSearchBtn.addEventListener('click', toggleFilterPanel);
            closeFilters.addEventListener('click', () => {
                filterPanel.classList.remove('active');
            });
            applyFilters.addEventListener('click', applyFiltersFromUI);
            clearFilters.addEventListener('click', clearAllFilters);
            
            // Remove individual filters
            activeFiltersContainer.addEventListener('click', (e) => {
                if (e.target.closest('.remove-filter')) {
                    const button = e.target.closest('.remove-filter');
                    const type = button.dataset.type;
                    const value = button.dataset.value;
                    removeFilter(type, value);
                }
            });
            
            // Pagination event listeners
            firstPageBtn.addEventListener('click', goToFirstPage);
            prevPageBtn.addEventListener('click', goToPrevPage);
            nextPageBtn.addEventListener('click', goToNextPage);
            lastPageBtn.addEventListener('click', goToLastPage);
            
            viewPeopleBtn.addEventListener('click', () => {
                currentView = 'people';
                updateViewToggle();
                if (currentSelection && currentView === 'people') {
                    const member = labMembers.find(m => m.id === currentSelection);
                    if (member) {
                        showPersonSummary(currentSelection);
                    } else {
                        showOverview();
                    }
                } else {
                    showOverview();
                }
            });
            
            viewProjectsBtn.addEventListener('click', () => {
                currentView = 'projects';
                updateViewToggle();
                if (currentSelection && currentView === 'projects') {
                    const project = researchProjects.find(p => p.id === currentSelection);
                    if (project) {
                        showProjectSummary(currentSelection);
                    } else {
                        showOverview();
                    }
                } else {
                    showOverview();
                }
            });
            
            saveDataBtn.addEventListener('click', saveDataToFile);
            loadDataBtn.addEventListener('click', loadDataFromFile);
            document.getElementById('clear-data').addEventListener('click', clearAllData);
            
            // Configuration event listeners
            configBtn.addEventListener('click', () => {
                console.log('Config button clicked');
                
                // Ensure we have at least one member and one project
                if (labMembers.length === 0) {
                    labMembers.push({
                        id: 1,
                        name: '',
                        role: ''
                    });
                }
                
                if (researchProjects.length === 0) {
                    researchProjects.push({
                        id: 1,
                        name: '',
                        description: ''
                    });
                }
                
                renderMembersConfig();
                renderProjectsConfig();
                configModal.style.display = 'flex';
            });
            
            closeConfigModal.addEventListener('click', () => {
                configModal.style.display = 'none';
            });
            
            cancelConfig.addEventListener('click', () => {
                configModal.style.display = 'none';
            });
            
            // Direct event listeners for configuration buttons
            addMemberBtn.addEventListener('click', () => {
                console.log('Add member button clicked');
                
                // Get the current highest ID
                const maxId = labMembers.length > 0 ? Math.max(...labMembers.map(m => m.id)) : 0;
                const newId = maxId + 1;
                
                // Add a new blank member
                labMembers.push({
                    id: newId,
                    name: '',
                    role: ''
                });
                
                renderMembersConfig();
            });

            // Add project button
            addProjectBtn.addEventListener('click', () => {
                console.log('Add project button clicked');
                
                // Get the current highest ID
                const maxId = researchProjects.length > 0 ? Math.max(...researchProjects.map(p => p.id)) : 0;
                const newId = maxId + 1;
                
                // Add a new blank project
                researchProjects.push({
                    id: newId,
                    name: '',
                    description: ''
                });
                
                renderProjectsConfig();
            });
            
            // Save configuration button - This is the key fix
            saveConfigBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Save Configuration button clicked - DIRECT LISTENER');
                saveConfiguration();
            });
        }

        // Open the modal for adding a new finding
        function openFindingModal(editingFinding = null) {
            document.getElementById('modal-title').textContent = 
                editingFinding ? 'Edit Finding' : 'Add New Finding';
            
            if (editingFinding) {
                // Populate form with existing data
                document.getElementById('finding-title').value = editingFinding.title;
                document.getElementById('finding-person').value = editingFinding.personId;
                document.getElementById('finding-project').value = editingFinding.projectId;
                document.getElementById('finding-date').value = editingFinding.date;
                document.getElementById('finding-content').value = editingFinding.content;
                document.getElementById('finding-next-steps').value = editingFinding.nextSteps;
                document.getElementById('weekly-talk').value = editingFinding.weeklyTalk || '';
                
                // Store the ID for updating
                findingForm.dataset.editingId = editingFinding.id;
            } else {
                // Reset form
                findingForm.reset();
                document.getElementById('finding-date').valueAsDate = new Date();
                delete findingForm.dataset.editingId;
            }
            
            // Populate connection options
            populateConnectionOptions(editingFinding);
            
            findingModal.style.display = 'flex';
        }

        // Populate connection options in the form
        function populateConnectionOptions(currentFinding = null) {
            connectionOptions.innerHTML = '';
            
            if (researchFindings.length === 0) {
                connectionOptions.innerHTML = '<p>No other findings available to connect to.</p>';
                return;
            }
            
            researchFindings.forEach(finding => {
                // Don't allow connecting to itself
                if (currentFinding && finding.id === currentFinding.id) return;
                
                const person = labMembers.find(m => m.id === finding.personId);
                const project = researchProjects.find(p => p.id === finding.projectId);
                
                const label = document.createElement('label');
                label.style.display = 'block';
                label.style.marginBottom = '8px';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = finding.id;
                checkbox.name = 'connections';
                
                // Check if this finding is already connected
                if (currentFinding && currentFinding.connections.includes(finding.id)) {
                    checkbox.checked = true;
                }
                
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(` ${person.name} (${project.name}): ${finding.title.substring(0, 50)}...`));
                
                connectionOptions.appendChild(label);
            });
        }

        // Close the modal
        function closeFindingModal() {
            findingModal.style.display = 'none';
        }

        // Save a new finding or update an existing one
        function saveFinding() {
            const formData = new FormData(findingForm);
            
            // Get selected connections
            const connectionCheckboxes = document.querySelectorAll('input[name="connections"]:checked');
            const connections = Array.from(connectionCheckboxes).map(cb => parseInt(cb.value));
            
            const findingData = {
                title: document.getElementById('finding-title').value,
                personId: parseInt(document.getElementById('finding-person').value),
                projectId: parseInt(document.getElementById('finding-project').value),
                date: document.getElementById('finding-date').value,
                content: document.getElementById('finding-content').value,
                nextSteps: document.getElementById('finding-next-steps').value,
                weeklyTalk: document.getElementById('weekly-talk').value,
                connections: connections
            };
            
            if (findingForm.dataset.editingId) {
                // Update existing finding
                const findingId = parseInt(findingForm.dataset.editingId);
                const index = researchFindings.findIndex(f => f.id === findingId);
                
                if (index !== -1) {
                    findingData.id = findingId;
                    researchFindings[index] = findingData;
                }
            } else {
                // Add new finding
                const newId = researchFindings.length > 0 ? 
                    Math.max(...researchFindings.map(f => f.id)) + 1 : 1;
                
                findingData.id = newId;
                researchFindings.push(findingData);
            }
            
            closeFindingModal();
            renderPersonList();
            renderProjectList();
            
            // Refresh current view
            refreshCurrentView();
            
            // Save to localStorage
            saveToLocalStorage();
        }

        // FIXED: Save configuration function
        function saveConfiguration() {
            console.log('saveConfiguration function called');
            
            // Update lab members from form inputs
            const memberNameInputs = document.querySelectorAll('.member-name');
            const memberRoleInputs = document.querySelectorAll('.member-role');
            
            const newLabMembers = [];
            
            memberNameInputs.forEach((input, index) => {
                const name = input.value.trim();
                const role = memberRoleInputs[index] ? memberRoleInputs[index].value.trim() : '';
                const id = parseInt(input.dataset.id);
                
                console.log(`Processing member ${index}:`, { id, name, role });
                
                if (name) {
                    newLabMembers.push({
                        id: id,
                        name: name,
                        role: role || 'Researcher'
                    });
                }
            });
            
            // Update research projects from form inputs
            const projectNameInputs = document.querySelectorAll('.project-name');
            const projectDescInputs = document.querySelectorAll('.project-desc');
            
            const newResearchProjects = [];
            
            projectNameInputs.forEach((input, index) => {
                const name = input.value.trim();
                const description = projectDescInputs[index] ? projectDescInputs[index].value.trim() : '';
                const id = parseInt(input.dataset.id);
                
                console.log(`Processing project ${index}:`, { id, name, description });
                
                if (name) {
                    newResearchProjects.push({
                        id: id,
                        name: name,
                        description: description || 'Research project'
                    });
                }
            });
            
            // Validate we have at least one member and one project
            if (newLabMembers.length === 0) {
                alert('You must have at least one lab member.');
                return;
            }
            
            if (newResearchProjects.length === 0) {
                alert('You must have at least one research project.');
                return;
            }
            
            // Update the global arrays
            labMembers = newLabMembers;
            researchProjects = newResearchProjects;
            
            console.log('Saved labMembers:', labMembers);
            console.log('Saved researchProjects:', researchProjects);
            
            // Update UI
            renderPersonList();
            renderProjectList();
            populatePersonSelect();
            populateProjectSelect();
            populateFilterOptions();
            
            // Close modal
            configModal.style.display = 'none';
            
            // Save to localStorage
            saveToLocalStorage();
            
            // Show success message
            alert(`Configuration saved successfully! ${labMembers.length} team members and ${researchProjects.length} projects configured.`);
            
            // Refresh view
            refreshCurrentView();
        }

        // Save data to a file
        function saveDataToFile() {
            const data = {
                labMembers,
                researchProjects,
                researchFindings
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'lab_research_data.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            // Save to localStorage
            saveToLocalStorage();
            
            alert('Data saved successfully!');
        }

        // Load data from a file
        function loadDataFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (data.labMembers && data.researchProjects && data.researchFindings) {
                            labMembers = data.labMembers;
                            researchProjects = data.researchProjects;
                            researchFindings = data.researchFindings;
                            
                            renderPersonList();
                            renderProjectList();
                            populateFilterOptions();
                            
                            // Reset current view
                            currentSelection = null;
                            currentView = 'overview';
                            showOverview();
                            
                            // Save to localStorage
                            saveToLocalStorage();
                            
                            alert('Data loaded successfully!');
                        } else {
                            alert('Invalid data format!');
                        }
                    } catch (error) {
                        alert('Error loading data: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

// Website popout functionality
function openWebsitePopup() {
    // Replace this URL with your actual personal website URL
    const websiteUrl = 'RDtracker-config-v1.html';
    
    // Configure popup window settings
    const width = 1200;
    const height = 800;
    const left = (screen.width - width) / 2;
    const top = (screen.height - height) / 2;
    
    // Window features for the popup
    const features = `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes,toolbar=yes,menubar=yes,location=yes`;
    
    // Open the popup window
    const popupWindow = window.open(websiteUrl, 'MyPersonalWebsite', features);
    
    // Focus the window if it opened successfully
    if (popupWindow) {
        popupWindow.focus();
    } else {
        // If popup was blocked, show an alert and open in same window
        if (confirm('Popup was blocked. Would you like to open the website in this window instead?')) {
            window.location.href = websiteUrl;
        }
    }
}

        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>