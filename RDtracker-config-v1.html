<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Research Findings Tracker</title>
    <style>
        /* All CSS styles remain the same */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .sidebar {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            height: fit-content;
        }
        
        .content-area {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
            color: var(--primary-color);
        }
        
        .person-list, .project-list {
            list-style-type: none;
            margin-bottom: 20px;
        }
        
        .person-item, .project-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background-color: var(--light-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .person-item:hover, .project-item:hover {
            background-color: #d6dbdf;
        }
        
        .person-item.active, .project-item.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .findings-count {
            background-color: var(--accent-color);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .finding-card {
            background-color: white;
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .finding-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-right: 80px;
        }
        
        .finding-title {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
        }
        
        .finding-date {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .finding-content {
            margin-bottom: 10px;
        }
        
        .finding-connections {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .connection-tag {
            background-color: var(--light-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }
        
        .connection-tag i {
            margin-right: 5px;
            color: var(--secondary-color);
        }
        
        .add-finding-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            margin-top: 20px;
            transition: background-color 0.3s;
            width: 100%;
            justify-content: center;
        }
        
        .add-finding-btn:hover {
            background-color: #27ae60;
        }
        
        .add-finding-btn i {
            margin-right: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px 0;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            background: white;
            padding: 10px 0;
            z-index: 10;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            position: sticky;
            bottom: 0;
            background: white;
            padding: 10px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #bdc3c7;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #a6acaf;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-btn {
            background-color: var(--dark-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }
        
        .file-btn i {
            margin-right: 5px;
        }
        
        .file-btn:hover {
            background-color: #2c3e50;
        }
        
        .view-toggle {
            display: flex;
            margin-bottom: 15px;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background-color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .toggle-btn.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .summary-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .summary-title {
            font-size: 1.3rem;
            color: var(--primary-color);
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .recent-findings {
            margin-top: 20px;
        }
        
        .config-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            margin-left: 10px;
        }
        
        .config-btn i {
            margin-right: 5px;
        }
        
        .config-btn:hover {
            background-color: #c0392b;
        }
        
        .action-buttons {
            position: absolute;
            top: 15px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        
        .edit-btn {
            color: var(--secondary-color);
        }
        
        .edit-btn:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .delete-btn {
            color: var(--accent-color);
        }
        
        .delete-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
        }
        
        .inline-edit {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .inline-edit.active {
            display: block;
        }
        
        .inline-edit textarea {
            min-height: 80px;
        }
        
        .inline-edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .edit-field {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        
        .edit-field:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .welcome-message {
            background-color: #e8f4fd;
            border-left: 4px solid var(--secondary-color);
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .welcome-message h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .welcome-message ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .welcome-message li {
            margin-bottom: 8px;
        }
        
        /* Global search highlighting */
        .search-highlight {
            background-color: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
            border: 1px solid #ffeaa7;
            font-weight: 600;
        }
        
        .global-search {
            transition: all 0.3s ease;
            margin-top: 15px;
            max-width: 400px;
        }
        
        .global-search:focus-within {
            transform: scale(1.02);
        }
        
        .search-results-info {
            background-color: var(--light-color);
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            border-left: 4px solid var(--secondary-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .file-actions {
                flex-direction: column;
            }
            
            .summary-stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .action-buttons {
                position: static;
                justify-content: flex-end;
                margin-bottom: 10px;
            }
            
            .global-search {
                max-width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>Lab Research Findings Tracker</h1>
                    <p class="subtitle">Track, connect, and collaborate on research discoveries</p>
                    <!-- Global Search Bar -->
                    <div class="global-search">
                        <div style="position: relative;">
                            <input type="text" id="global-search" placeholder="Search across all findings..." 
                                   style="width: 100%; padding: 10px 40px 10px 15px; border: 1px solid #ddd; border-radius: 25px; font-size: 0.9rem;">
                            <i class="fas fa-search" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #7f8c8d;"></i>
                        </div>
                    </div>
                </div>
                <button class="config-btn" id="config-btn">
                    <i class="fas fa-cog"></i> Configure Lab
                </button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <div class="sidebar">
                <div class="view-toggle">
                    <button class="toggle-btn active" id="view-people">People</button>
                    <button class="toggle-btn" id="view-projects">Projects</button>
                </div>
                
                <div id="people-view">
                    <h2 class="section-title">Lab Members</h2>
                    <div class="search-box">
                        <input type="text" id="search-person" placeholder="Search team members...">
                    </div>
                    <ul class="person-list" id="person-list">
                        <!-- Person items will be populated by JavaScript -->
                    </ul>
                </div>
                
                <div id="projects-view" style="display: none;">
                    <h2 class="section-title">Research Projects</h2>
                    <div class="search-box">
                        <input type="text" id="search-project" placeholder="Search projects...">
                    </div>
                    <ul class="project-list" id="project-list">
                        <!-- Project items will be populated by JavaScript -->
                    </ul>
                </div>
                
                <button class="add-finding-btn" id="add-finding-btn">
                    <i class="fas fa-plus"></i> Add New Finding
                </button>
                
                <div class="file-actions">
                    <button class="file-btn" id="save-data">
                        <i class="fas fa-save"></i> Save Data
                    </button>
                    <button class="file-btn" id="load-data">
                        <i class="fas fa-folder-open"></i> Load Data
                    </button>
                    <button class="file-btn" id="clear-data" style="background-color: var(--accent-color);">
                        <i class="fas fa-trash"></i> Clear All Data
                    </button>
                </div>
            </div>
            
            <div class="content-area">
                <h2 class="section-title" id="view-title">Lab Overview</h2>
                <div id="findings-container">
                    <div id="overview-content">
                        <!-- Overview content will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for adding/editing findings -->
    <div class="modal" id="finding-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Finding</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <form id="finding-form">
                <div class="form-group">
                    <label for="finding-title">Title</label>
                    <input type="text" id="finding-title" required>
                </div>
                
                <div class="form-group">
                    <label for="finding-person">Team Member</label>
                    <select id="finding-person" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="finding-project">Project</label>
                    <select id="finding-project" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="finding-date">Date</label>
                    <input type="date" id="finding-date" required>
                </div>
                
                <div class="form-group">
                    <label for="finding-content">Finding Details</label>
                    <textarea id="finding-content" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="finding-next-steps">Next Steps / Approaches</label>
                    <textarea id="finding-next-steps"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="weekly-talk">Weekly Talk Content</label>
                    <textarea id="weekly-talk" placeholder="Summary of discussion from weekly one-on-one meeting"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Connect to Other Findings</label>
                    <div id="connection-options">
                        <!-- Connection checkboxes will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-finding">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Finding</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal for configuring lab members and projects - FIXED -->
    <div class="modal" id="config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Lab Settings</h2>
                <button class="close-modal" id="close-config-modal">&times;</button>
            </div>
            <div id="config-content">
                <div class="form-group">
                    <h3>Lab Members</h3>
                    <p class="help-text">Add your lab members to get started</p>
                    <div id="members-list">
                        <!-- Members list will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-member-btn" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Member
                    </button>
                </div>
                
                <div class="form-group">
                    <h3>Research Projects</h3>
                    <p class="help-text">Add your research projects to organize findings</p>
                    <div id="projects-config-list">
                        <!-- Projects list will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-secondary" id="add-project-btn" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> Add Project
                    </button>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-config">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-config-btn">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Empty data - users start with a blank slate
        let labMembers = [];
        let researchProjects = [];
        let researchFindings = [];

        // Global search variables
        let currentSearchTerm = '';
        let searchResults = [];

        // DOM elements
        const personList = document.getElementById('person-list');
        const projectList = document.getElementById('project-list');
        const findingsContainer = document.getElementById('findings-container');
        const overviewContent = document.getElementById('overview-content');
        const viewTitle = document.getElementById('view-title');
        const addFindingBtn = document.getElementById('add-finding-btn');
        const findingModal = document.getElementById('finding-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelFinding = document.getElementById('cancel-finding');
        const findingForm = document.getElementById('finding-form');
        const findingPersonSelect = document.getElementById('finding-person');
        const findingProjectSelect = document.getElementById('finding-project');
        const connectionOptions = document.getElementById('connection-options');
        const searchPersonInput = document.getElementById('search-person');
        const searchProjectInput = document.getElementById('search-project');
        const viewPeopleBtn = document.getElementById('view-people');
        const viewProjectsBtn = document.getElementById('view-projects');
        const peopleView = document.getElementById('people-view');
        const projectsView = document.getElementById('projects-view');
        const saveDataBtn = document.getElementById('save-data');
        const loadDataBtn = document.getElementById('load-data');
        const configBtn = document.getElementById('config-btn');
        const configModal = document.getElementById('config-modal');
        const closeConfigModal = document.getElementById('close-config-modal');
        const cancelConfig = document.getElementById('cancel-config');
        const membersList = document.getElementById('members-list');
        const projectsConfigList = document.getElementById('projects-config-list');
        const addMemberBtn = document.getElementById('add-member-btn');
        const addProjectBtn = document.getElementById('add-project-btn');
        const saveConfigBtn = document.getElementById('save-config-btn');

        // Current view state
        let currentView = 'overview'; // 'overview', 'people', or 'projects'
        let currentSelection = null; // ID of selected person or project

        // Save data to localStorage
        function saveToLocalStorage() {
            const data = {
                labMembers,
                researchProjects,
                researchFindings,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('labResearchData', JSON.stringify(data));
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('labResearchData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.labMembers && data.researchProjects && data.researchFindings) {
                        labMembers = data.labMembers;
                        researchProjects = data.researchProjects;
                        researchFindings = data.researchFindings;
                        return true;
                    }
                } catch (error) {
                    console.error('Error loading data from localStorage:', error);
                }
            }
            return false;
        }

        // Initialize the application
// Initialize the application
function init() {
    // Try to load data from localStorage first
    const loaded = loadFromLocalStorage();
    
    renderPersonList();
    renderProjectList();
    
    // Set default view to projects
    currentView = 'projects';
    showOverview(); // This will now show projects overview
    
    setupEventListeners();
    
    // Set today's date as default in the form
    document.getElementById('finding-date').valueAsDate = new Date();
    
    // Always open configuration modal on startup
    setTimeout(() => {
        configBtn.click();
    }, 500);
}

        // Global search functionality
        function performGlobalSearch(searchTerm) {
            currentSearchTerm = searchTerm.toLowerCase().trim();
            searchResults = [];
            
            if (!currentSearchTerm) {
                // If search is empty, clear highlights and show normal view
                clearSearchHighlights();
                refreshCurrentView();
                return;
            }
            
            // Search through all findings
            researchFindings.forEach(finding => {
                const searchableText = `
                    ${finding.title} 
                    ${finding.content} 
                    ${finding.nextSteps} 
                    ${finding.weeklyTalk || ''}
                `.toLowerCase();
                
                if (searchableText.includes(currentSearchTerm)) {
                    searchResults.push(finding.id);
                }
            });
            
            // Apply highlights and refresh view
            refreshCurrentViewWithSearch();
        }

        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            
            const regex = new RegExp(`(${escapeRegex(searchTerm)})`, 'gi');
            return text.replace(regex, '<mark class="search-highlight">$1</mark>');
        }

        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function clearSearchHighlights() {
            // This will be handled when we re-render without search terms
        }

        function refreshCurrentViewWithSearch() {
            if (currentView === 'overview') {
                showOverview();
            } else if (currentView === 'people' && currentSelection) {
                showPersonSummary(currentSelection);
            } else if (currentView === 'projects' && currentSelection) {
                showProjectSummary(currentSelection);
            }
        }

        // Clear search
        function clearSearch() {
            document.getElementById('global-search').value = '';
            currentSearchTerm = '';
            searchResults = [];
            refreshCurrentView();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This action cannot be undone!')) {
                if (confirm('This will permanently delete all lab members, projects, and findings. Are you absolutely sure?')) {
                    // Clear all data arrays
                    labMembers = [];
                    researchProjects = [];
                    researchFindings = [];
                    
                    // Clear localStorage
                    localStorage.removeItem('labResearchData');
                    
                    // Reset UI
                    renderPersonList();
                    renderProjectList();
                    currentSelection = null;
                    currentView = 'overview';
                    showOverview();
                    
                    alert('All data has been cleared successfully.');
                }
            }
        }

        // Render the list of lab members
        function renderPersonList(filter = '') {
            personList.innerHTML = '';
            
            if (labMembers.length === 0) {
                personList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-users"></i>
                        <p>No lab members yet</p>
                        <small>Click "Configure Lab" to add team members</small>
                    </div>
                `;
                return;
            }
            
            const filteredMembers = labMembers.filter(member => 
                member.name.toLowerCase().includes(filter.toLowerCase())
            );
            
            if (filteredMembers.length === 0) {
                personList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-search"></i>
                        <p>No matching team members</p>
                    </div>
                `;
                return;
            }
            
            filteredMembers.forEach(member => {
                const findingsCount = researchFindings.filter(f => f.personId === member.id).length;
                
                const li = document.createElement('li');
                li.className = 'person-item';
                li.dataset.id = member.id;
                li.innerHTML = `
                    <div>
                        <div class="person-name">${member.name}</div>
                        <div class="person-role">${member.role}</div>
                    </div>
                    <div class="findings-count">${findingsCount}</div>
                `;
                
                li.addEventListener('click', () => {
                    currentView = 'people';
                    currentSelection = member.id;
                    showPersonSummary(member.id);
                    updateViewToggle();
                });
                personList.appendChild(li);
            });
            
            // Populate the person select in the form
            populatePersonSelect();
        }

        // Render the list of projects
        function renderProjectList(filter = '') {
            projectList.innerHTML = '';
            
            if (researchProjects.length === 0) {
                projectList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-flask"></i>
                        <p>No projects yet</p>
                        <small>Click "Configure Lab" to add research projects</small>
                    </div>
                `;
                return;
            }
            
            const filteredProjects = researchProjects.filter(project => 
                project.name.toLowerCase().includes(filter.toLowerCase())
            );
            
            if (filteredProjects.length === 0) {
                projectList.innerHTML = `
                    <div class="empty-state" style="padding: 20px 10px;">
                        <i class="fas fa-search"></i>
                        <p>No matching projects</p>
                    </div>
                `;
                return;
            }
            
            filteredProjects.forEach(project => {
                const findingsCount = researchFindings.filter(f => f.projectId === project.id).length;
                
                const li = document.createElement('li');
                li.className = 'project-item';
                li.dataset.id = project.id;
                li.innerHTML = `
                    <div>
                        <div class="project-name">${project.name}</div>
                        <div class="project-description">${project.description}</div>
                    </div>
                    <div class="findings-count">${findingsCount}</div>
                `;
                
                li.addEventListener('click', () => {
                    currentView = 'projects';
                    currentSelection = project.id;
                    showProjectSummary(project.id);
                    updateViewToggle();
                });
                projectList.appendChild(li);
            });
            
            // Populate the project select in the form
            populateProjectSelect();
        }

        // Populate the person select in the form
        function populatePersonSelect() {
            findingPersonSelect.innerHTML = '';
            
            if (labMembers.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No team members available';
                option.disabled = true;
                option.selected = true;
                findingPersonSelect.appendChild(option);
                return;
            }
            
            labMembers.forEach(member => {
                const option = document.createElement('option');
                option.value = member.id;
                option.textContent = member.name;
                findingPersonSelect.appendChild(option);
            });
        }

        // Populate the project select in the form
        function populateProjectSelect() {
            findingProjectSelect.innerHTML = '';
            
            if (researchProjects.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'No projects available';
                option.disabled = true;
                option.selected = true;
                findingProjectSelect.appendChild(option);
                return;
            }
            
            researchProjects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                findingProjectSelect.appendChild(option);
            });
        }

        // FIXED: Render configuration for lab members
        function renderMembersConfig() {
            console.log('Rendering members config, current members:', labMembers);
            membersList.innerHTML = '';
            
            labMembers.forEach((member) => {
                const memberDiv = document.createElement('div');
                memberDiv.className = 'form-group';
                memberDiv.style.display = 'flex';
                memberDiv.style.gap = '10px';
                memberDiv.style.alignItems = 'center';
                
                memberDiv.innerHTML = `
                    <input type="text" value="${member.name}" class="member-name" data-id="${member.id}" placeholder="Name" style="flex: 2;">
                    <input type="text" value="${member.role}" class="member-role" data-id="${member.id}" placeholder="Role" style="flex: 1;">
                    <button type="button" class="btn btn-secondary remove-member" data-id="${member.id}" style="padding: 5px 10px;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                // Add event listener for remove button
                const removeBtn = memberDiv.querySelector('.remove-member');
                removeBtn.addEventListener('click', () => {
                    const memberId = parseInt(removeBtn.dataset.id);
                    console.log('Remove member clicked:', memberId);
                    
                    if (researchFindings.some(f => f.personId === memberId)) {
                        alert('Cannot remove a team member who has findings recorded. Please reassign their findings first.');
                        return;
                    }
                    
                    if (labMembers.length <= 1) {
                        alert('You must have at least one lab member.');
                        return;
                    }
                    
                    labMembers = labMembers.filter(m => m.id !== memberId);
                    renderMembersConfig();
                });
                
                membersList.appendChild(memberDiv);
            });
        }

        // FIXED: Render configuration for projects
        function renderProjectsConfig() {
            console.log('Rendering projects config, current projects:', researchProjects);
            projectsConfigList.innerHTML = '';
            
            researchProjects.forEach((project) => {
                const projectDiv = document.createElement('div');
                projectDiv.className = 'form-group';
                projectDiv.style.display = 'flex';
                projectDiv.style.gap = '10px';
                projectDiv.style.alignItems = 'center';
                
                projectDiv.innerHTML = `
                    <input type="text" value="${project.name}" class="project-name" data-id="${project.id}" placeholder="Project Name" style="flex: 2;">
                    <input type="text" value="${project.description}" class="project-desc" data-id="${project.id}" placeholder="Description" style="flex: 2;">
                    <button type="button" class="btn btn-secondary remove-project" data-id="${project.id}" style="padding: 5px 10px;">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                // Add event listener for remove button
                const removeBtn = projectDiv.querySelector('.remove-project');
                removeBtn.addEventListener('click', () => {
                    const projectId = parseInt(removeBtn.dataset.id);
                    console.log('Remove project clicked:', projectId);
                    
                    if (researchFindings.some(f => f.projectId === projectId)) {
                        alert('Cannot remove a project that has findings recorded. Please reassign the findings first.');
                        return;
                    }
                    
                    if (researchProjects.length <= 1) {
                        alert('You must have at least one project.');
                        return;
                    }
                    
                    researchProjects = researchProjects.filter(p => p.id !== projectId);
                    renderProjectsConfig();
                });
                
                projectsConfigList.appendChild(projectDiv);
            });
        }

        // Show the overview dashboard
// Show the overview dashboard
function showOverview() {
    currentSelection = null;
    
    // If currentView is not set, default to projects
    if (!currentView) {
        currentView = 'projects';
    }
    
    // Set the view toggle to match currentView
    updateViewToggle();
    
    // Show the appropriate view based on currentView
    if (currentView === 'projects') {
        viewTitle.textContent = 'Projects Overview';
        showProjectsOverview();
    } else if (currentView === 'people') {
        viewTitle.textContent = 'People Overview';
        showPeopleOverview();
    } else {
        viewTitle.textContent = 'Lab Overview';
        showLabOverview();
    }
}

// Show projects overview
function showProjectsOverview() {
    let html = '';
    
    if (researchProjects.length === 0) {
        html = `
            <div class="welcome-message">
                <h3>Welcome to the Lab Research Findings Tracker!</h3>
                <p>No projects configured yet. Use the configuration panel to add your research projects.</p>
            </div>
        `;
    } else {
        // Summary statistics for projects
        const totalProjects = researchProjects.length;
        const totalFindings = researchFindings.length;
        const projectsWithFindings = researchProjects.filter(project => 
            researchFindings.some(f => f.projectId === project.id)
        ).length;
        
        html = `
            <div class="summary-card">
                <div class="summary-header">
                    <div class="summary-title">Projects Summary</div>
                </div>
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-value">${totalProjects}</div>
                        <div class="stat-label">Total Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalFindings}</div>
                        <div class="stat-label">Total Findings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${projectsWithFindings}</div>
                        <div class="stat-label">Active Projects</div>
                    </div>
                </div>
            </div>
            
            <div class="summary-card">
                <div class="summary-header">
                    <div class="summary-title">All Projects</div>
                </div>
        `;
        
        researchProjects.forEach(project => {
            const projectFindings = researchFindings.filter(f => f.projectId === project.id);
            const teamMembers = [...new Set(projectFindings.map(f => f.personId))].length;
            
            html += `
                <div class="finding-card" style="cursor: pointer;" onclick="showProjectSummary(${project.id})">
                    <div class="finding-header">
                        <div class="finding-title">${project.name}</div>
                        <div class="finding-date">${projectFindings.length} findings</div>
                    </div>
                    <div class="finding-content">${project.description}</div>
                    <div class="finding-connections">
                        <div class="connection-tag">
                            <i class="fas fa-flask"></i> ${projectFindings.length} Findings
                        </div>
                        <div class="connection-tag">
                            <i class="fas fa-users"></i> ${teamMembers} Team Members
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += `</div>`;
        
        // Recent findings across all projects
        const recentFindings = researchFindings
            .sort((a, b) => new Date(b.date) - new Date(a.date))
            .slice(0, 5);
            
        if (recentFindings.length > 0) {
            html += `
                <div class="summary-card">
                    <div class="summary-header">
                        <div class="summary-title">Recent Findings Across All Projects</div>
                    </div>
            `;
            
            recentFindings.forEach(finding => {
                const person = labMembers.find(m => m.id === finding.personId);
                const project = researchProjects.find(p => p.id === finding.projectId);
                
                html += `
                    <div class="finding-card">
                        <div class="finding-header">
                            <div class="finding-title">${finding.title}</div>
                            <div class="finding-date">${formatDate(finding.date)}</div>
                        </div>
                        <div class="finding-content">${finding.content}</div>
                        <div class="finding-connections">
                            <div class="connection-tag">
                                <i class="fas fa-user"></i> ${person ? person.name : 'Unknown'}
                            </div>
                            <div class="connection-tag">
                                <i class="fas fa-flask"></i> ${project ? project.name : 'Unknown'}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
        }
    }
    
    // Add search results info if we're searching
    if (currentSearchTerm && searchResults.length > 0) {
        html = `
            <div class="search-results-info">
                Found ${searchResults.length} results for "${currentSearchTerm}"
                <button class="btn btn-secondary" id="clear-search" style="margin-left: 10px; padding: 5px 10px;">Clear Search</button>
            </div>
        ` + html;
    }
    
    overviewContent.innerHTML = html;
    
    // Add event listener for clear search button if it exists
    const clearSearchBtn = document.getElementById('clear-search');
    if (clearSearchBtn) {
        clearSearchBtn.addEventListener('click', clearSearch);
    }
}

        // Show findings for a specific person
        function showPersonSummary(personId) {
            const person = labMembers.find(m => m.id === personId);
            if (!person) return;
            
            currentView = 'people';
            currentSelection = personId;
            viewTitle.textContent = `${person.name}'s Findings`;
            
            const personFindings = researchFindings.filter(f => f.personId === personId);
            
            let html = `
                <div class="summary-card">
                    <div class="summary-header">
                        <div class="summary-title">${person.name} - ${person.role}</div>
                    </div>
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-value">${personFindings.length}</div>
                            <div class="stat-label">Total Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${new Set(personFindings.map(f => f.projectId)).size}</div>
                            <div class="stat-label">Projects</div>
                        </div>
                    </div>
                </div>
            `;
            
            if (personFindings.length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No Findings Yet</h3>
                        <p>${person.name} hasn't recorded any findings yet</p>
                    </div>
                `;
            } else {
                // Group findings by project
                const findingsByProject = {};
                personFindings.forEach(finding => {
                    if (!findingsByProject[finding.projectId]) {
                        findingsByProject[finding.projectId] = [];
                    }
                    findingsByProject[finding.projectId].push(finding);
                });
                
                // Display findings grouped by project
                Object.keys(findingsByProject).forEach(projectId => {
                    const project = researchProjects.find(p => p.id === parseInt(projectId));
                    const projectFindings = findingsByProject[projectId];
                    
                    html += `
                        <div class="summary-card">
                            <div class="summary-header">
                                <div class="summary-title">${project ? project.name : 'Unknown Project'}</div>
                            </div>
                    `;
                    
                    projectFindings.forEach(finding => {
                        let findingContent = finding.content;
                        let nextSteps = finding.nextSteps;
                        let weeklyTalk = finding.weeklyTalk || '';
                        
                        if (currentSearchTerm && searchResults.includes(finding.id)) {
                            findingContent = highlightText(findingContent, currentSearchTerm);
                            nextSteps = highlightText(nextSteps, currentSearchTerm);
                            weeklyTalk = highlightText(weeklyTalk, currentSearchTerm);
                        }
                        
                        html += `
                            <div class="finding-card">
                                <div class="finding-header">
                                    <div class="finding-title">${finding.title}</div>
                                    <div class="finding-date">${formatDate(finding.date)}</div>
                                </div>
                                <div class="finding-content">${findingContent}</div>
                                ${finding.nextSteps ? `<div class="finding-content"><strong>Next Steps:</strong> ${nextSteps}</div>` : ''}
                                ${finding.weeklyTalk ? `<div class="finding-content"><strong>Weekly Discussion:</strong> ${weeklyTalk}</div>` : ''}
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                });
            }
            
            // Add search results info if we're searching
            if (currentSearchTerm && searchResults.length > 0) {
                html = `
                    <div class="search-results-info">
                        Found ${searchResults.length} results for "${currentSearchTerm}"
                        <button class="btn btn-secondary" id="clear-search" style="margin-left: 10px; padding: 5px 10px;">Clear Search</button>
                    </div>
                ` + html;
            }
            
            findingsContainer.innerHTML = html;
            
            // Add event listener for clear search button if it exists
            const clearSearchBtn = document.getElementById('clear-search');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
        }

        // Show findings for a specific project
        function showProjectSummary(projectId) {
            const project = researchProjects.find(p => p.id === projectId);
            if (!project) return;
            
            currentView = 'projects';
            currentSelection = projectId;
            viewTitle.textContent = `${project.name} Findings`;
            
            const projectFindings = researchFindings.filter(f => f.projectId === projectId);
            
            let html = `
                <div class="summary-card">
                    <div class="summary-header">
                        <div class="summary-title">${project.name}</div>
                    </div>
                    <div class="finding-content">${project.description}</div>
                    <div class="summary-stats" style="margin-top: 15px;">
                        <div class="stat-card">
                            <div class="stat-value">${projectFindings.length}</div>
                            <div class="stat-label">Total Findings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${new Set(projectFindings.map(f => f.personId)).size}</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                    </div>
                </div>
            `;
            
            if (projectFindings.length === 0) {
                html += `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No Findings Yet</h3>
                        <p>No findings have been recorded for this project yet</p>
                    </div>
                `;
            } else {
                // Group findings by person
                const findingsByPerson = {};
                projectFindings.forEach(finding => {
                    if (!findingsByPerson[finding.personId]) {
                        findingsByPerson[finding.personId] = [];
                    }
                    findingsByPerson[finding.personId].push(finding);
                });
                
                // Display findings grouped by person
                Object.keys(findingsByPerson).forEach(personId => {
                    const person = labMembers.find(m => m.id === parseInt(personId));
                    const personFindings = findingsByPerson[personId];
                    
                    html += `
                        <div class="summary-card">
                            <div class="summary-header">
                                <div class="summary-title">${person ? person.name : 'Unknown Team Member'}</div>
                            </div>
                    `;
                    
                    personFindings.forEach(finding => {
                        let findingContent = finding.content;
                        let nextSteps = finding.nextSteps;
                        let weeklyTalk = finding.weeklyTalk || '';
                        
                        if (currentSearchTerm && searchResults.includes(finding.id)) {
                            findingContent = highlightText(findingContent, currentSearchTerm);
                            nextSteps = highlightText(nextSteps, currentSearchTerm);
                            weeklyTalk = highlightText(weeklyTalk, currentSearchTerm);
                        }
                        
                        html += `
                            <div class="finding-card">
                                <div class="finding-header">
                                    <div class="finding-title">${finding.title}</div>
                                    <div class="finding-date">${formatDate(finding.date)}</div>
                                </div>
                                <div class="finding-content">${findingContent}</div>
                                ${finding.nextSteps ? `<div class="finding-content"><strong>Next Steps:</strong> ${nextSteps}</div>` : ''}
                                ${finding.weeklyTalk ? `<div class="finding-content"><strong>Weekly Discussion:</strong> ${weeklyTalk}</div>` : ''}
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                });
            }
            
            // Add search results info if we're searching
            if (currentSearchTerm && searchResults.length > 0) {
                html = `
                    <div class="search-results-info">
                        Found ${searchResults.length} results for "${currentSearchTerm}"
                        <button class="btn btn-secondary" id="clear-search" style="margin-left: 10px; padding: 5px 10px;">Clear Search</button>
                    </div>
                ` + html;
            }
            
            findingsContainer.innerHTML = html;
            
            // Add event listener for clear search button if it exists
            const clearSearchBtn = document.getElementById('clear-search');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
        }

        // Update the view toggle buttons
// Update the view toggle buttons
function updateViewToggle() {
    // Reset all buttons
    viewPeopleBtn.classList.remove('active');
    viewProjectsBtn.classList.remove('active');
    
    // Show/hide views and set active button
    if (currentView === 'projects') {
        peopleView.style.display = 'none';
        projectsView.style.display = 'block';
        viewProjectsBtn.classList.add('active');
    } else if (currentView === 'people') {
        peopleView.style.display = 'block';
        projectsView.style.display = 'none';
        viewPeopleBtn.classList.add('active');
    } else {
        // For overview, show people view but highlight based on currentView
        peopleView.style.display = 'block';
        projectsView.style.display = 'none';
        if (currentView === 'people') {
            viewPeopleBtn.classList.add('active');
        } else {
            viewProjectsBtn.classList.add('active');
        }
    }
}

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Refresh the current view
        function refreshCurrentView() {
            if (currentView === 'overview') {
                showOverview();
            } else if (currentView === 'people' && currentSelection) {
                showPersonSummary(currentSelection);
            } else if (currentView === 'projects' && currentSelection) {
                showProjectSummary(currentSelection);
            }
        }

        // FIXED: Setup event listeners - this is called only once during initialization
        function setupEventListeners() {
            // Add finding button
            addFindingBtn.addEventListener('click', () => {
                if (labMembers.length === 0 || researchProjects.length === 0) {
                    alert('Please configure lab members and projects first before adding findings.');
                    configModal.style.display = 'flex';
                    return;
                }
                
                document.getElementById('modal-title').textContent = 'Add New Finding';
                findingForm.reset();
                document.getElementById('finding-date').valueAsDate = new Date();
                findingModal.style.display = 'flex';
            });

            // Close modal buttons
            closeModal.addEventListener('click', () => {
                findingModal.style.display = 'none';
            });

            cancelFinding.addEventListener('click', () => {
                findingModal.style.display = 'none';
            });

            // Form submission
            findingForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const title = document.getElementById('finding-title').value;
                const personId = parseInt(document.getElementById('finding-person').value);
                const projectId = parseInt(document.getElementById('finding-project').value);
                const date = document.getElementById('finding-date').value;
                const content = document.getElementById('finding-content').value;
                const nextSteps = document.getElementById('finding-next-steps').value;
                const weeklyTalk = document.getElementById('weekly-talk').value;
                
                // Create new finding
                const newFinding = {
                    id: Date.now(), // Simple ID generation
                    title,
                    personId,
                    projectId,
                    date,
                    content,
                    nextSteps,
                    weeklyTalk,
                    connections: [] // For future implementation
                };
                
                researchFindings.push(newFinding);
                saveToLocalStorage();
                
                // Update UI
                renderPersonList();
                renderProjectList();
                refreshCurrentView();
                
                // Close modal
                findingModal.style.display = 'none';
                
                // Show success message
                alert('Finding added successfully!');
            });

            // Search functionality
            searchPersonInput.addEventListener('input', (e) => {
                renderPersonList(e.target.value);
            });

            searchProjectInput.addEventListener('input', (e) => {
                renderProjectList(e.target.value);
            });

            // View toggle
// View toggle
viewPeopleBtn.addEventListener('click', () => {
    currentView = 'people';
    currentSelection = null;
    showOverview();
});

viewProjectsBtn.addEventListener('click', () => {
    currentView = 'projects';
    currentSelection = null;
    showOverview();
});

            viewProjectsBtn.addEventListener('click', () => {
                currentView = 'projects';
                currentSelection = null;
                showOverview();
            });

            // Data management
            saveDataBtn.addEventListener('click', () => {
                saveToLocalStorage();
                alert('Data saved successfully!');
            });

            loadDataBtn.addEventListener('click', () => {
                if (loadFromLocalStorage()) {
                    renderPersonList();
                    renderProjectList();
                    refreshCurrentView();
                    alert('Data loaded successfully!');
                } else {
                    alert('No saved data found.');
                }
            });

            // Clear data button
            document.getElementById('clear-data').addEventListener('click', clearAllData);

            // Configuration modal
            configBtn.addEventListener('click', () => {
                // Ensure we have at least one member and project
                if (labMembers.length === 0) {
                    labMembers.push({
                        id: Date.now(),
                        name: '',
                        role: 'Researcher'
                    });
                }
                
                if (researchProjects.length === 0) {
                    researchProjects.push({
                        id: Date.now(),
                        name: '',
                        description: ''
                    });
                }
                
                renderMembersConfig();
                renderProjectsConfig();
                configModal.style.display = 'flex';
            });

            closeConfigModal.addEventListener('click', () => {
                configModal.style.display = 'none';
            });

            cancelConfig.addEventListener('click', () => {
                configModal.style.display = 'none';
            });

            // Add member button
            addMemberBtn.addEventListener('click', () => {
                const newId = Date.now();
                labMembers.push({
                    id: newId,
                    name: '',
                    role: 'Researcher'
                });
                renderMembersConfig();
            });

            // Add project button
            addProjectBtn.addEventListener('click', () => {
                const newId = Date.now();
                researchProjects.push({
                    id: newId,
                    name: '',
                    description: ''
                });
                renderProjectsConfig();
            });

            // FIXED: Save configuration - this listener is attached only once
            saveConfigBtn.addEventListener('click', () => {
                console.log('Save configuration clicked');
                
                // Collect member data
                const memberInputs = membersList.querySelectorAll('.member-name, .member-role');
                const membersData = [];
                
                for (let i = 0; i < memberInputs.length; i += 2) {
                    const nameInput = memberInputs[i];
                    const roleInput = memberInputs[i+1];
                    
                    if (nameInput.value.trim() === '') {
                        alert('All team members must have a name.');
                        nameInput.focus();
                        return;
                    }
                    
                    membersData.push({
                        id: parseInt(nameInput.dataset.id),
                        name: nameInput.value.trim(),
                        role: roleInput.value.trim() || 'Researcher'
                    });
                }
                
                // Collect project data
                const projectInputs = projectsConfigList.querySelectorAll('.project-name, .project-desc');
                const projectsData = [];
                
                for (let i = 0; i < projectInputs.length; i += 2) {
                    const nameInput = projectInputs[i];
                    const descInput = projectInputs[i+1];
                    
                    if (nameInput.value.trim() === '') {
                        alert('All projects must have a name.');
                        nameInput.focus();
                        return;
                    }
                    
                    projectsData.push({
                        id: parseInt(nameInput.dataset.id),
                        name: nameInput.value.trim(),
                        description: descInput.value.trim()
                    });
                }
                
                // Update the global arrays
                labMembers = membersData;
                researchProjects = projectsData;
                
                // Save to localStorage
                saveToLocalStorage();
                
                // Update UI
                renderPersonList();
                renderProjectList();
                populatePersonSelect();
                populateProjectSelect();
                refreshCurrentView();
                
                // Close modal
                configModal.style.display = 'none';
                
                // Show success message
                alert('Configuration saved successfully!');
            });

            // Global search
            document.getElementById('global-search').addEventListener('input', (e) => {
                performGlobalSearch(e.target.value);
            });
        }

        // Initialize the application
        init();
    </script>
</body>
</html>