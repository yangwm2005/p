<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowFocus | Advanced Productivity Timer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px; /* Space for status bar */
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            flex: 1;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo i {
            color: var(--primary);
            font-size: 28px;
        }

        h1 {
            color: var(--primary);
            font-size: 2.2rem;
            font-weight: 700;
        }

        .tagline {
            color: var(--gray);
            font-size: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .timer-card {
                position: static !important;
            }
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            height: fit-content;
        }

        .timer-card {
            position: sticky;
            top: 20px;
            z-index: 10;
        }

        .card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-display {
            font-size: 4.5rem;
            font-weight: 700;
            text-align: center;
            color: var(--primary);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.5s ease;
        }

        .timer-display.time-up {
            animation: flash 1s infinite alternate;
            color: var(--danger);
        }

        @keyframes flash {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0.7; transform: scale(1.05); }
        }

        .mode-indicator {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .focus-mode {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .break-mode {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning);
        }

        .progress-container {
            margin: 25px 0;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--gray-light);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.5s ease;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #3aa8d1;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e6890e;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #e11574;
        }

        .btn-info {
            background-color: var(--success);
            color: white;
        }

        .btn-info:hover {
            background-color: #3aa8d1;
        }

        .timer-settings {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .setting-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .setting-group input {
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            width: 80px;
            text-align: center;
            font-weight: 600;
            transition: var(--transition);
        }

        .setting-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .sound-toggle {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .sound-toggle:hover {
            background: var(--gray-light);
        }

        .sound-toggle input {
            margin: 0;
        }

        .sound-toggle label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .task-form {
            margin-bottom: 20px;
        }

        .task-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .task-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .task-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .task-notes-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 60px;
        }

        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .task-item:hover {
            background-color: var(--gray-light);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .task-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            flex: 1;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            margin-top: 2px;
        }

        .task-details {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .task-notes {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 4px;
        }

        .task-note-line {
            display: block;
            margin-bottom: 4px;
            padding-left: 10px;
            position: relative;
        }

        .task-note-line:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .task-completed .task-name {
            text-decoration: line-through;
            color: var(--gray);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 1rem;
            transition: var(--transition);
            padding: 6px;
            border-radius: 4px;
        }

        .icon-btn:hover {
            color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .quick-note-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-note-btn:hover {
            background: var(--secondary);
        }

        .records-container {
            margin-top: 30px;
        }

        .data-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .project-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .project-selector select {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
        }

        .records-table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            table-layout: fixed;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
            vertical-align: top;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            position: sticky;
            top: 0;
        }

        /* Column width adjustments */
        .col-date { width: 120px; }
        .col-project { width: 140px; }
        .col-focus { width: 80px; }
        .col-break { width: 80px; }
        .col-tasks { width: 100px; }
        .col-project-notes { width: 150px; }
        .col-task-notes { width: auto; min-width: 300px; }
        .col-actions { width: 60px; }

        tr {
            transition: var(--transition);
        }

        tr:not(:first-child):hover {
            background-color: rgba(67, 97, 238, 0.03);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray-light);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }

        .stat-item {
            padding: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .session-task-item {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px;
        }

        .session-task-content {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            flex: 1;
        }

        .session-task-details {
            flex: 1;
        }

        .session-task-completed {
            text-decoration: line-through;
            color: var(--gray);
        }

        .session-task-notes {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 2px;
            margin-left: 20px;
        }

        .task-note-bullet {
            display: block;
            margin-bottom: 2px;
            padding-left: 12px;
            position: relative;
            font-size: 0.8rem;
        }

        .task-note-bullet:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .project-notes-cell {
            max-height: 100px;
            overflow-y: auto;
            font-size: 0.85rem;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
        }

        /* Quick Note Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
            transform: translateY(-20px);
            transition: var(--transition);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-task-name {
            font-weight: 600;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: 6px;
        }

        .modal-notes-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 10px;
        }

        .modal-notes-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .notes-help {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Report Modal */
        .report-modal {
            max-width: 900px;
        }

        .report-section {
            margin-bottom: 25px;
        }

        .report-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-light);
        }

        .project-report {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .project-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .project-stats {
            display: flex;
            gap: 15px;
        }

        .project-stat {
            text-align: center;
        }

        .project-stat-value {
            font-weight: 700;
            color: var(--primary);
        }

        .project-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .task-report {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .task-report-item {
            margin-bottom: 10px;
            padding: 8px;
            border-left: 3px solid var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .task-report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .task-report-name {
            font-weight: 600;
        }

        .task-report-status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--success);
            color: white;
        }

        .task-report-status.incomplete {
            background: var(--gray);
        }

        .task-report-notes {
            margin-top: 5px;
        }

        .note-highlight {
            background: rgba(255, 235, 59, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
            margin: 2px 0;
        }

        .report-summary {
            background: var(--primary-light);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .summary-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .summary-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Continue Tasks Section */
        .continue-tasks-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
        }

        .continue-tasks-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .continue-task-item {
            background: rgba(76, 201, 240, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .continue-task-info {
            flex: 1;
        }

        .continue-task-name {
            font-weight: 500;
        }

        .continue-task-project {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .continue-task-actions {
            display: flex;
            gap: 5px;
        }

        /* Status Bar (Bottom Fixed) */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            z-index: 1001;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .status-bar.hidden {
            transform: translateY(100%);
        }

        .status-bar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-bar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-timer {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            min-width: 80px;
        }

        .status-mode {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
        }

        .status-progress {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .status-progress-bar {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.5s ease;
        }

        .status-controls {
            display: flex;
            gap: 8px;
        }

        .status-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .status-toggle {
            position: fixed;
            bottom: 70px;
            right: 20px;
            z-index: 1002;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .status-toggle:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        /* Time-up notification */
        .time-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--danger);
            color: white;
            padding: 30px 50px;
            border-radius: var(--border-radius);
            font-size: 2rem;
            font-weight: 700;
            z-index: 1003;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: pulse 0.5s infinite alternate;
            text-align: center;
        }

        @keyframes pulse {
            from { transform: translate(-50%, -50%) scale(1); }
            to { transform: translate(-50%, -50%) scale(1.1); }
        }

        .time-up-notification.hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .timer-card {
                position: static !important;
            }
            
            .timer-display {
                font-size: 3.5rem;
            }
            
            .timer-controls {
                flex-wrap: wrap;
            }
            
            .timer-settings {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .task-input-group {
                flex-direction: column;
            }
            
            .data-actions {
                flex-direction: column;
            }
            
            .task-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .task-actions {
                margin-top: 10px;
                align-self: flex-end;
            }
            
            th, td {
                padding: 10px 6px;
                font-size: 0.8rem;
            }
            
            .col-date { width: 100px; }
            .col-project { width: 120px; }
            .col-focus { width: 70px; }
            .col-break { width: 70px; }
            .col-tasks { width: 90px; }
            .col-project-notes { width: 130px; }
            .col-task-notes { width: auto; min-width: 200px; }
            .col-actions { width: 50px; }

            .project-stats, .summary-stats {
                flex-wrap: wrap;
                gap: 10px;
            }

            .status-bar {
                padding: 10px 15px;
            }

            .status-timer {
                font-size: 1.2rem;
                min-width: 70px;
            }

            .status-progress {
                width: 100px;
            }

            .status-controls {
                gap: 5px;
            }

            .status-btn {
                padding: 4px 8px;
                font-size: 0.7rem;
            }

            .status-toggle {
                bottom: 60px;
                right: 15px;
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 480px) {
            .status-bar {
                flex-direction: column;
                gap: 10px;
                padding: 8px 15px;
            }

            .status-bar-left, .status-bar-right {
                width: 100%;
                justify-content: space-between;
            }

            .status-progress {
                width: 80px;
            }
        }

        /* Time-up flash animation */
        @keyframes timeUpFlash {
            0%, 100% { background-color: white; }
            50% { background-color: rgba(247, 37, 133, 0.1); }
        }

        .time-up-flash {
            animation: timeUpFlash 1s ease 3;
        }
    </style>
</head>
<body>
    <!-- Status Bar Toggle Button -->
    <button class="status-toggle" id="status-toggle">
        <i class="fas fa-eye"></i>
    </button>

    <!-- Status Bar (Bottom Fixed) -->
    <div class="status-bar" id="status-bar">
        <div class="status-bar-left">
            <div class="status-timer" id="status-timer">25:00</div>
            <div class="status-mode focus-mode" id="status-mode">Focus Time</div>
            <div class="status-progress">
                <div class="status-progress-bar" id="status-progress"></div>
            </div>
        </div>
        <div class="status-bar-right">
            <div class="status-controls">
                <button class="status-btn" id="status-play-pause">
                    <i class="fas fa-play"></i>
                </button>
                <button class="status-btn" id="status-reset">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Time-up Notification -->
    <div class="time-up-notification hidden" id="time-up-notification">
        TIME'S UP!
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-hourglass-half"></i>
                <h1>FlowFocus</h1>
            </div>
            <p class="tagline">Maximize productivity with focused work sessions and strategic breaks</p>
        </header>
        
        <div class="app-container">
            <!-- Timer Card - Now Sticky -->
            <div class="card timer-card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-clock"></i> Focus Timer</h2>
                    <div id="mode-indicator" class="mode-indicator focus-mode">Focus Time</div>
                </div>
                
                <div class="timer-display" id="timer-display">25:00</div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress" id="progress-bar"></div>
                    </div>
                </div>
                
                <div class="timer-controls">
                    <button id="start-btn" class="btn btn-primary">
                        <i class="fas fa-play"></i> Start Focus
                    </button>
                    <button id="start-break-btn" class="btn btn-info">
                        <i class="fas fa-coffee"></i> Start Break
                    </button>
                    <button id="pause-btn" class="btn btn-secondary">
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button id="reset-btn" class="btn btn-danger">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                    <button id="finish-session-btn" class="btn btn-warning">
                        <i class="fas fa-flag-checkered"></i> Finish Session
                    </button>
                </div>
                
                <div class="timer-settings">
                    <div class="setting-group">
                        <label for="focus-time"><i class="fas fa-bullseye"></i> Focus (min)</label>
                        <input type="number" id="focus-time" min="5" max="90" value="25">
                    </div>
                    <div class="setting-group">
                        <label for="break-time"><i class="fas fa-coffee"></i> Break (min)</label>
                        <input type="number" id="break-time" min="1" max="30" value="5">
                    </div>
                    <div class="sound-toggle">
                        <input type="checkbox" id="tick-sound-toggle" checked>
                        <label for="tick-sound-toggle">Tick Sound</label>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="focus-sessions">0</div>
                        <div class="stat-label">Focus Sessions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-time">0:00</div>
                        <div class="stat-label">Total Time</div>
                    </div>
                </div>
            </div>
            
            <!-- Project & Tasks Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-tasks"></i> Project & Tasks</h2>
                </div>
                
                <div class="form-group">
                    <label for="project-name">Project Name</label>
                    <input type="text" id="project-name" placeholder="What are you working on?">
                </div>
                
                <div class="form-group">
                    <label for="project-notes">Project Notes</label>
                    <textarea id="project-notes" placeholder="Add details about your project..."></textarea>
                </div>
                
                <div class="task-form">
                    <div class="task-input-group">
                        <input type="text" id="task-input" class="task-input" placeholder="Add a task...">
                        <button id="add-task-btn" class="btn btn-success">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                    <textarea id="task-notes-input" class="task-notes-input" placeholder="Task notes (optional) - Use separate lines for key points"></textarea>
                    <div class="notes-help">Tip: Use separate lines for different key points. Each line will be displayed as a bullet point.</div>
                </div>
                
                <div class="task-list" id="task-list">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>No tasks yet. Add tasks to track your progress.</p>
                    </div>
                </div>
                
                <button id="save-record-btn" class="btn btn-primary" style="width: 100%; margin-top: 15px;">
                    <i class="fas fa-save"></i> Save Session
                </button>

                <!-- Continue Tasks Section -->
                <div class="continue-tasks-section" id="continue-tasks-section" style="display: none;">
                    <h3 class="continue-tasks-title"><i class="fas fa-redo"></i> Continue Unfinished Tasks</h3>
                    <div id="continue-tasks-list">
                        <!-- Continue tasks will be added here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Session History Card -->
        <div class="card records-container">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-history"></i> Session History</h2>
                <div class="data-actions">
                    <button id="export-btn" class="btn btn-secondary">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button id="import-btn" class="btn btn-secondary">
                        <i class="fas fa-upload"></i> Import
                    </button>
                    <button id="clean-storage-btn" class="btn btn-danger">
                        <i class="fas fa-broom"></i> Clean Storage
                    </button>
                    <button id="report-btn" class="btn btn-primary">
                        <i class="fas fa-chart-bar"></i> View Report
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                </div>
            </div>
            
            <div class="project-selector">
                <label for="project-filter">Filter by Project:</label>
                <select id="project-filter">
                    <option value="all">All Projects</option>
                </select>
            </div>
            
            <div class="records-table-container">
                <table id="records-table">
                    <thead>
                        <tr>
                            <th class="col-date">Date</th>
                            <th class="col-project">Project</th>
                            <th class="col-focus">Focus</th>
                            <th class="col-break">Break</th>
                            <th class="col-tasks">Tasks</th>
                            <th class="col-project-notes">Project Notes</th>
                            <th class="col-task-notes">Task Details & Notes</th>
                            <th class="col-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="records-body">
                        <tr>
                            <td colspan="8" class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No sessions recorded yet. Complete a focus session to see it here.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Dr. Wen-Ming Yang. All rights reserved.(v25)</p>
    </footer>

    <!-- Quick Note Modal -->
    <div class="modal-overlay" id="quick-note-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-sticky-note"></i> Add Quick Note</h3>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-task-name" id="modal-task-name">Task Name</div>
                <textarea class="modal-notes-input" id="modal-notes-input" placeholder="Add your notes here... Use separate lines for different points."></textarea>
                <div class="notes-help">Each line will be displayed as a separate bullet point for easy tracking.</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-note">Cancel</button>
                <button class="btn btn-primary" id="save-note">Save Note</button>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="modal-overlay" id="report-modal">
        <div class="modal report-modal">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-chart-bar"></i> Productivity Report</h3>
                <button class="modal-close" id="close-report-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="report-content">
                    <!-- Report content will be generated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-report">Close</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const timerDisplay = document.getElementById('timer-display');
        const startBtn = document.getElementById('start-btn');
        const startBreakBtn = document.getElementById('start-break-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const finishSessionBtn = document.getElementById('finish-session-btn');
        const focusTimeInput = document.getElementById('focus-time');
        const breakTimeInput = document.getElementById('break-time');
        const tickSoundToggle = document.getElementById('tick-sound-toggle');
        const modeIndicator = document.getElementById('mode-indicator');
        const progressBar = document.getElementById('progress-bar');
        const projectNameInput = document.getElementById('project-name');
        const projectNotesInput = document.getElementById('project-notes');
        const saveRecordBtn = document.getElementById('save-record-btn');
        const recordsBody = document.getElementById('records-body');
        const taskInput = document.getElementById('task-input');
        const taskNotesInput = document.getElementById('task-notes-input');
        const addTaskBtn = document.getElementById('add-task-btn');
        const taskList = document.getElementById('task-list');
        const exportBtn = document.getElementById('export-btn');
        const importBtn = document.getElementById('import-btn');
        const cleanStorageBtn = document.getElementById('clean-storage-btn');
        const reportBtn = document.getElementById('report-btn');
        const importFile = document.getElementById('import-file');
        const focusSessionsEl = document.getElementById('focus-sessions');
        const totalTimeEl = document.getElementById('total-time');
        const projectFilter = document.getElementById('project-filter');
        const continueTasksSection = document.getElementById('continue-tasks-section');
        const continueTasksList = document.getElementById('continue-tasks-list');
        
        // Status Bar Elements
        const statusToggle = document.getElementById('status-toggle');
        const statusBar = document.getElementById('status-bar');
        const statusTimer = document.getElementById('status-timer');
        const statusMode = document.getElementById('status-mode');
        const statusProgress = document.getElementById('status-progress');
        const statusPlayPause = document.getElementById('status-play-pause');
        const statusReset = document.getElementById('status-reset');
        
        // Time-up Notification Element
        const timeUpNotification = document.getElementById('time-up-notification');
        
        // Modal elements
        const quickNoteModal = document.getElementById('quick-note-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelNoteBtn = document.getElementById('cancel-note');
        const saveNoteBtn = document.getElementById('save-note');
        const modalTaskName = document.getElementById('modal-task-name');
        const modalNotesInput = document.getElementById('modal-notes-input');
        
        // Report modal elements
        const reportModal = document.getElementById('report-modal');
        const closeReportModalBtn = document.getElementById('close-report-modal');
        const closeReportBtn = document.getElementById('close-report');
        const reportContent = document.getElementById('report-content');

        // Timer variables
        let timer;
        let isRunning = false;
        let isFocusMode = true;
        let timeLeft;
        let totalTime;
        let focusTime = 25 * 60; // 25 minutes in seconds
        let breakTime = 5 * 60; // 5 minutes in seconds
        let focusSessions = 0;
        let breakSessions = 0;
        let totalFocusTime = 0;

        // Sound variables
        let tickSoundEnabled = true;
        let audioContext;
        let tickOscillator;
        let tickGainNode;

        // Tasks array
        let tasks = [];

        // Projects and sessions
        let projects = {};
        let currentProjectId = null;

        // Current task for quick notes
        let currentTaskForNotes = null;

        // Initialize audio context for tick sound
        function initAudioContext() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log("Audio context initialized for tick sounds");
            } catch (e) {
                console.log("Web Audio API not supported - tick sounds disabled");
                tickSoundEnabled = false;
                tickSoundToggle.checked = false;
                tickSoundToggle.disabled = true;
            }
        }

        // Play tick sound
        function playTickSound() {
            if (!tickSoundEnabled || !tickSoundToggle.checked) return;
            
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                // Create a short, subtle tick sound
                tickOscillator = audioContext.createOscillator();
                tickGainNode = audioContext.createGain();
                
                tickOscillator.connect(tickGainNode);
                tickGainNode.connect(audioContext.destination);
                
                // Use a higher frequency for focus, lower for break
                const frequency = isFocusMode ? 800 : 600;
                tickOscillator.frequency.value = frequency;
                tickOscillator.type = 'sine';
                
                // Very short, subtle tick
                tickGainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                tickGainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                
                tickOscillator.start(audioContext.currentTime);
                tickOscillator.stop(audioContext.currentTime + 0.05);
            } catch (e) {
                console.log("Error playing tick sound:", e);
            }
        }

        // Initialize timer
        function initTimer() {
            timeLeft = focusTime;
            totalTime = focusTime;
            updateDisplay();
            updateProgressBar();
            updateStatusBar();
        }

        // Update timer display
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Update status bar
        function updateStatusBar() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            statusTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update mode
            if (isFocusMode) {
                statusMode.textContent = 'Focus Time';
                statusMode.className = 'status-mode focus-mode';
            } else {
                statusMode.textContent = 'Break Time';
                statusMode.className = 'status-mode break-mode';
            }
            
            // Update progress
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            statusProgress.style.width = `${progress}%`;
            
            // Update play/pause button
            if (isRunning) {
                statusPlayPause.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                statusPlayPause.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        // Start timer
        function startTimer() {
            if (isRunning) return;
            
            isRunning = true;
            startBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
            startBreakBtn.disabled = true;
            
            // Play initial tick sound
            if (tickSoundEnabled && tickSoundToggle.checked) {
                playTickSound();
            }
            
            timer = setInterval(() => {
                timeLeft--;
                updateDisplay();
                updateProgressBar();
                updateStatusBar();
                
                // Play tick sound every second
                if (tickSoundEnabled && tickSoundToggle.checked) {
                    playTickSound();
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    isRunning = false;
                    startBreakBtn.disabled = false;
                    
                    // Enhanced time-up notification
                    playTimeUpSound();
                    showTimeUpNotification();
                    
                    // Switch mode
                    if (isFocusMode) {
                        focusSessions++;
                        totalFocusTime += parseInt(focusTimeInput.value) * 60;
                        updateStats();
                        isFocusMode = false;
                        modeIndicator.textContent = 'Break Time';
                        modeIndicator.className = 'mode-indicator break-mode';
                        timeLeft = breakTime;
                        totalTime = breakTime;
                        
                        // Show break notification
                        showNotification('Focus session completed! Time for a break.', 'success');
                    } else {
                        breakSessions++;
                        isFocusMode = true;
                        modeIndicator.textContent = 'Focus Time';
                        modeIndicator.className = 'mode-indicator focus-mode';
                        timeLeft = focusTime;
                        totalTime = focusTime;
                        
                        // Show focus notification
                        showNotification('Break completed! Ready for another focus session?', 'info');
                    }
                    
                    updateDisplay();
                    updateProgressBar();
                    updateStatusBar();
                    startBtn.innerHTML = '<i class="fas fa-play"></i> Start Focus';
                }
            }, 1000);
        }

        // Start break timer
        function startBreakTimer() {
            if (isRunning) return;
            
            // Switch to break mode
            isFocusMode = false;
            modeIndicator.textContent = 'Break Time';
            modeIndicator.className = 'mode-indicator break-mode';
            timeLeft = breakTime;
            totalTime = breakTime;
            
            updateDisplay();
            updateProgressBar();
            updateStatusBar();
            
            // Start the timer
            startTimer();
        }

        // Pause timer
        function pauseTimer() {
            clearInterval(timer);
            isRunning = false;
            startBtn.innerHTML = '<i class="fas fa-play"></i> Resume';
            startBreakBtn.disabled = false;
        }

        // Reset timer
        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            isFocusMode = true;
            modeIndicator.textContent = 'Focus Time';
            modeIndicator.className = 'mode-indicator focus-mode';
            focusTime = parseInt(focusTimeInput.value) * 60;
            breakTime = parseInt(breakTimeInput.value) * 60;
            initTimer();
            startBtn.innerHTML = '<i class="fas fa-play"></i> Start Focus';
            startBreakBtn.disabled = false;
            timerDisplay.classList.remove('time-up');
        }

        // Toggle status bar
        function toggleStatusBar() {
            statusBar.classList.toggle('hidden');
        }

        // Status bar play/pause functionality
        function toggleTimerFromStatus() {
            if (isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        // Finish session manually
        function finishSession() {
            if (isRunning) {
                // If timer is running, complete the current session
                clearInterval(timer);
                isRunning = false;
                
                if (isFocusMode) {
                    focusSessions++;
                    totalFocusTime += (parseInt(focusTimeInput.value) * 60 - timeLeft);
                } else {
                    breakSessions++;
                }
                
                updateStats();
                showNotification('Session finished manually!', 'success');
                resetTimer();
            } else {
                // If timer is not running, just save the current progress
                if (focusSessions > 0 || breakSessions > 0) {
                    showNotification('Session progress saved!', 'success');
                } else {
                    showNotification('No session progress to save.', 'info');
                }
            }
        }

        // Enhanced time-up sound
        function playTimeUpSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Create a more noticeable alarm sound
                const oscillator1 = audioContext.createOscillator();
                const oscillator2 = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator1.connect(gainNode);
                oscillator2.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator1.frequency.value = 800;
                oscillator2.frequency.value = 600;
                oscillator1.type = 'sine';
                oscillator2.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                
                oscillator1.start(audioContext.currentTime);
                oscillator2.start(audioContext.currentTime);
                oscillator1.stop(audioContext.currentTime + 2);
                oscillator2.stop(audioContext.currentTime + 2);
            } catch (e) {
                console.log("Audio context not supported");
                // Fallback: Use browser's built-in beep
                try {
                    console.log('\x07'); // ASCII bell character
                } catch (e2) {
                    console.log("Browser doesn't support audio notifications");
                }
            }
        }

        // Enhanced time-up notification with visual effects
        function showTimeUpNotification() {
            // Show the large time-up notification for 5 seconds
            timeUpNotification.classList.remove('hidden');
            
            // Flash the timer display
            timerDisplay.classList.add('time-up');
            
            // Flash the entire card
            const timerCard = document.querySelector('.timer-card');
            timerCard.classList.add('time-up-flash');
            
            // Remove notification after 5 seconds
            setTimeout(() => {
                timeUpNotification.classList.add('hidden');
                timerDisplay.classList.remove('time-up');
                timerCard.classList.remove('time-up-flash');
            }, 5000);
            
            // Show browser notification if supported
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("FlowFocus Timer", {
                    body: isFocusMode ? "Focus time is up! Take a break." : "Break time is over! Ready to focus?",
                    icon: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⏰</text></svg>"
                });
            }
            
            // Show visual notification
            showNotification(
                isFocusMode ? "Focus session completed! Time for a break." : "Break completed! Ready for another focus session?", 
                'success'
            );
        }

        // Request notification permission
        function requestNotificationPermission() {
            if ("Notification" in window && Notification.permission === "default") {
                Notification.requestPermission();
            }
        }

        // Update stats
        function updateStats() {
            focusSessionsEl.textContent = focusSessions;
            
            const hours = Math.floor(totalFocusTime / 3600);
            const minutes = Math.floor((totalFocusTime % 3600) / 60);
            
            if (hours > 0) {
                totalTimeEl.textContent = `${hours}h ${minutes}m`;
            } else {
                totalTimeEl.textContent = `${minutes}m`;
            }
        }

        // Show visual notification
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                display: flex;
                align-items: center;
                gap: 10px;
                border-left: 4px solid ${type === 'success' ? '#4cc9f0' : '#4361ee'};
                transform: translateX(120%);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            
            const icon = document.createElement('i');
            icon.className = `fas ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'}`;
            icon.style.color = type === 'success' ? '#4cc9f0' : '#4361ee';
            
            const text = document.createElement('span');
            text.textContent = message;
            
            notification.appendChild(icon);
            notification.appendChild(text);
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(120%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Format notes with line breaks
        function formatNotes(notes) {
            if (!notes) return '';
            return notes.split('\n')
                .filter(line => line.trim() !== '')
                .map(line => `<span class="task-note-line">${line.trim()}</span>`)
                .join('');
        }

        // Add a new task
        function addTask() {
            const taskText = taskInput.value.trim();
            const taskNotes = taskNotesInput.value.trim();
            
            if (!taskText) {
                showNotification('Please enter a task name', 'info');
                return;
            }
            
            const task = {
                id: Date.now(),
                name: taskText,
                notes: taskNotes,
                completed: false
            };
            
            tasks.push(task);
            renderTasks();
            taskInput.value = '';
            taskNotesInput.value = '';
            taskInput.focus();
        }

        // Render tasks in the UI
        function renderTasks() {
            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>No tasks yet. Add tasks to track your progress.</p>
                    </div>
                `;
                return;
            }
            
            taskList.innerHTML = '';
            
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'task-completed' : ''}`;
                
                const formattedNotes = formatNotes(task.notes);
                
                taskElement.innerHTML = `
                    <div class="task-header">
                        <div class="task-content">
                            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} data-id="${task.id}">
                            <div class="task-details">
                                <div class="task-name">${task.name}</div>
                                ${formattedNotes ? `<div class="task-notes">${formattedNotes}</div>` : ''}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="quick-note-btn add-note" data-id="${task.id}">
                                <i class="fas fa-sticky-note"></i> Note
                            </button>
                            <button class="icon-btn edit-task" data-id="${task.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="icon-btn delete-task" data-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                taskList.appendChild(taskElement);
            });
            
            // Add event listeners
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    toggleTaskCompletion(taskId);
                });
            });
            
            document.querySelectorAll('.edit-task').forEach(button => {
                button.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    editTask(taskId);
                });
            });
            
            document.querySelectorAll('.delete-task').forEach(button => {
                button.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    deleteTask(taskId);
                });
            });
            
            // Add event listeners for quick note buttons
            document.querySelectorAll('.add-note').forEach(button => {
                button.addEventListener('click', function() {
                    const taskId = parseInt(this.getAttribute('data-id'));
                    openQuickNoteModal(taskId);
                });
            });
        }

        // Get unfinished tasks from previous sessions
        function getUnfinishedTasks() {
            let unfinishedTasks = [];
            
            Object.values(projects).forEach(project => {
                project.sessions.forEach(session => {
                    session.tasks.forEach(task => {
                        if (!task.completed) {
                            // Check if this task is already in our list
                            const existingTask = unfinishedTasks.find(t => 
                                t.name === task.name && t.project === session.project
                            );
                            
                            if (!existingTask) {
                                unfinishedTasks.push({
                                    name: task.name,
                                    notes: task.notes,
                                    project: session.project,
                                    projectId: project.id,
                                    projectNotes: project.notes
                                });
                            }
                        }
                    });
                });
            });
            
            return unfinishedTasks;
        }

        // Render continue tasks section
        function renderContinueTasks() {
            const unfinishedTasks = getUnfinishedTasks();
            
            if (unfinishedTasks.length === 0) {
                continueTasksSection.style.display = 'none';
                return;
            }
            
            continueTasksSection.style.display = 'block';
            continueTasksList.innerHTML = '';
            
            unfinishedTasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'continue-task-item';
                
                taskElement.innerHTML = `
                    <div class="continue-task-info">
                        <div class="continue-task-name">${task.name}</div>
                        <div class="continue-task-project">From: ${task.project}</div>
                    </div>
                    <div class="continue-task-actions">
                        <button class="icon-btn continue-task" 
                                data-name="${task.name}" 
                                data-notes="${task.notes || ''}"
                                data-project="${task.project}"
                                data-project-notes="${task.projectNotes || ''}">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                `;
                
                continueTasksList.appendChild(taskElement);
            });
            
            // Add event listeners for continue buttons
            document.querySelectorAll('.continue-task').forEach(button => {
                button.addEventListener('click', function() {
                    const taskName = this.getAttribute('data-name');
                    const taskNotes = this.getAttribute('data-notes');
                    const projectName = this.getAttribute('data-project');
                    const projectNotes = this.getAttribute('data-project-notes');
                    
                    // Restore project information
                    projectNameInput.value = projectName;
                    projectNotesInput.value = projectNotes || '';
                    
                    // Add to current tasks
                    const task = {
                        id: Date.now(),
                        name: taskName,
                        notes: taskNotes,
                        completed: false
                    };
                    
                    tasks.push(task);
                    renderTasks();
                    showNotification(`"${taskName}" added to current tasks with project "${projectName}"`, 'success');
                });
            });
        }

        // Open quick note modal
        function openQuickNoteModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                currentTaskForNotes = task;
                modalTaskName.textContent = task.name;
                modalNotesInput.value = task.notes || '';
                quickNoteModal.classList.add('active');
                modalNotesInput.focus();
            }
        }

        // Close quick note modal
        function closeQuickNoteModal() {
            quickNoteModal.classList.remove('active');
            currentTaskForNotes = null;
            modalNotesInput.value = '';
        }

        // Save quick note
        function saveQuickNote() {
            if (currentTaskForNotes) {
                currentTaskForNotes.notes = modalNotesInput.value.trim();
                renderTasks();
                showNotification('Note saved successfully!', 'success');
                closeQuickNoteModal();
            }
        }

        // Toggle task completion
        function toggleTaskCompletion(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                renderTasks();
            }
        }

        // Edit a task
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                const newName = prompt('Edit task name:', task.name);
                if (newName !== null && newName.trim() !== '') {
                    task.name = newName.trim();
                }
                
                const newNotes = prompt('Edit task notes (use separate lines for key points):', task.notes);
                if (newNotes !== null) {
                    task.notes = newNotes.trim();
                }
                
                renderTasks();
            }
        }

        // Delete a task
        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                renderTasks();
            }
        }

        // Count completed tasks
        function countCompletedTasks() {
            return tasks.filter(task => task.completed).length;
        }

        // Get or create project
        function getOrCreateProject(projectName, projectNotes) {
            const projectId = projectName.toLowerCase().replace(/\s+/g, '-');
            
            if (!projects[projectId]) {
                projects[projectId] = {
                    id: projectId,
                    name: projectName,
                    notes: projectNotes,
                    sessions: [],
                    totalFocusTime: 0,
                    totalSessions: 0
                };
                
                // Add to project filter
                const option = document.createElement('option');
                option.value = projectId;
                option.textContent = projectName;
                projectFilter.appendChild(option);
            }
            
            return projectId;
        }

        // Save time record
        function saveTimeRecord() {
            const projectName = projectNameInput.value.trim();
            const projectNotes = projectNotesInput.value.trim();
            
            if (!projectName) {
                showNotification('Please enter a project name', 'info');
                return;
            }
            
            if (focusSessions === 0 && breakSessions === 0) {
                showNotification('Complete at least one focus session to save', 'info');
                return;
            }
            
            const projectId = getOrCreateProject(projectName, projectNotes);
            currentProjectId = projectId;
            
            const now = new Date();
            const dateString = now.toLocaleDateString();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            const session = {
                id: Date.now(),
                date: `${dateString} ${timeString}`,
                project: projectName,
                focusTime: focusSessions * (parseInt(focusTimeInput.value) * 60),
                breakTime: breakSessions * (parseInt(breakTimeInput.value) * 60),
                tasksCompleted: countCompletedTasks(),
                totalTasks: tasks.length,
                projectNotes: projectNotes,
                tasks: [...tasks]
            };
            
            // Add to project
            projects[projectId].sessions.push(session);
            projects[projectId].totalFocusTime += session.focusTime;
            projects[projectId].totalSessions++;
            
            // Save to localStorage
            saveProjectsToStorage();
            
            // Update UI
            renderRecordsTable();
            renderContinueTasks();
            
            // Show confirmation
            showNotification('Session saved successfully!', 'success');
            
            // Reset counters and tasks
            focusSessions = 0;
            breakSessions = 0;
            tasks = [];
            renderTasks();
            updateStats();
        }

        // Render records table
        function renderRecordsTable() {
            const filterValue = projectFilter.value;
            const sessionsToShow = filterValue === 'all' 
                ? getAllSessions() 
                : (projects[filterValue] ? projects[filterValue].sessions : []);
            
            if (sessionsToShow.length === 0) {
                recordsBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No sessions recorded yet. Complete a focus session to see it here.</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            recordsBody.innerHTML = '';
            
            sessionsToShow.forEach(session => {
                const row = document.createElement('tr');
                
                // Format task details
                let taskDetails = '';
                if (session.tasks && session.tasks.length > 0) {
                    session.tasks.forEach(task => {
                        const taskNotes = task.notes ? 
                            task.notes.split('\n')
                                .filter(line => line.trim() !== '')
                                .map(line => `<span class="task-note-bullet">${line.trim()}</span>`)
                                .join('') : '';
                        
                        taskDetails += `
                            <div class="session-task-item ${task.completed ? 'session-task-completed' : ''}">
                                <div class="session-task-content">
                                    <i class="fas ${task.completed ? 'fa-check-circle' : 'fa-circle'}"></i>
                                    <div class="session-task-details">
                                        <div>${task.name}</div>
                                        ${taskNotes ? `<div class="session-task-notes">${taskNotes}</div>` : ''}
                                    </div>
                                </div>
                                <button class="icon-btn delete-task-history" 
                                        data-project="${getProjectId(session.project)}" 
                                        data-session="${session.id}"
                                        data-task="${task.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                    });
                } else {
                    taskDetails = '<em>No tasks</em>';
                }
                
                row.innerHTML = `
                    <td class="col-date">${session.date}</td>
                    <td class="col-project">${session.project}</td>
                    <td class="col-focus">${formatTime(session.focusTime)}</td>
                    <td class="col-break">${formatTime(session.breakTime)}</td>
                    <td class="col-tasks">${session.tasksCompleted}/${session.totalTasks}</td>
                    <td class="col-project-notes">
                        <div class="project-notes-cell">${session.projectNotes || '-'}</div>
                    </td>
                    <td class="col-task-notes">
                        <div class="task-notes-container">${taskDetails}</div>
                    </td>
                    <td class="col-actions">
                        <button class="icon-btn delete-record" data-project="${getProjectId(session.project)}" data-session="${session.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                recordsBody.appendChild(row);
            });
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-record').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = this.getAttribute('data-project');
                    const sessionId = this.getAttribute('data-session');
                    deleteSession(projectId, sessionId);
                });
            });
            
            // Add event listeners for delete task history buttons
            document.querySelectorAll('.delete-task-history').forEach(button => {
                button.addEventListener('click', function() {
                    const projectId = this.getAttribute('data-project');
                    const sessionId = this.getAttribute('data-session');
                    const taskId = parseInt(this.getAttribute('data-task'));
                    deleteTaskFromHistory(projectId, sessionId, taskId);
                });
            });
        }

        // Get all sessions from all projects
        function getAllSessions() {
            let allSessions = [];
            Object.values(projects).forEach(project => {
                allSessions = allSessions.concat(project.sessions);
            });
            // Sort by date (newest first)
            return allSessions.sort((a, b) => b.id - a.id);
        }

        // Get project ID from project name
        function getProjectId(projectName) {
            return projectName.toLowerCase().replace(/\s+/g, '-');
        }

        // Delete a session
        function deleteSession(projectId, sessionId) {
            if (confirm('Are you sure you want to delete this session?')) {
                const project = projects[projectId];
                if (project) {
                    const sessionIndex = project.sessions.findIndex(s => s.id == sessionId);
                    if (sessionIndex !== -1) {
                        const session = project.sessions[sessionIndex];
                        project.totalFocusTime -= session.focusTime;
                        project.totalSessions--;
                        project.sessions.splice(sessionIndex, 1);
                        
                        // If no sessions left, remove the project
                        if (project.sessions.length === 0) {
                            delete projects[projectId];
                            // Remove from project filter
                            const option = projectFilter.querySelector(`option[value="${projectId}"]`);
                            if (option) option.remove();
                        }
                        
                        // Save to localStorage
                        saveProjectsToStorage();
                        
                        // Update UI
                        renderRecordsTable();
                        renderContinueTasks();
                        
                        showNotification('Session deleted successfully', 'success');
                    }
                }
            }
        }

        // Delete a task from history
        function deleteTaskFromHistory(projectId, sessionId, taskId) {
            if (confirm('Are you sure you want to delete this task from history?')) {
                const project = projects[projectId];
                if (project) {
                    const session = project.sessions.find(s => s.id == sessionId);
                    if (session) {
                        const taskIndex = session.tasks.findIndex(t => t.id === taskId);
                        if (taskIndex !== -1) {
                            const task = session.tasks[taskIndex];
                            
                            // Update task counts
                            if (task.completed) {
                                session.tasksCompleted--;
                            }
                            session.totalTasks--;
                            
                            // Remove the task
                            session.tasks.splice(taskIndex, 1);
                            
                            // Save to localStorage
                            saveProjectsToStorage();
                            
                            // Update UI
                            renderRecordsTable();
                            renderContinueTasks();
                            
                            showNotification('Task deleted from history', 'success');
                        }
                    }
                }
            }
        }

        // Format time in seconds to readable format
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }

        // Save projects to localStorage
        function saveProjectsToStorage() {
            localStorage.setItem('flowFocusProjects', JSON.stringify(projects));
        }

        // Load projects from localStorage
        function loadProjectsFromStorage() {
            const storedProjects = JSON.parse(localStorage.getItem('flowFocusProjects')) || {};
            projects = storedProjects;
            
            // Populate project filter
            projectFilter.innerHTML = '<option value="all">All Projects</option>';
            Object.values(projects).forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectFilter.appendChild(option);
            });
            
            renderRecordsTable();
            renderContinueTasks();
        }

        // Clean localStorage
        function cleanStorage() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                localStorage.removeItem('flowFocusProjects');
                projects = {};
                renderRecordsTable();
                renderContinueTasks();
                showNotification('All data has been cleared', 'success');
            }
        }

        // Generate and show report
        function showReport() {
            if (Object.keys(projects).length === 0) {
                showNotification('No data available for report', 'info');
                return;
            }
            
            let totalFocusTime = 0;
            let totalSessions = 0;
            let totalTasks = 0;
            let completedTasks = 0;
            
            // Calculate totals
            Object.values(projects).forEach(project => {
                totalFocusTime += project.totalFocusTime;
                totalSessions += project.totalSessions;
                
                project.sessions.forEach(session => {
                    totalTasks += session.totalTasks;
                    completedTasks += session.tasksCompleted;
                });
            });
            
            // Generate report HTML
            let reportHTML = `
                <div class="report-summary">
                    <h3>Overall Summary</h3>
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="summary-stat-value">${Object.keys(projects).length}</div>
                            <div class="summary-stat-label">Projects</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value">${totalSessions}</div>
                            <div class="summary-stat-label">Sessions</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value">${formatTime(totalFocusTime)}</div>
                            <div class="summary-stat-label">Focus Time</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value">${completedTasks}/${totalTasks}</div>
                            <div class="summary-stat-label">Tasks Completed</div>
                        </div>
                    </div>
                </div>
                
                <div class="report-section">
                    <h3 class="report-section-title">Project Details</h3>
            `;
            
            // Add project details
            Object.values(projects).forEach(project => {
                let projectTasks = 0;
                let projectCompletedTasks = 0;
                let projectNotes = [];
                
                project.sessions.forEach(session => {
                    projectTasks += session.totalTasks;
                    projectCompletedTasks += session.tasksCompleted;
                    
                    // Collect task notes
                    session.tasks.forEach(task => {
                        if (task.notes) {
                            projectNotes.push({
                                task: task.name,
                                notes: task.notes,
                                completed: task.completed
                            });
                        }
                    });
                });
                
                reportHTML += `
                    <div class="project-report">
                        <div class="project-header">
                            <div class="project-name">${project.name}</div>
                            <div class="project-stats">
                                <div class="project-stat">
                                    <div class="project-stat-value">${project.totalSessions}</div>
                                    <div class="project-stat-label">Sessions</div>
                                </div>
                                <div class="project-stat">
                                    <div class="project-stat-value">${formatTime(project.totalFocusTime)}</div>
                                    <div class="project-stat-label">Focus Time</div>
                                </div>
                                <div class="project-stat">
                                    <div class="project-stat-value">${projectCompletedTasks}/${projectTasks}</div>
                                    <div class="project-stat-label">Tasks</div>
                                </div>
                            </div>
                        </div>
                        
                        ${project.notes ? `<p><strong>Project Notes:</strong> ${project.notes}</p>` : ''}
                        
                        <div class="task-report">
                            <h4>Task Achievements & Notes</h4>
                `;
                
                if (projectNotes.length > 0) {
                    projectNotes.forEach(noteItem => {
                        const formattedNotes = noteItem.notes.split('\n')
                            .filter(line => line.trim() !== '')
                            .map(line => `<div class="note-highlight">${line.trim()}</div>`)
                            .join('');
                        
                        reportHTML += `
                            <div class="task-report-item">
                                <div class="task-report-header">
                                    <div class="task-report-name">${noteItem.task}</div>
                                    <div class="task-report-status ${noteItem.completed ? '' : 'incomplete'}">
                                        ${noteItem.completed ? 'Completed' : 'In Progress'}
                                    </div>
                                </div>
                                <div class="task-report-notes">
                                    ${formattedNotes}
                                </div>
                            </div>
                        `;
                    });
                } else {
                    reportHTML += `<p>No task notes recorded for this project.</p>`;
                }
                
                reportHTML += `
                        </div>
                    </div>
                `;
            });
            
            reportHTML += `</div>`;
            reportContent.innerHTML = reportHTML;
            reportModal.classList.add('active');
        }

        // Close report modal
        function closeReportModal() {
            reportModal.classList.remove('active');
        }

        // Export all data
        function exportData() {
            if (Object.keys(projects).length === 0) {
                showNotification('No data to export', 'info');
                return;
            }
            
            const data = {
                projects: projects,
                exportDate: new Date().toISOString(),
                app: "FlowFocus"
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `flowfocus-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data exported successfully', 'success');
        }

        // Import data
        function importData() {
            importFile.click();
        }

        // Handle file import
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.projects && typeof data.projects === 'object') {
                        // Clear existing data
                        projects = {};
                        localStorage.removeItem('flowFocusProjects');
                        
                        // Import new data
                        projects = data.projects;
                        saveProjectsToStorage();
                        loadProjectsFromStorage();
                        
                        showNotification('Data imported successfully!', 'success');
                    } else {
                        showNotification('Invalid data format', 'info');
                    }
                } catch (error) {
                    showNotification('Error importing data', 'info');
                }
            };
            
            reader.readAsText(file);
            // Reset file input
            event.target.value = '';
        }

        // Event listeners
        startBtn.addEventListener('click', startTimer);
        startBreakBtn.addEventListener('click', startBreakTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);
        finishSessionBtn.addEventListener('click', finishSession);
        saveRecordBtn.addEventListener('click', saveTimeRecord);
        addTaskBtn.addEventListener('click', addTask);
        exportBtn.addEventListener('click', exportData);
        importBtn.addEventListener('click', importData);
        cleanStorageBtn.addEventListener('click', cleanStorage);
        reportBtn.addEventListener('click', showReport);
        importFile.addEventListener('change', handleFileImport);
        projectFilter.addEventListener('change', renderRecordsTable);
        
        // Status Bar event listeners
        statusToggle.addEventListener('click', toggleStatusBar);
        statusPlayPause.addEventListener('click', toggleTimerFromStatus);
        statusReset.addEventListener('click', resetTimer);
        
        // Sound toggle event listener
        tickSoundToggle.addEventListener('change', function() {
            if (!this.checked && isRunning) {
                // If turning off sound while timer is running, play one final tick
                playTickSound();
            }
        });
        
        // Modal event listeners
        closeModalBtn.addEventListener('click', closeQuickNoteModal);
        cancelNoteBtn.addEventListener('click', closeQuickNoteModal);
        saveNoteBtn.addEventListener('click', saveQuickNote);
        
        // Report modal event listeners
        closeReportModalBtn.addEventListener('click', closeReportModal);
        closeReportBtn.addEventListener('click', closeReportModal);

        // Close modals when clicking outside
        quickNoteModal.addEventListener('click', function(e) {
            if (e.target === quickNoteModal) {
                closeQuickNoteModal();
            }
        });
        
        reportModal.addEventListener('click', function(e) {
            if (e.target === reportModal) {
                closeReportModal();
            }
        });

        // Add task on Enter key
        taskInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        // Update timer when settings change
        focusTimeInput.addEventListener('change', function() {
            if (!isRunning) {
                focusTime = parseInt(this.value) * 60;
                if (isFocusMode) {
                    timeLeft = focusTime;
                    totalTime = focusTime;
                    updateDisplay();
                    updateProgressBar();
                    updateStatusBar();
                }
            }
        });

        breakTimeInput.addEventListener('change', function() {
            if (!isRunning) {
                breakTime = parseInt(this.value) * 60;
                if (!isFocusMode) {
                    timeLeft = breakTime;
                    totalTime = breakTime;
                    updateDisplay();
                    updateProgressBar();
                    updateStatusBar();
                }
            }
        });

        // Initialize the app
        initAudioContext();
        initTimer();
        loadProjectsFromStorage();
        updateStats();
        requestNotificationPermission();
    </script>
</body>
</html>