<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biomedical Manuscript Story Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            background: #f7fafc;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background: #edf2f7;
        }
        
        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            background: #f7fafc;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .section h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }
        
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .figure-card {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .figure-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .panel-item {
            background: #edf2f7;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .outline-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border-left: 4px solid #48bb78;
        }
        
        .outline-section h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .export-preview {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .help-text {
            background: #fff5f5;
            border-left: 4px solid #fc8181;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            color: #742a2a;
        }
        
        .success-text {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            color: #22543d;
        }
        
        .info-text {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            color: #2c5282;
        }
        
        .small-btn {
            padding: 6px 12px;
            font-size: 0.9em;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .logic-card {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .logic-flow {
            position: relative;
        }
        
        .logic-flow::before {
            content: "";
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #667eea;
            border-radius: 2px;
        }
        
        .logic-card {
            position: relative;
            margin-left: 60px;
        }
        
        .logic-card::before {
            content: "";
            position: absolute;
            left: -40px;
            top: 30px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            border: 4px solid white;
            box-shadow: 0 0 0 2px #667eea;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .check-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        .progress-bar {
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            border-radius: 5px;
            transition: width 0.5s;
        }
        
        .template-card {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .template-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .template-card h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .template-card p {
            color: #4a5568;
            font-size: 0.9em;
        }
        
        .connection-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        
        .rationale-box, .question-box {
            margin: 15px 0;
        }
        
        .figure-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .figure-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .type-discovery { background: #bee3f8; color: #2c5282; }
        .type-mechanism { background: #c6f6d5; color: #276749; }
        .type-validation { background: #fed7d7; color: #c53030; }
        .type-clinical { background: #faf089; color: #744210; }
        
        .story-arc {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .arc-step {
            text-align: center;
            flex: 1;
            padding: 10px;
        }
        
        .arc-step h4 {
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .arc-step p {
            font-size: 0.9em;
            color: #4a5568;
        }
        
        .arc-connector {
            flex: 0 0 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-size: 1.5em;
        }
        
        .reagents-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .reagents-table th, .reagents-table td {
            border: 1px solid #e2e8f0;
            padding: 8px;
            text-align: left;
        }
        
        .reagents-table th {
            background: #edf2f7;
            font-weight: 600;
        }
        
        .discussion-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            margin-top: 5px;
            margin-bottom: 15px;
            min-height: 80px;
        }
        
        .statistical-planning {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .statistical-planning h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .methods-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .methods-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        .collaboration-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .collaboration-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .story-arc {
                flex-direction: column;
            }
            
            .arc-connector {
                transform: rotate(90deg);
                margin: 10px 0;
            }
            
            .logic-flow::before {
                left: 20px;
            }
            
            .logic-card {
                margin-left: 40px;
            }
            
            .logic-card::before {
                left: -30px;
            }
        }

        /* Add this new footer style to your CSS */
        .footer {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
            border-top: 1px solid #4a5568;
        }
        
        .footer p {
            margin: 0;
            opacity: 0.8;
        }
        
        .footer .subtitle {
            margin: 5px 0 0 0;
            opacity: 0.6;
            font-size: 0.8em;
        }
        
        @media (max-width: 768px) {
            .footer {
                padding: 15px;
                font-size: 0.8em;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî¨ Biomedical Manuscript Story Builder</h1>
            <p>Organize your figures logically and build your manuscript outline with scientific rigor</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('project')">üìã Project Info</div>
            <div class="tab" onclick="switchTab('figures')">üìä Figures</div>
            <div class="tab" onclick="switchTab('logic')">üîó Story Logic</div>
            <div class="tab" onclick="switchTab('outline')">üìù Outline</div>
            <div class="tab" onclick="switchTab('export')">üíæ Export</div>
        </div>
        
        <div class="content">
            <!-- Project Info Tab -->
            <div id="project" class="tab-content active">
                <div class="section">
                    <h3>Project Information</h3>
                    <div class="input-group">
                        <label>Working Title</label>
                        <input type="text" id="projectTitle" placeholder="e.g., STAT3 promotes cancer metastasis through EMT activation">
                    </div>
                    <div class="input-group">
                        <label>Main Research Question</label>
                        <textarea id="researchQuestion" placeholder="What is the central biological question you're addressing?"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Key Finding (One Sentence)</label>
                        <input type="text" id="keyFinding" placeholder="e.g., We discovered that protein X drives metastasis via pathway Y">
                    </div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Disease/System</label>
                            <input type="text" id="diseaseSystem" placeholder="e.g., Breast cancer, Neurodegeneration">
                        </div>
                        <div class="input-group">
                            <label>Main Molecule/Pathway</label>
                            <input type="text" id="mainMolecule" placeholder="e.g., STAT3, mTOR pathway">
                        </div>
                    </div>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Journal Target</label>
                            <select id="journalTarget">
                                <option value="">Select a journal type</option>
                                <option value="high-impact">High Impact (Nature, Science, Cell)</option>
                                <option value="specialized">Specialized Journal</option>
                                <option value="mid-tier">Mid-tier Journal</option>
                                <option value="society">Society Journal</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Manuscript Type</label>
                            <select id="manuscriptType">
                                <option value="research-article">Research Article</option>
                                <option value="short-report">Short Report</option>
                                <option value="resource">Resource</option>
                                <option value="methods">Methods</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn" onclick="saveProjectInfo()">üíæ Save Project Info</button>
                </div>
                
                <div class="section">
                    <h3>Hypothesis & Significance</h3>
                    <div class="input-group">
                        <label>Central Hypothesis</label>
                        <textarea id="centralHypothesis" placeholder="State your testable hypothesis clearly"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Novelty & Significance</label>
                        <textarea id="noveltySignificance" placeholder="What is new and important about this work?"></textarea>
                    </div>
                </div>
                
                <div class="section">
                    <h3>Statistical Planning</h3>
                    <div class="input-group">
                        <label>Power Analysis</label>
                        <input type="text" id="powerAnalysis" placeholder="Sample size justification, power calculations">
                    </div>
                    <div class="input-group">
                        <label>Statistical Tests</label>
                        <input type="text" id="statisticalTests" placeholder="Specify tests for each data type">
                    </div>
                    <div class="input-group">
                        <label>Multiple Testing Corrections</label>
                        <input type="text" id="multipleTesting" placeholder="Bonferroni, FDR, etc.">
                    </div>
                </div>
                
                <div class="section">
                    <h3>Story Templates</h3>
                    <p style="margin-bottom: 15px;">Select a template to guide your manuscript structure:</p>
                    
                    <div class="grid-3">
                        <div class="template-card" onclick="applyTemplate('mechanism')">
                            <h4>üî¨ Mechanism Discovery</h4>
                            <p>Fig 1: Phenotype ‚Üí Fig 2: Molecule ‚Üí Fig 3: Mechanism ‚Üí Fig 4: Validation</p>
                        </div>
                        <div class="template-card" onclick="applyTemplate('therapeutic')">
                            <h4>üíä Therapeutic Target</h4>
                            <p>Fig 1: Target ID ‚Üí Fig 2: Function ‚Üí Fig 3: Mechanism ‚Üí Fig 4: Therapeutic effect</p>
                        </div>
                        <div class="template-card" onclick="applyTemplate('pathway')">
                            <h4>üîÑ Pathway Analysis</h4>
                            <p>Fig 1: Pathway component ‚Üí Fig 2: Regulation ‚Üí Fig 3: Function ‚Üí Fig 4: Disease relevance</p>
                        </div>
                        <div class="template-card" onclick="applyTemplate('causal-mechanism')">
                            <h4>üîó Causal Mechanism</h4>
                            <p>Fig 1: Correlation ‚Üí Fig 2: Necessity ‚Üí Fig 3: Sufficiency ‚Üí Fig 4: Mechanism</p>
                        </div>
                        <div class="template-card" onclick="applyTemplate('therapeutic-development')">
                            <h4>üß™ Therapeutic Development</h4>
                            <p>Fig 1: Target ID ‚Üí Fig 2: Mechanism ‚Üí Fig 3: In vitro ‚Üí Fig 4: In vivo</p>
                        </div>
                    </div>
                </div>
                
                <div class="info-text">
                    <strong>üí° Professional Tip:</strong> Start by clearly defining your core finding. Everything in your manuscript should support this central message. Consider your target journal's requirements early in the process.
                </div>
            </div>
            
            <!-- Figures Tab -->
            <div id="figures" class="tab-content">
                <div class="section">
                    <h3>Add New Figure</h3>
                    <div class="grid-2">
                        <div class="input-group">
                            <label>Figure Number</label>
                            <select id="figureNumber">
                                <option>Figure 1</option>
                                <option>Figure 2</option>
                                <option>Figure 3</option>
                                <option>Figure 4</option>
                                <option>Figure 5</option>
                                <option>Figure 6</option>
                                <option>Figure 7</option>
                                <option>Supplementary Figure 1</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Figure Type</label>
                            <select id="figureType">
                                <option value="discovery">Discovery/Phenotype</option>
                                <option value="mechanism">Mechanism</option>
                                <option value="validation">Validation</option>
                                <option value="clinical">Clinical/Translational</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Figure Title (What does this figure show?)</label>
                        <input type="text" id="figureTitle" placeholder="e.g., STAT3 is overexpressed in metastatic tumors and predicts poor survival">
                    </div>
                    <div class="input-group">
                        <label>Main Message</label>
                        <textarea id="figureMessage" placeholder="What is the key takeaway from this figure?"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Experimental Approach</label>
                        <textarea id="figureApproach" placeholder="Briefly describe the main experiments/methods used"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Controls Used</label>
                        <textarea id="figureControls" placeholder="Describe positive/negative controls, technical controls"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Key Reagents</label>
                        <input type="text" id="figureReagents" placeholder="e.g., Antibodies, cell lines, animal models">
                    </div>
                    <div class="input-group">
                        <label>Replicates & Sample Size</label>
                        <input type="text" id="figureReplicates" placeholder="e.g., n=3 biological replicates, 10 animals per group">
                    </div>
                    <div class="input-group">
                        <label>Quantification Method</label>
                        <input type="text" id="figureQuantification" placeholder="e.g., ImageJ analysis, flow cytometry gating">
                    </div>
                    <div class="input-group">
                        <label>Panels (one per line, e.g., 'A: Western blot showing X expression')</label>
                        <textarea id="figurePanels" placeholder="A: Description of panel A&#10;B: Description of panel B&#10;C: Description of panel C"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Statistical Analysis</label>
                        <input type="text" id="figureStats" placeholder="e.g., n=3, Student's t-test, *p<0.05">
                    </div>
                    <button class="btn" onclick="addFigure()">‚ûï Add Figure</button>
                </div>
                
                <div class="section">
                    <h3>Your Figures</h3>
                    <div id="figuresList"></div>
                </div>
                
                <div class="info-text">
                    <strong>üí° Story Flow:</strong> Fig 1 (What?) ‚Üí Fig 2 (Effect?) ‚Üí Fig 3 (How?) ‚Üí Fig 4 (Proof?) ‚Üí Fig 5 (So what?)
                </div>
            </div>
            
            <!-- Story Logic Tab -->
            <div id="logic" class="tab-content">
                <div class="section">
                    <h3>Story Logic Builder</h3>
                    <p style="margin-bottom: 20px; color: #4a5568;">Connect your figures with clear rationale. Each figure should answer a question raised by the previous one.</p>
                    
                    <div class="story-arc">
                        <div class="arc-step">
                            <h4>üîç Discovery</h4>
                            <p>Identify the phenomenon or relationship</p>
                        </div>
                        <div class="arc-connector">‚Üí</div>
                        <div class="arc-step">
                            <h4>üî¨ Mechanism</h4>
                            <p>Understand how it works</p>
                        </div>
                        <div class="arc-connector">‚Üí</div>
                        <div class="arc-step">
                            <h4>‚úÖ Validation</h4>
                            <p>Confirm in relevant models</p>
                        </div>
                        <div class="arc-connector">‚Üí</div>
                        <div class="arc-step">
                            <h4>üéØ Significance</h4>
                            <p>Show why it matters</p>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="generateLogicView()">üîó Build Story Connections</button>
                </div>
                
                <div id="logicContent"></div>
                
                <div class="info-text">
                    <strong>üí° Good Story Logic:</strong> Each figure should naturally lead to the next question. Think: "We found X (Fig 1) ‚Üí This made us ask: what does X do? (Fig 2) ‚Üí This made us ask: how does X work? (Fig 3) ‚Üí Does this matter in vivo? (Fig 4)"
                </div>
            </div>
            
            <!-- Outline Tab -->
            <div id="outline" class="tab-content">
                <div class="section">
                    <h3>Manuscript Outline Generator</h3>
                    <p style="margin-bottom: 15px;">Generate a comprehensive manuscript outline based on your figures and story logic.</p>
                    <button class="btn btn-secondary" onclick="generateOutline()">‚ú® Generate Manuscript Outline</button>
                    <button class="btn btn-warning" onclick="generateAbstract()">üìÑ Generate Abstract Draft</button>
                    <button class="btn" onclick="generateDiscussionPoints()">üí¨ Generate Discussion Points</button>
                </div>
                
                <div class="section">
                    <h3>Methods Planning</h3>
                    <div class="input-group">
                        <label>Key Methodological Details</label>
                        <textarea id="methodsDetails" placeholder="Note critical methods, statistical approaches, ethical approvals"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Resources & Reagents Table</label>
                        <div id="reagentsTable">
                            <!-- Dynamic table for reagents -->
                        </div>
                    </div>
                    <button class="btn" onclick="generateMethodsSection()">Generate Methods Outline</button>
                </div>
                
                <div class="collaboration-section">
                    <h3>Collaboration Notes</h3>
                    <div class="input-group">
                        <label>Author Contributions Planning</label>
                        <textarea id="authorContributions" placeholder="Note who will do what experiments/analysis/writing"></textarea>
                    </div>
                    <div class="input-group">
                        <label>Timeline & Milestones</label>
                        <textarea id="projectTimeline" placeholder="Experimental timeline, manuscript completion goals"></textarea>
                    </div>
                </div>
                
                <div id="outlineContent"></div>
            </div>
            
            <!-- Export Tab -->
            <div id="export" class="tab-content">
                <div class="section">
                    <h3>Save & Load Project</h3>
                    <button class="btn btn-secondary" onclick="saveProject()">üíæ Save Project File</button>
                    <button class="btn" onclick="document.getElementById('loadFile').click()">üìÇ Load Project File</button>
                    <input type="file" id="loadFile" accept=".json" style="display: none;" onchange="loadProjectFile(event)">
                    <div class="info-text" style="margin-top: 15px;">
                        <strong>üí° How it works:</strong> Save your entire project as a .json file. You can close the browser and reload it anytime to continue working!
                    </div>
                </div>
                
                <div class="section">
                    <h3>Export Your Manuscript Plan</h3>
                    <button class="btn btn-secondary" onclick="exportToText()">üìÑ Export as Text</button>
                    <button class="btn" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
                    <button class="btn" onclick="exportToWord()">üìù Export to Word Format</button>
                    <button class="btn" onclick="exportScientificPlan()">üî¨ Export Scientific Plan</button>
                    <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Clear All Data</button>
                </div>
                
                <div class="section">
                    <h3>Project Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <p id="progressText">Complete project information to see progress</p>
                </div>
                
                <div class="section">
                    <h3>Preview</h3>
                    <div id="exportPreview" class="export-preview">
                        Click "Generate Manuscript Outline" in the Outline tab first...
                    </div>
                </div>
            </div>
        </div>

        <!-- ADD THE FOOTER HERE -->
        <footer class="footer">
            <p>&copy; 2025 Dr. Wen-Ming Yang. All rights reserved.</p>
            <p class="subtitle">Biomedical Manuscript Story Builder - Enhanced Version v1.2</p>
        </footer>

    </div>

    <script>
        let projectData = {};
        let figures = [];
        let storyLogic = [];
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Update progress when switching tabs
            updateProgress();
        }
        
        function updateProgress() {
            let progress = 0;
            let steps = 0;
            let totalSteps = 7; // Project info + hypothesis + stats + figures + logic + outline + export
            
            // Check project info
            if (projectData.title && projectData.question && projectData.finding) {
                progress += 15;
                steps++;
            }
            
            // Check hypothesis
            if (document.getElementById('centralHypothesis').value) {
                progress += 15;
                steps++;
            }
            
            // Check stats
            if (document.getElementById('statisticalTests').value) {
                progress += 10;
                steps++;
            }
            
            // Check figures
            if (figures.length > 0) {
                progress += 15;
                steps++;
            }
            
            // Check story logic
            if (storyLogic.length > 0 && storyLogic.some(logic => logic.rationale || logic.question)) {
                progress += 15;
                steps++;
            }
            
            // Check outline generation
            if (document.getElementById('outlineContent').innerHTML.includes('outline-section')) {
                progress += 15;
                steps++;
            }
            
            // Check export content
            if (document.getElementById('exportPreview').textContent.length > 100) {
                progress += 15;
                steps++;
            }
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${steps}/${totalSteps} steps completed (${progress}%)`;
        }
        
        function saveProjectInfo() {
            projectData = {
                title: document.getElementById('projectTitle').value,
                question: document.getElementById('researchQuestion').value,
                finding: document.getElementById('keyFinding').value,
                disease: document.getElementById('diseaseSystem').value,
                molecule: document.getElementById('mainMolecule').value,
                journal: document.getElementById('journalTarget').value,
                manuscriptType: document.getElementById('manuscriptType').value,
                hypothesis: document.getElementById('centralHypothesis').value,
                novelty: document.getElementById('noveltySignificance').value,
                powerAnalysis: document.getElementById('powerAnalysis').value,
                statisticalTests: document.getElementById('statisticalTests').value,
                multipleTesting: document.getElementById('multipleTesting').value
            };
            
            updateProgress();
            alert('‚úÖ Project information saved in memory!');
        }
        
        function applyTemplate(templateType) {
            let templateFigures = [];
            
            switch(templateType) {
                case 'mechanism':
                    templateFigures = [
                        {
                            number: 'Figure 1',
                            type: 'discovery',
                            title: 'Phenotype description',
                            message: 'Describe the initial observation or phenotype',
                            approach: 'Initial screening or observation method',
                            panels: 'A: Initial observation\nB: Confirmation\nC: Quantification',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 2',
                            type: 'mechanism',
                            title: 'Key molecule identification',
                            message: 'Identify the key molecule/pathway involved',
                            approach: 'Molecular identification method',
                            panels: 'A: Candidate identification\nB: Validation\nC: Specificity',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 3',
                            type: 'mechanism',
                            title: 'Mechanistic insight',
                            message: 'Elucidate the mechanism of action',
                            approach: 'Mechanistic studies',
                            panels: 'A: Mechanism part 1\nB: Mechanism part 2\nC: Key experiment',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 4',
                            type: 'validation',
                            title: 'Functional validation',
                            message: 'Validate the function in relevant models',
                            approach: 'Functional validation method',
                            panels: 'A: In vitro validation\nB: In vivo validation\nC: Clinical correlation',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        }
                    ];
                    break;
                    
                case 'therapeutic':
                    templateFigures = [
                        {
                            number: 'Figure 1',
                            type: 'discovery',
                            title: 'Target identification',
                            message: 'Identify the therapeutic target',
                            approach: 'Target identification method',
                            panels: 'A: Target discovery\nB: Target validation\nC: Disease relevance',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 2',
                            type: 'mechanism',
                            title: 'Target function',
                            message: 'Characterize target function',
                            approach: 'Functional characterization',
                            panels: 'A: Function in vitro\nB: Function in vivo\nC: Pathway involvement',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 3',
                            type: 'mechanism',
                            title: 'Therapeutic intervention',
                            message: 'Test therapeutic intervention',
                            approach: 'Intervention studies',
                            panels: 'A: Intervention effect\nB: Mechanism of action\nC: Specificity',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 4',
                            type: 'clinical',
                            title: 'Therapeutic efficacy',
                            message: 'Demonstrate therapeutic efficacy',
                            approach: 'Efficacy studies',
                            panels: 'A: Efficacy in models\nB: Biomarker response\nC: Safety assessment',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        }
                    ];
                    break;
                    
                case 'pathway':
                    templateFigures = [
                        {
                            number: 'Figure 1',
                            type: 'discovery',
                            title: 'Pathway component identification',
                            message: 'Identify key pathway components',
                            approach: 'Pathway analysis method',
                            panels: 'A: Component identification\nB: Expression pattern\nC: Interaction network',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 2',
                            type: 'mechanism',
                            title: 'Regulation mechanism',
                            message: 'Elucidate regulation of the pathway',
                            approach: 'Regulatory studies',
                            panels: 'A: Upstream regulation\nB: Downstream effects\nC: Feedback mechanisms',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 3',
                            type: 'mechanism',
                            title: 'Functional consequences',
                            message: 'Determine functional consequences',
                            approach: 'Functional studies',
                            panels: 'A: Cellular function\nB: Tissue function\nC: Organismal function',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 4',
                            type: 'clinical',
                            title: 'Disease relevance',
                            message: 'Establish disease relevance',
                            approach: 'Disease relevance studies',
                            panels: 'A: Clinical correlation\nB: Therapeutic implications\nC: Prognostic value',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        }
                    ];
                    break;
                    
                case 'causal-mechanism':
                    templateFigures = [
                        {
                            number: 'Figure 1',
                            type: 'discovery',
                            title: 'Correlation/Phenotype',
                            message: 'Show correlation between variables or initial phenotype',
                            approach: 'Observational or correlative studies',
                            panels: 'A: Correlation analysis\nB: Phenotype characterization\nC: Specificity check',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 2',
                            type: 'mechanism',
                            title: 'Necessity (loss-of-function)',
                            message: 'Demonstrate necessity through loss-of-function experiments',
                            approach: 'Knockdown, knockout, or inhibition studies',
                            panels: 'A: Efficiency of manipulation\nB: Phenotypic effect\nC: Specificity controls',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 3',
                            type: 'mechanism',
                            title: 'Sufficiency (gain-of-function)',
                            message: 'Demonstrate sufficiency through gain-of-function experiments',
                            approach: 'Overexpression or activation studies',
                            panels: 'A: Efficiency of manipulation\nB: Phenotypic effect\nC: Specificity controls',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 4',
                            type: 'validation',
                            title: 'Mechanistic details',
                            message: 'Elucidate detailed mechanism',
                            approach: 'Detailed mechanistic studies',
                            panels: 'A: Molecular interactions\nB: Pathway mapping\nC: Functional validation',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        }
                    ];
                    break;
                    
                case 'therapeutic-development':
                    templateFigures = [
                        {
                            number: 'Figure 1',
                            type: 'discovery',
                            title: 'Target identification & validation',
                            message: 'Identify and validate therapeutic target',
                            approach: 'Target discovery and validation methods',
                            panels: 'A: Target identification\nB: Target validation\nC: Disease association',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 2',
                            type: 'mechanism',
                            title: 'Mechanism of action',
                            message: 'Elucidate mechanism of therapeutic action',
                            approach: 'Mechanistic studies',
                            panels: 'A: Molecular mechanism\nB: Pathway involvement\nC: Specificity',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 3',
                            type: 'validation',
                            title: 'In vitro efficacy',
                            message: 'Demonstrate efficacy in cellular models',
                            approach: 'In vitro efficacy studies',
                            panels: 'A: Dose response\nB: Time course\nC: Combination studies',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        },
                        {
                            number: 'Figure 4',
                            type: 'clinical',
                            title: 'In vivo efficacy',
                            message: 'Demonstrate efficacy in animal models',
                            approach: 'In vivo efficacy studies',
                            panels: 'A: Animal model efficacy\nB: Pharmacokinetics\nC: Safety assessment',
                            stats: '',
                            controls: 'Appropriate negative/positive controls',
                            reagents: 'Key antibodies, cell lines',
                            replicates: 'n=3 biological replicates',
                            quantification: 'Standard quantification method'
                        }
                    ];
                    break;
            }
            
            // Clear existing figures
            figures = [];
            
            // Add template figures
            templateFigures.forEach(fig => {
                figures.push(fig);
            });
            
            // Update display
            displayFigures();
            
            // Switch to figures tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('figures').classList.add('active');
            
            alert(`‚úÖ Applied ${templateType} template! Review and customize the figures.`);
        }
        
        function saveProject() {
            projectData = {
                title: document.getElementById('projectTitle').value,
                question: document.getElementById('researchQuestion').value,
                finding: document.getElementById('keyFinding').value,
                disease: document.getElementById('diseaseSystem').value,
                molecule: document.getElementById('mainMolecule').value,
                journal: document.getElementById('journalTarget').value,
                manuscriptType: document.getElementById('manuscriptType').value,
                hypothesis: document.getElementById('centralHypothesis').value,
                novelty: document.getElementById('noveltySignificance').value,
                powerAnalysis: document.getElementById('powerAnalysis').value,
                statisticalTests: document.getElementById('statisticalTests').value,
                multipleTesting: document.getElementById('multipleTesting').value
            };
            
            // Create complete project data including figures
            const completeProject = {
                projectInfo: projectData,
                figures: figures,
                storyLogic: storyLogic,
                savedDate: new Date().toISOString()
            };
            
            // Create download
            const dataStr = JSON.stringify(completeProject, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `manuscript_project_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Project saved! You can reload this file anytime to continue working.');
        }
        
        function loadProjectFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedData = JSON.parse(e.target.result);
                    
                    // Restore project info
                    if (loadedData.projectInfo) {
                        projectData = loadedData.projectInfo;
                        document.getElementById('projectTitle').value = projectData.title || '';
                        document.getElementById('researchQuestion').value = projectData.question || '';
                        document.getElementById('keyFinding').value = projectData.finding || '';
                        document.getElementById('diseaseSystem').value = projectData.disease || '';
                        document.getElementById('mainMolecule').value = projectData.molecule || '';
                        document.getElementById('journalTarget').value = projectData.journal || '';
                        document.getElementById('manuscriptType').value = projectData.manuscriptType || 'research-article';
                        document.getElementById('centralHypothesis').value = projectData.hypothesis || '';
                        document.getElementById('noveltySignificance').value = projectData.novelty || '';
                        document.getElementById('powerAnalysis').value = projectData.powerAnalysis || '';
                        document.getElementById('statisticalTests').value = projectData.statisticalTests || '';
                        document.getElementById('multipleTesting').value = projectData.multipleTesting || '';
                    }
                    
                    // Restore figures
                    if (loadedData.figures) {
                        figures = loadedData.figures;
                        displayFigures();
                    }
                    
                    // Restore story logic
                    if (loadedData.storyLogic) {
                        storyLogic = loadedData.storyLogic;
                    }
                    
                    alert(`‚úÖ Project loaded successfully!\nSaved on: ${new Date(loadedData.savedDate).toLocaleString()}`);
                    
                    // Switch to project tab to show loaded data
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.querySelector('.tab').classList.add('active');
                    document.getElementById('project').classList.add('active');
                    
                    updateProgress();
                    
                } catch (error) {
                    alert('‚ùå Error loading file. Please make sure it\'s a valid project file.');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }
        
        function addFigure() {
            const figure = {
                number: document.getElementById('figureNumber').value,
                type: document.getElementById('figureType').value,
                title: document.getElementById('figureTitle').value,
                message: document.getElementById('figureMessage').value,
                approach: document.getElementById('figureApproach').value,
                panels: document.getElementById('figurePanels').value,
                stats: document.getElementById('figureStats').value,
                controls: document.getElementById('figureControls').value,
                reagents: document.getElementById('figureReagents').value,
                replicates: document.getElementById('figureReplicates').value,
                quantification: document.getElementById('figureQuantification').value
            };
            
            if (!figure.title || !figure.message) {
                alert('Please fill in at least the title and message!');
                return;
            }
            
            figures.push(figure);
            displayFigures();
            
            // Clear form
            document.getElementById('figureTitle').value = '';
            document.getElementById('figureMessage').value = '';
            document.getElementById('figureApproach').value = '';
            document.getElementById('figurePanels').value = '';
            document.getElementById('figureStats').value = '';
            document.getElementById('figureControls').value = '';
            document.getElementById('figureReagents').value = '';
            document.getElementById('figureReplicates').value = '';
            document.getElementById('figureQuantification').value = '';
            
            updateProgress();
        }
        
        function displayFigures() {
            const container = document.getElementById('figuresList');
            
            if (figures.length === 0) {
                container.innerHTML = '<p style="color: #718096;">No figures added yet. Add your first figure above!</p>';
                return;
            }
            
            container.innerHTML = figures.map((fig, index) => {
                let typeClass = '';
                let typeText = '';
                
                switch(fig.type) {
                    case 'discovery':
                        typeClass = 'type-discovery';
                        typeText = 'Discovery';
                        break;
                    case 'mechanism':
                        typeClass = 'type-mechanism';
                        typeText = 'Mechanism';
                        break;
                    case 'validation':
                        typeClass = 'type-validation';
                        typeText = 'Validation';
                        break;
                    case 'clinical':
                        typeClass = 'type-clinical';
                        typeText = 'Clinical';
                        break;
                }
                
                return `
                <div class="figure-card">
                    <h4>${fig.number} <span class="figure-type ${typeClass}">${typeText}</span></h4>
                    <p><strong>Title:</strong> ${fig.title}</p>
                    <p><strong>Message:</strong> ${fig.message}</p>
                    <p><strong>Approach:</strong> ${fig.approach}</p>
                    <p><strong>Controls:</strong> ${fig.controls || 'Not specified'}</p>
                    <p><strong>Key Reagents:</strong> ${fig.reagents || 'Not specified'}</p>
                    <p><strong>Replicates:</strong> ${fig.replicates || 'Not specified'}</p>
                    <p><strong>Quantification:</strong> ${fig.quantification || 'Not specified'}</p>
                    <p><strong>Panels:</strong> ${fig.panels.replace(/\n/g, '<br>')}</p>
                    <p><strong>Stats:</strong> ${fig.stats}</p>
                    <div class="figure-controls">
                        <button class="btn btn-warning small-btn" onclick="editFigure(${index})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-danger small-btn" onclick="deleteFigure(${index})">üóëÔ∏è Delete</button>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        function editFigure(index) {
            const fig = figures[index];
            
            document.getElementById('figureNumber').value = fig.number;
            document.getElementById('figureType').value = fig.type;
            document.getElementById('figureTitle').value = fig.title;
            document.getElementById('figureMessage').value = fig.message;
            document.getElementById('figureApproach').value = fig.approach;
            document.getElementById('figurePanels').value = fig.panels;
            document.getElementById('figureStats').value = fig.stats;
            document.getElementById('figureControls').value = fig.controls || '';
            document.getElementById('figureReagents').value = fig.reagents || '';
            document.getElementById('figureReplicates').value = fig.replicates || '';
            document.getElementById('figureQuantification').value = fig.quantification || '';
            
            figures.splice(index, 1);
            displayFigures();
        }
        
        function deleteFigure(index) {
            if (confirm('Are you sure you want to delete this figure?')) {
                figures.splice(index, 1);
                displayFigures();
                updateProgress();
            }
        }
        
        function generateLogicView() {
            const container = document.getElementById('logicContent');
            
            if (figures.length === 0) {
                container.innerHTML = '<div class="help-text">Please add figures first before building story logic.</div>';
                return;
            }
            
            let html = '<div class="logic-flow">';
            
            figures.forEach((fig, index) => {
                const currentLogic = storyLogic[index] || {};
                
                html += `
                <div class="logic-card">
                    <h4>${fig.number}: ${fig.title}</h4>
                    <p><strong>Message:</strong> ${fig.message}</p>
                    
                    <div class="rationale-box">
                        <label>Scientific Rationale</label>
                        <select class="connection-input" onchange="updateStoryLogic(${index}, 'rationaleType', this.value)">
                            <option value="">Select rationale type</option>
                            <option value="hypothesis-testing" ${currentLogic.rationaleType === 'hypothesis-testing' ? 'selected' : ''}>Hypothesis Testing</option>
                            <option value="mechanistic" ${currentLogic.rationaleType === 'mechanistic' ? 'selected' : ''}>Mechanistic Insight</option>
                            <option value="validation" ${currentLogic.rationaleType === 'validation' ? 'selected' : ''}>Experimental Validation</option>
                            <option value="correlative" ${currentLogic.rationaleType === 'correlative' ? 'selected' : ''}>Correlative Analysis</option>
                            <option value="functional" ${currentLogic.rationaleType === 'functional' ? 'selected' : ''}>Functional Assessment</option>
                        </select>
                        <textarea class="connection-input" placeholder="Scientific justification for this experiment..." 
                                  onchange="updateStoryLogic(${index}, 'rationale', this.value)">${currentLogic.rationale || ''}</textarea>
                    </div>
                    
                    <div class="question-box">
                        <label>What question does this figure lead to? (Sets up next figure)</label>
                        <textarea class="connection-input" placeholder="What logical question follows from this figure's results?" onchange="updateStoryLogic(${index}, 'question', this.value)">${currentLogic.question || ''}</textarea>
                    </div>
                    
                    ${index < figures.length - 1 ? `
                    <div class="check-item">
                        <span class="check-icon">‚úÖ</span>
                        <span>This figure should logically lead to: <strong>${figures[index+1].number}</strong></span>
                    </div>
                    ` : `
                    <div class="check-item">
                        <span class="check-icon">üéØ</span>
                        <span>This is your final figure - it should provide a strong conclusion</span>
                    </div>
                    `}
                </div>
                `;
            });
            
            html += '</div>';
            
            container.innerHTML = html;
            updateProgress();
        }
        
        function updateStoryLogic(index, field, value) {
            if (!storyLogic[index]) {
                storyLogic[index] = {};
            }
            
            storyLogic[index][field] = value;
        }
        
        function generateOutline() {
            if (figures.length === 0) {
                document.getElementById('outlineContent').innerHTML = '<div class="help-text">Please add figures first before generating an outline.</div>';
                return;
            }
            
            let html = `
            <div class="outline-section">
                <h4>üìã Title</h4>
                <p>${projectData.title || '[Your manuscript title]'}</p>
            </div>
            
            <div class="outline-section">
                <h4>üìÑ Abstract</h4>
                <p><em>Generate a draft abstract using the button above</em></p>
            </div>
            
            <div class="outline-section">
                <h4>üî¨ Introduction</h4>
                <ul>
                    <li>Background on ${projectData.disease || '[your disease/system]'}</li>
                    <li>Current knowledge gaps</li>
                    <li>Brief mention of ${projectData.molecule || '[your key molecule]'} relevance</li>
                    <li>Your central hypothesis: ${projectData.hypothesis || '[your hypothesis]'}</li>
                    <li>Your research question: ${projectData.question || '[your research question]'}</li>
                </ul>
            </div>
            
            <div class="outline-section">
                <h4>üìä Results</h4>
            `;
            
            figures.forEach((fig, index) => {
                const logic = storyLogic[index] || {};
                
                html += `
                <div class="panel-item">
                    <div>
                        <strong>${fig.number}: ${fig.title}</strong><br>
                        <span style="font-size: 0.9em; color: #4a5568;">${fig.message}</span>
                    </div>
                    <div style="text-align: right;">
                        <span style="font-size: 0.8em; color: #718096;">${fig.panels.split('\n').length} panels</span>
                    </div>
                </div>
                
                <div style="padding: 0 20px 15px 20px;">
                    <strong>Rationale:</strong> ${logic.rationale || '[Why this figure is important]'}<br>
                    <strong>Rationale Type:</strong> ${logic.rationaleType || '[Type of scientific rationale]'}<br>
                    <strong>Leads to:</strong> ${logic.question || '[What question this raises]'}<br>
                    <strong>Methods:</strong> ${fig.approach || '[Experimental approach]'}<br>
                    <strong>Controls:</strong> ${fig.controls || '[Experimental controls]'}<br>
                    <strong>Replicates:</strong> ${fig.replicates || '[Replication details]'}<br>
                    <strong>Panels:</strong>
                    <ul style="margin-top: 5px;">
                        ${fig.panels.split('\n').map(panel => `<li>${panel}</li>`).join('')}
                    </ul>
                </div>
                `;
            });
            
            html += `
            </div>
            
            <div class="outline-section">
                <h4>üí¨ Discussion</h4>
                <ul>
                    <li>Summary of key findings: ${projectData.finding || '[your key finding]'}</li>
                    <li>Interpretation in context of existing literature</li>
                    <li>Novelty and significance: ${projectData.novelty || '[your novelty statement]'}</li>
                    <li>Limitations of the study</li>
                    <li>Future directions</li>
                    <li>Conclusion and significance</li>
                </ul>
            </div>
            
            <div class="outline-section">
                <h4>üîß Methods</h4>
                <p><em>Detailed description of experimental procedures for each figure</em></p>
            </div>
            
            <div class="outline-section">
                <h4>üìö References</h4>
                <p><em>Key references in the field + methodological references</em></p>
            </div>
            `;
            
            document.getElementById('outlineContent').innerHTML = html;
            
            // Also update the export preview
            document.getElementById('exportPreview').textContent = generateExportText();
            
            updateProgress();
        }
        
        function generateAbstract() {
            if (figures.length === 0) {
                alert('Please add figures first before generating an abstract.');
                return;
            }
            
            const backgroundGap = `While [current knowledge about ${projectData.disease || 'the system'}], the role of ${projectData.molecule || 'key molecules'} in [specific process] remains poorly understood.`;
            
            const resultsSummary = figures.map((fig, index) => {
                const connector = index === 0 ? "First, we " : 
                                 index === figures.length-1 ? "Finally, we " : "Next, we ";
                return `${connector}${fig.message.toLowerCase()}`;
            }).join('. ') + '.';
            
            const significance = `These findings establish ${projectData.molecule || 'this mechanism'} as [broader significance] and suggest [therapeutic/biological implications].`;
            
            const abstract = `
BACKGROUND: ${backgroundGap}

RESULTS: ${resultsSummary}

CONCLUSION: ${significance}
            `.trim();
            
            document.getElementById('outlineContent').innerHTML = `
            <div class="outline-section">
                <h4>üìÑ Abstract Draft</h4>
                <p style="white-space: pre-line;">${abstract}</p>
                <button class="btn small-btn" onclick="copyAbstract()">üìã Copy Abstract</button>
            </div>
            ` + document.getElementById('outlineContent').innerHTML;
        }
        
        function generateDiscussionPoints() {
            const discussionHTML = `
            <div class="outline-section">
                <h4>üí¨ Discussion Points</h4>
                <div class="input-group">
                    <label>Interpretation of key findings in context of existing literature</label>
                    <textarea class="discussion-input" placeholder="How do your findings relate to previous work?"></textarea>
                </div>
                <div class="input-group">
                    <label>Comparison with previous studies on similar mechanisms</label>
                    <textarea class="discussion-input" placeholder="How are your results similar or different from previous findings?"></textarea>
                </div>
                <div class="input-group">
                    <label>Potential limitations and alternative interpretations</label>
                    <textarea class="discussion-input" placeholder="What are the limitations of your study?"></textarea>
                </div>
                <div class="input-group">
                    <label>Broader implications for the field</label>
                    <textarea class="discussion-input" placeholder="How do your findings advance the field?"></textarea>
                </div>
                <div class="input-group">
                    <label>Future directions suggested by these findings</label>
                    <textarea class="discussion-input" placeholder="What are the next logical experiments?"></textarea>
                </div>
            </div>
            `;
            
            document.getElementById('outlineContent').innerHTML = discussionHTML + document.getElementById('outlineContent').innerHTML;
        }
        
        function generateMethodsSection() {
            let methodsHTML = `
            <div class="methods-section">
                <h4>üîß Methods Outline</h4>
                <p><strong>Statistical Analysis Plan:</strong> ${projectData.statisticalTests || 'Not specified'}</p>
                <p><strong>Power Analysis:</strong> ${projectData.powerAnalysis || 'Not specified'}</p>
                <p><strong>Multiple Testing Corrections:</strong> ${projectData.multipleTesting || 'Not specified'}</p>
                
                <h5>Experimental Methods by Figure:</h5>
            `;
            
            figures.forEach(fig => {
                methodsHTML += `
                <div class="panel-item">
                    <strong>${fig.number}</strong><br>
                    <p><strong>Approach:</strong> ${fig.approach || 'Not specified'}</p>
                    <p><strong>Controls:</strong> ${fig.controls || 'Not specified'}</p>
                    <p><strong>Replicates:</strong> ${fig.replicates || 'Not specified'}</p>
                    <p><strong>Quantification:</strong> ${fig.quantification || 'Not specified'}</p>
                    <p><strong>Key Reagents:</strong> ${fig.reagents || 'Not specified'}</p>
                </div>
                `;
            });
            
            methodsHTML += `</div>`;
            
            document.getElementById('outlineContent').innerHTML = methodsHTML + document.getElementById('outlineContent').innerHTML;
        }
        
        function copyAbstract() {
            const abstractText = document.querySelector('.outline-section p').textContent;
            navigator.clipboard.writeText(abstractText).then(() => {
                alert('Abstract copied to clipboard!');
            });
        }
        
        function generateExportText() {
            let text = `MANUSCRIPT PLAN: ${projectData.title || 'Untitled Project'}\n`;
            text += `Generated on: ${new Date().toLocaleString()}\n`;
            text += `========================================\n\n`;
            
            text += `PROJECT INFORMATION:\n`;
            text += `Title: ${projectData.title || 'Not set'}\n`;
            text += `Research Question: ${projectData.question || 'Not set'}\n`;
            text += `Key Finding: ${projectData.finding || 'Not set'}\n`;
            text += `Central Hypothesis: ${projectData.hypothesis || 'Not set'}\n`;
            text += `Novelty & Significance: ${projectData.novelty || 'Not set'}\n`;
            text += `Disease/System: ${projectData.disease || 'Not set'}\n`;
            text += `Main Molecule: ${projectData.molecule || 'Not set'}\n`;
            text += `Target Journal: ${projectData.journal || 'Not set'}\n`;
            text += `Manuscript Type: ${projectData.manuscriptType || 'Not set'}\n\n`;
            
            text += `STATISTICAL PLANNING:\n`;
            text += `Power Analysis: ${projectData.powerAnalysis || 'Not specified'}\n`;
            text += `Statistical Tests: ${projectData.statisticalTests || 'Not specified'}\n`;
            text += `Multiple Testing Corrections: ${projectData.multipleTesting || 'Not specified'}\n\n`;
            
            text += `FIGURES (${figures.length}):\n`;
            text += `========================================\n\n`;
            
            figures.forEach((fig, index) => {
                text += `${fig.number}: ${fig.title}\n`;
                text += `Type: ${fig.type}\n`;
                text += `Message: ${fig.message}\n`;
                text += `Approach: ${fig.approach}\n`;
                text += `Controls: ${fig.controls || 'Not specified'}\n`;
                text += `Key Reagents: ${fig.reagents || 'Not specified'}\n`;
                text += `Replicates: ${fig.replicates || 'Not specified'}\n`;
                text += `Quantification: ${fig.quantification || 'Not specified'}\n`;
                text += `Statistical Analysis: ${fig.stats}\n`;
                
                const logic = storyLogic[index] || {};
                if (logic.rationaleType) {
                    text += `Rationale Type: ${logic.rationaleType}\n`;
                }
                if (logic.rationale) {
                    text += `Rationale: ${logic.rationale}\n`;
                }
                if (logic.question) {
                    text += `Leads to: ${logic.question}\n`;
                }
                
                text += `Panels:\n`;
                fig.panels.split('\n').forEach(panel => {
                    text += `  - ${panel}\n`;
                });
                text += `\n`;
            });
            
            text += `MANUSCRIPT OUTLINE:\n`;
            text += `========================================\n\n`;
            
            text += `INTRODUCTION\n`;
            text += `- Background on ${projectData.disease || '[disease]'}\n`;
            text += `- Knowledge gap\n`;
            text += `- Hypothesis: ${projectData.hypothesis || '[hypothesis]'}\n`;
            text += `- Research question: ${projectData.question || '[research question]'}\n\n`;
            
            text += `RESULTS\n`;
            figures.forEach(fig => {
                text += `- ${fig.number}: ${fig.title}\n`;
            });
            text += `\n`;
            
            text += `DISCUSSION\n`;
            text += `- Summary: ${projectData.finding || '[key finding]'}\n`;
            text += `- Novelty: ${projectData.novelty || '[novelty]'}\n`;
            text += `- Interpretation and significance\n`;
            text += `- Limitations and future directions\n\n`;
            
            text += `METHODS\n`;
            text += `- Statistical plan: ${projectData.statisticalTests || '[statistical tests]'}\n`;
            text += `- Detailed experimental procedures\n\n`;
            
            text += `REFERENCES\n`;
            text += `- Key literature and methodological references\n`;
            
            return text;
        }
        
        function exportScientificPlan() {
            const text = generateScientificExport();
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `scientific_manuscript_plan_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function generateScientificExport() {
            let text = `SCIENTIFIC MANUSCRIPT PLAN\n`;
            text += `========================================\n\n`;
            
            text += `HYPOTHESIS & RATIONALE:\n`;
            text += `Central Hypothesis: ${projectData.hypothesis || 'Not specified'}\n`;
            text += `Novelty: ${projectData.novelty || 'Not specified'}\n\n`;
            
            text += `EXPERIMENTAL DESIGN:\n`;
            figures.forEach((fig, index) => {
                text += `${fig.number}: ${fig.title}\n`;
                text += `  - Experimental Approach: ${fig.approach || 'Not specified'}\n`;
                text += `  - Controls: ${fig.controls || 'Not specified'}\n`;
                text += `  - Replicates: ${fig.replicates || 'Not specified'}\n`;
                text += `  - Quantification: ${fig.quantification || 'Not specified'}\n`;
                text += `  - Key reagents: ${fig.reagents || 'Not specified'}\n`;
                
                const logic = storyLogic[index] || {};
                if (logic.rationaleType) {
                    text += `  - Scientific Rationale: ${logic.rationaleType}\n`;
                }
                text += `\n`;
            });
            
            text += `STATISTICAL CONSIDERATIONS:\n`;
            text += `Power Analysis: ${projectData.powerAnalysis || 'Not specified'}\n`;
            text += `Statistical Tests: ${projectData.statisticalTests || 'Not specified'}\n`;
            text += `Multiple Testing Corrections: ${projectData.multipleTesting || 'Not specified'}\n\n`;
            
            text += `STORY LOGIC:\n`;
            figures.forEach((fig, index) => {
                const logic = storyLogic[index] || {};
                text += `${fig.number}: ${fig.message}\n`;
                if (logic.question) {
                    text += `  -> Leads to: ${logic.question}\n`;
                }
                text += `\n`;
            });
            
            return text;
        }
        
        function exportToText() {
            const text = generateExportText();
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `manuscript_plan_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function copyToClipboard() {
            const text = generateExportText();
            navigator.clipboard.writeText(text).then(() => {
                alert('Manuscript plan copied to clipboard!');
            });
        }
        
        function exportToWord() {
            const text = generateExportText();
            const htmlContent = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>${projectData.title || 'Manuscript Plan'}</title>
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
                    h1 { color: #2d3748; }
                    h2 { color: #4a5568; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; }
                    .figure { background: #f7fafc; padding: 15px; margin: 15px 0; border-left: 4px solid #667eea; }
                </style>
            </head>
            <body>
                <h1>${projectData.title || 'Manuscript Plan'}</h1>
                <p><strong>Generated on:</strong> ${new Date().toLocaleString()}</p>
                
                <h2>Project Information</h2>
                <p><strong>Research Question:</strong> ${projectData.question || 'Not set'}</p>
                <p><strong>Key Finding:</strong> ${projectData.finding || 'Not set'}</p>
                <p><strong>Central Hypothesis:</strong> ${projectData.hypothesis || 'Not set'}</p>
                <p><strong>Novelty & Significance:</strong> ${projectData.novelty || 'Not set'}</p>
                <p><strong>Disease/System:</strong> ${projectData.disease || 'Not set'}</p>
                <p><strong>Main Molecule:</strong> ${projectData.molecule || 'Not set'}</p>
                
                <h2>Statistical Planning</h2>
                <p><strong>Power Analysis:</strong> ${projectData.powerAnalysis || 'Not specified'}</p>
                <p><strong>Statistical Tests:</strong> ${projectData.statisticalTests || 'Not specified'}</p>
                <p><strong>Multiple Testing Corrections:</strong> ${projectData.multipleTesting || 'Not specified'}</p>
                
                <h2>Figures</h2>
                ${figures.map(fig => `
                <div class="figure">
                    <h3>${fig.number}: ${fig.title}</h3>
                    <p><strong>Message:</strong> ${fig.message}</p>
                    <p><strong>Approach:</strong> ${fig.approach}</p>
                    <p><strong>Controls:</strong> ${fig.controls || 'Not specified'}</p>
                    <p><strong>Key Reagents:</strong> ${fig.reagents || 'Not specified'}</p>
                    <p><strong>Replicates:</strong> ${fig.replicates || 'Not specified'}</p>
                    <p><strong>Quantification:</strong> ${fig.quantification || 'Not specified'}</p>
                    <p><strong>Statistical Analysis:</strong> ${fig.stats}</p>
                    <p><strong>Panels:</strong></p>
                    <ul>
                        ${fig.panels.split('\n').map(panel => `<li>${panel}</li>`).join('')}
                    </ul>
                </div>
                `).join('')}
                
                <h2>Manuscript Outline</h2>
                <h3>Introduction</h3>
                <ul>
                    <li>Background on ${projectData.disease || '[disease]'}</li>
                    <li>Knowledge gap</li>
                    <li>Hypothesis: ${projectData.hypothesis || '[hypothesis]'}</li>
                    <li>Research question: ${projectData.question || '[research question]'}</li>
                </ul>
                
                <h3>Results</h3>
                <ul>
                    ${figures.map(fig => `<li>${fig.number}: ${fig.title}</li>`).join('')}
                </ul>
                
                <h3>Discussion</h3>
                <ul>
                    <li>Summary: ${projectData.finding || '[key finding]'}</li>
                    <li>Novelty: ${projectData.novelty || '[novelty]'}</li>
                    <li>Interpretation and significance</li>
                    <li>Limitations and future directions</li>
                </ul>
            </body>
            </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `manuscript_plan_${new Date().toISOString().split('T')[0]}.doc`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function clearAll() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                projectData = {};
                figures = [];
                storyLogic = [];
                
                // Clear all form fields
                document.getElementById('projectTitle').value = '';
                document.getElementById('researchQuestion').value = '';
                document.getElementById('keyFinding').value = '';
                document.getElementById('diseaseSystem').value = '';
                document.getElementById('mainMolecule').value = '';
                document.getElementById('journalTarget').value = '';
                document.getElementById('manuscriptType').value = 'research-article';
                document.getElementById('centralHypothesis').value = '';
                document.getElementById('noveltySignificance').value = '';
                document.getElementById('powerAnalysis').value = '';
                document.getElementById('statisticalTests').value = '';
                document.getElementById('multipleTesting').value = '';
                
                document.getElementById('figureTitle').value = '';
                document.getElementById('figureMessage').value = '';
                document.getElementById('figureApproach').value = '';
                document.getElementById('figurePanels').value = '';
                document.getElementById('figureStats').value = '';
                document.getElementById('figureControls').value = '';
                document.getElementById('figureReagents').value = '';
                document.getElementById('figureReplicates').value = '';
                document.getElementById('figureQuantification').value = '';
                
                document.getElementById('methodsDetails').value = '';
                document.getElementById('authorContributions').value = '';
                document.getElementById('projectTimeline').value = '';
                
                document.getElementById('figuresList').innerHTML = '';
                document.getElementById('logicContent').innerHTML = '';
                document.getElementById('outlineContent').innerHTML = '';
                document.getElementById('exportPreview').textContent = 'Click "Generate Manuscript Outline" in the Outline tab first...';
                
                updateProgress();
                
                alert('All data cleared!');
            }
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
        });
    </script>
</body>
</html>