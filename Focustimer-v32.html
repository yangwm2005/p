<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowFocus | Advanced Productivity Timer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border-radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            flex: 1;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo i {
            color: var(--primary);
            font-size: 28px;
        }

        h1 {
            color: var(--primary);
            font-size: 2.2rem;
            font-weight: 700;
        }

        .tagline {
            color: var(--gray);
            font-size: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .timer-card {
                position: static !important;
            }
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            height: fit-content;
        }

        .timer-card {
            position: sticky;
            top: 20px;
            z-index: 10;
        }

        .card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .timer-display {
            font-size: 4.5rem;
            font-weight: 700;
            text-align: center;
            color: var(--primary);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.5s ease;
        }

        .timer-display.time-up {
            animation: flash 1s infinite alternate;
            color: var(--danger);
        }

        @keyframes flash {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0.7; transform: scale(1.05); }
        }

        .mode-indicator {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .focus-mode {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .break-mode {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning);
        }

        .progress-container {
            margin: 25px 0;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--gray-light);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.5s ease;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #3aa8d1;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e6890e;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #e11574;
        }

        .btn-info {
            background-color: var(--success);
            color: white;
        }

        .btn-info:hover {
            background-color: #3aa8d1;
        }

        .timer-settings {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .setting-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .setting-group input {
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            width: 80px;
            text-align: center;
            font-weight: 600;
            transition: var(--transition);
        }

        .setting-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .sound-toggle {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .sound-toggle:hover {
            background: var(--gray-light);
        }

        .sound-toggle input {
            margin: 0;
        }

        .sound-toggle label {
            margin: 0;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray);
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .task-form {
            margin-bottom: 20px;
        }

        .task-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .task-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .task-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .task-notes-input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical;
            min-height: 60px;
        }

        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .task-item:hover {
            background-color: var(--gray-light);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .task-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            flex: 1;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            margin-top: 2px;
        }

        .task-details {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .task-notes {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 4px;
        }

        .task-note-line {
            display: block;
            margin-bottom: 4px;
            padding-left: 10px;
            position: relative;
        }

        .task-note-line:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .task-completed .task-name {
            text-decoration: line-through;
            color: var(--gray);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--gray);
            font-size: 1rem;
            transition: var(--transition);
            padding: 6px;
            border-radius: 4px;
        }

        .icon-btn:hover {
            color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .quick-note-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-note-btn:hover {
            background: var(--secondary);
        }

        .focus-on-btn {
            background: var(--warning);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .focus-on-btn:hover {
            background: #e6890e;
        }

        .records-container {
            margin-top: 30px;
        }

        .data-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .project-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .project-selector select {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
        }

        .records-table-container {
            overflow-x: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
            table-layout: fixed;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
            vertical-align: top;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            font-size: 0.85rem;
            position: sticky;
            top: 0;
        }

        /* Column width adjustments */
        .col-date { width: 120px; }
        .col-project { width: 140px; }
        .col-session-details { width: 200px; }
        .col-task-notes { width: 200px; }
        .col-work-notes { width: 200px; }
        .col-ideas { width: 200px; }
        .col-actions { width: 60px; }

        tr {
            transition: var(--transition);
        }

        tr:not(:first-child):hover {
            background-color: rgba(67, 97, 238, 0.03);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--gray-light);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }

        .stat-item {
            padding: 15px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .session-task-item {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px;
        }

        .session-task-content {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            flex: 1;
        }

        .session-task-details {
            flex: 1;
        }

        .session-task-completed {
            text-decoration: line-through;
            color: var(--gray);
        }

        .session-task-notes {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 2px;
            margin-left: 20px;
        }

        .task-note-bullet {
            display: block;
            margin-bottom: 2px;
            padding-left: 12px;
            position: relative;
            font-size: 0.8rem;
        }

        .task-note-bullet:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .project-notes-cell {
            max-height: 100px;
            overflow-y: auto;
            font-size: 0.85rem;
        }

        .session-details-cell {
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
        }

        .work-notes-cell, .ideas-cell, .task-notes-cell {
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.85rem;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
        }

        /* Quick Note Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
            transform: translateY(-20px);
            transition: var(--transition);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-task-name {
            font-weight: 600;
            margin-bottom: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: 6px;
        }

        .modal-notes-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            min-height: 120px;
            margin-bottom: 10px;
        }

        .modal-notes-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .notes-help {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Report Modal */
        .report-modal {
            max-width: 900px;
        }

        .report-section {
            margin-bottom: 25px;
        }

        .report-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-light);
        }

        .project-report {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .project-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .project-stats {
            display: flex;
            gap: 15px;
        }

        .project-stat {
            text-align: center;
        }

        .project-stat-value {
            font-weight: 700;
            color: var(--primary);
        }

        .project-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .task-report {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .task-report-item {
            margin-bottom: 10px;
            padding: 8px;
            border-left: 3px solid var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .task-report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .task-report-name {
            font-weight: 600;
        }

        .task-report-status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--success);
            color: white;
        }

        .task-report-status.incomplete {
            background: var(--gray);
        }

        .task-report-notes {
            margin-top: 5px;
        }

        .note-highlight {
            background: rgba(255, 235, 59, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
            margin: 2px 0;
        }

        .report-summary {
            background: var(--primary-light);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .summary-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .summary-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Continue Tasks Section */
        .continue-tasks-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
        }

        .continue-tasks-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .continue-task-item {
            background: rgba(76, 201, 240, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .continue-task-info {
            flex: 1;
        }

        .continue-task-name {
            font-weight: 500;
        }

        .continue-task-project {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .continue-task-actions {
            display: flex;
            gap: 5px;
        }

        /* Status Bar (Bottom Fixed) */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            z-index: 1001;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .status-bar.hidden {
            transform: translateY(100%);
        }

        .status-bar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-bar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-timer {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            min-width: 80px;
        }

        .status-mode {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
        }

        .status-progress {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .status-progress-bar {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.5s ease;
        }

        .status-controls {
            display: flex;
            gap: 8px;
        }

        .status-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .status-toggle {
            position: fixed;
            bottom: 70px;
            right: 20px;
            z-index: 1002;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .status-toggle:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        /* Time-up notification */
        .time-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--danger);
            color: white;
            padding: 30px 50px;
            border-radius: var(--border-radius);
            font-size: 2rem;
            font-weight: 700;
            z-index: 1003;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: pulse 0.5s infinite alternate;
            text-align: center;
        }

        @keyframes pulse {
            from { transform: translate(-50%, -50%) scale(1); }
            to { transform: translate(-50%, -50%) scale(1.1); }
        }

        .time-up-notification.hidden {
            display: none;
        }

        /* Work Mode Styles */
        .work-mode-active {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1004;
            display: none;
            flex-direction: column;
        }

        .work-mode-active.active {
            display: flex;
        }

        .work-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .work-header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .work-timer-display {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            min-width: 100px;
        }

        .work-mode-indicator {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
        }

        .work-controls {
            display: flex;
            gap: 10px;
        }

        .work-timer-controls {
            display: flex;
            gap: 8px;
        }

        .work-timer-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .work-timer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Expand Time Button Styles */
        .expand-time-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .expand-time-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .expand-time-dropdown {
            position: relative;
            display: inline-block;
        }

        .expand-time-dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
            right: 0;
            top: 100%;
            margin-top: 5px;
            margin-top: 5px; /* Add this to eliminate the gap */
        }

.expand-time-dropdown::after {
    content: '';
    position: absolute;
    bottom: -5px; /* Extends below the button */
    left: 0;
    width: 100%;
    height: 10px; /* Creates an invisible hover area */
    background: transparent;
}

        .expand-time-dropdown-content a {
            color: var(--dark);
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: var(--transition);
        }

        .expand-time-dropdown-content a:hover {
            background-color: var(--gray-light);
        }

        .expand-time-dropdown:hover .expand-time-dropdown-content {
            display: block;
        }

        .work-main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .work-content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .work-tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid var(--gray-light);
        }

        .work-tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            border-bottom: 3px solid transparent;
        }

        .work-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: white;
        }

        .work-tab:hover {
            color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .work-tab-content {
            flex: 1;
            padding: 0;
            display: none;
            overflow-y: auto;
        }

        .work-tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .work-task-area {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .work-history-area {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .work-notes-area {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .notes-editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .notes-section {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .notes-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .notes-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            transition: var(--transition);
        }

        .notes-textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .notes-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .idea-section {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }

        .idea-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid var(--success);
        }

        .idea-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .idea-content {
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .idea-actions {
            display: flex;
            gap: 5px;
        }

        .work-current-task {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .work-current-task h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .work-task-stats {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .work-task-stat {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 6px;
            flex: 1;
            box-shadow: var(--shadow);
        }

        .work-task-stat-value {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .work-task-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Time-up flash animation */
        @keyframes timeUpFlash {
            0%, 100% { background-color: white; }
            50% { background-color: rgba(247, 37, 133, 0.1); }
        }

        .time-up-flash {
            animation: timeUpFlash 1s ease 3;
        }

        /* Project Management Styles */
        .project-management {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
        }

        .project-management-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .project-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .project-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--light);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .project-name {
            font-weight: 500;
        }

        .project-actions {
            display: flex;
            gap: 5px;
        }

        .add-project-form {
            display: flex;
            gap: 10px;
        }

        .add-project-input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 6px;
        }
        
        /* Save Section Styles */
        .save-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
        }
        
        .save-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .save-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Floating Work Mode Button */
        .floating-work-mode {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 1002;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: var(--transition);
        }
        
        .floating-work-mode:hover {
            background: var(--secondary);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        .floating-work-mode.in-work-mode {
            background: var(--warning);
        }
        
        .floating-work-mode.in-work-mode:hover {
            background: #e6890e;
        }

        /* Floating Back to Main Button (in Work Mode) */
        .floating-back-main {
            position: fixed;
            bottom: 180px;
            right: 20px;
            z-index: 1005; /* Higher z-index to appear above work mode */
            background: var(--success);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            transition: var(--transition);
            opacity: 0;
            visibility: hidden;
        }
        
        .floating-back-main.active {
            opacity: 1;
            visibility: visible;
        }
        
        .floating-back-main:hover {
            background: #3aa8d1;
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        /* Two-column layout for Notes and Ideas in Work Mode */
        .notes-ideas-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 100%;
        }

        @media (max-width: 768px) {
            .notes-ideas-grid {
                grid-template-columns: 1fr;
            }
        }

        .notes-column, .ideas-column {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .notes-column-header, .ideas-column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
        }

        .notes-column-header h3, .ideas-column-header h3 {
            color: var(--primary);
            margin: 0;
            font-size: 1.2rem;
        }

        .notes-column-content, .ideas-column-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .notes-textarea-large {
            flex: 1;
            min-height: 300px;
            padding: 15px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            resize: vertical;
            transition: var(--transition);
        }

        .notes-textarea-large:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        /* Updated Ideas layout - input at top */
        .idea-input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .idea-textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.95rem;
            min-height: 100px;
            resize: vertical;
        }

        .idea-textarea:focus {
            border-color: var(--success);
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
        }

        .ideas-list-container {
            flex: 1;
            overflow-y: auto;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            padding: 15px;
            background: white;
        }

        /* Clear All Button */
        .clear-all-container {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: center;
        }

        /* Auto-save indicator styles */
        .save-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .save-indicator.visible {
            opacity: 1;
        }

        .save-indicator.saving {
            color: var(--warning);
        }

        .save-indicator.saved {
            color: var(--success);
        }

        .save-indicator.error {
            color: var(--danger);
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Work Mode -->
    <div class="work-mode-active" id="work-mode-overlay">
        <div class="work-header">
            <div class="work-header-left">
                <div class="work-timer-display" id="work-header-timer">25:00</div>
                <div class="work-mode-indicator" id="work-header-mode">Focus Time</div>
                <div class="work-timer-controls">
                    <button class="work-timer-btn" id="work-start-btn">
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="work-timer-btn" id="work-pause-btn">
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="work-timer-btn" id="work-skip-btn">
                        <i class="fas fa-forward"></i> Skip
                    </button>
                    <!-- Expand Time Button -->
                    <div class="expand-time-dropdown">
                        <button class="expand-time-btn">
                            <i class="fas fa-plus-circle"></i> Expand Time
                        </button>
                        <div class="expand-time-dropdown-content">
                            <a href="#" id="expand-5-min">+5 Minutes</a>
                            <a href="#" id="expand-10-min">+10 Minutes</a>
                            <a href="#" id="expand-15-min">+15 Minutes</a> <!-- Add this line -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="work-controls">
                <button class="work-timer-btn" id="work-exit-btn">
                    <i class="fas fa-times"></i> Exit Work Mode
                </button>
            </div>
        </div>
        <div class="work-main-content">
            <div class="work-content-area">
                <div class="work-tabs">
                    <button class="work-tab active" data-tab="work-tasks">Current Task</button>
                    <button class="work-tab" data-tab="work-history">Session History</button>
                    <button class="work-tab" data-tab="work-notes">Work Notes & Ideas</button>
                </div>
                <div class="work-tab-content active" id="work-tasks">
                    <div class="work-task-area">
                        <div class="work-current-task">
                            <h3>Current Focus Task</h3>
                            <div id="work-current-task-name">No task selected</div>
                            <div class="work-task-stats">
                                <div class="work-task-stat">
                                    <div class="work-task-stat-value" id="work-task-focus-time">0 min</div>
                                    <div class="work-task-stat-label">Focus Time</div>
                                </div>
                                <div class="work-task-stat">
                                    <div class="work-task-stat-value" id="work-task-completed">0</div>
                                    <div class="work-task-stat-label">Completed</div>
                                </div>
                                <div class="work-task-stat">
                                    <div class="work-task-stat-value" id="work-task-total">0</div>
                                    <div class="work-task-stat-label">Total Tasks</div>
                                </div>
                            </div>
                        </div>
                        <h3>Task List</h3>
                        <div class="task-list" id="work-task-list">
                            <!-- Tasks will be populated here -->
                        </div>
                    </div>
                </div>
                <div class="work-tab-content" id="work-history">
                    <div class="work-history-area">
                        <h3>Today's Sessions</h3>
                        <div class="records-table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th class="col-date">Date</th>
                                        <th class="col-project">Project</th>
                                        <th class="col-session-details">Session Details</th>
                                        <th class="col-task-notes">Task Notes</th>
                                        <th class="col-work-notes">Work Notes</th>
                                        <th class="col-ideas">Ideas</th>
                                        <th class="col-actions">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="work-history-table">
                                    <!-- History rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="work-tab-content" id="work-notes">
                    <div class="work-notes-area">
                        <div class="notes-ideas-grid">
                            <div class="notes-column">
                                <div class="notes-column-header">
                                    <h3>Work Notes</h3>
                                    <div class="notes-actions">
                                        <button class="btn btn-primary" id="save-work-notes">
                                            <i class="fas fa-save"></i> Save
                                        </button>
                                        <button class="btn btn-secondary" id="clear-work-notes">
                                            <i class="fas fa-broom"></i> Clear
                                        </button>
                                        <span class="save-indicator" id="work-notes-save-indicator">
                                            <i class="fas fa-circle"></i>
                                            <span class="save-text">Saved</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="notes-column-content">
                                    <textarea class="notes-textarea-large" id="work-notes-input" placeholder="Add notes about your work session..."></textarea>
                                </div>
                            </div>
                            <div class="ideas-column">
                                <div class="ideas-column-header">
                                    <h3>Ideas & Insights</h3>
                                    <button class="btn btn-secondary" id="clear-ideas">
                                        <i class="fas fa-broom"></i> Clear All
                                    </button>
                                </div>
                                <div class="ideas-column-content">
                                    <!-- Updated input to textarea -->
                                    <div class="idea-input-container">
                                        <textarea class="idea-textarea" id="idea-input" placeholder="Add a new idea or insight..."></textarea>
                                        <button class="btn btn-success" id="add-idea">
                                            <i class="fas fa-plus"></i> Add Idea
                                        </button>
                                    </div>
                                    <div class="ideas-list-container" id="ideas-list">
                                        <!-- Ideas will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Clear All Button -->
                        <div class="clear-all-container">
                            <button class="btn btn-danger" id="clear-all-notes-ideas">
                                <i class="fas fa-trash-alt"></i> Clear All Notes & Ideas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-hourglass-half"></i>
                <h1>FlowFocus</h1>
            </div>
            <p class="tagline">Advanced productivity timer with task tracking and insights</p>
        </header>

        <div class="app-container">
            <!-- Timer Section -->
            <div class="timer-card card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-clock"></i> Timer
                    </h2>
                    <div class="mode-indicator focus-mode">Focus Time</div>
                </div>
                
                <div class="timer-display" id="timer-display">25:00</div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress" id="progress-bar"></div>
                    </div>
                </div>
                
                <div class="timer-controls">
                    <button class="btn btn-primary" id="start-btn">
                        <i class="fas fa-play"></i> Start
                    </button>
                    <button class="btn btn-secondary" id="pause-btn">
                        <i class="fas fa-pause"></i> Pause
                    </button>
                    <button class="btn btn-warning" id="skip-btn">
                        <i class="fas fa-forward"></i> Skip
                    </button>
                    <button class="btn btn-danger" id="reset-btn">
                        <i class="fas fa-stop"></i> Reset
                    </button>
                </div>
                
                <div class="timer-settings">
                    <div class="setting-group">
                        <label for="focus-time">Focus (min)</label>
                        <input type="number" id="focus-time" min="1" max="120" value="25">
                    </div>
                    <div class="setting-group">
                        <label for="break-time">Break (min)</label>
                        <input type="number" id="break-time" min="1" max="60" value="5">
                    </div>
                </div>
                
                <div class="sound-settings">
                    <div class="sound-toggle">
                        <input type="checkbox" id="sound-toggle" checked>
                        <label for="sound-toggle">Enable notification sounds</label>
                    </div>
                    <div class="sound-toggle">
                        <input type="checkbox" id="tick-sound-toggle" checked>
                        <label for="tick-sound-toggle">Enable ticking sound</label>
                    </div>
                </div>

                <!-- Save Section -->
                <div class="save-section">
                    <h3 class="save-section-title">Save & Export</h3>
                    <div class="save-actions">
                        <button class="btn btn-success" id="save-session-btn">
                            <i class="fas fa-save"></i> Save Session
                        </button>
                        <button class="btn btn-info" id="save-all-btn">
                            <i class="fas fa-download"></i> Save All Data
                        </button>
                        <button class="btn btn-secondary" id="load-data-btn">
                            <i class="fas fa-upload"></i> Load Data
                        </button>
                    </div>
                </div>

                <div class="continue-tasks-section">
                    <h3 class="continue-tasks-title">Continue Tasks</h3>
                    <div id="continue-tasks-list">
                        <!-- Continue tasks will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Tasks Section -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-tasks"></i> Tasks
                    </h2>
                    <button class="btn btn-primary" id="work-mode-btn">
                        <i class="fas fa-briefcase"></i> Work Mode
                    </button>
                </div>
                
                <div class="task-form">
                    <div class="task-input-group">
                        <input type="text" class="task-input" id="task-input" placeholder="Add a new task...">
                        <button class="btn btn-primary" id="add-task-btn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                    <select id="project-select" class="task-input">
                        <!-- Projects will be populated dynamically -->
                    </select>
                    <textarea class="task-notes-input" id="task-notes-input" placeholder="Add notes for this task..."></textarea>
                    <div class="save-indicator" id="task-notes-save-indicator">
                        <i class="fas fa-circle"></i>
                        <span class="save-text">Auto-save enabled</span>
                    </div>
                </div>
                
                <div class="task-list" id="task-list">
                    <!-- Tasks will be populated here -->
                </div>

                <!-- Project Management Section -->
                <div class="project-management">
                    <h3 class="project-management-title">Manage Projects</h3>
                    <div class="project-list" id="project-list">
                        <!-- Projects will be populated here -->
                    </div>
                    <div class="add-project-form">
                        <input type="text" class="add-project-input" id="add-project-input" placeholder="Add a new project...">
                        <button class="btn btn-primary" id="add-project-btn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- History Section -->
        <div class="records-container">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-history"></i> Session History
                    </h2>
                    <div class="data-actions">
                        <button class="btn btn-secondary" id="clear-history-btn">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                        <button class="btn btn-info" id="generate-report-btn">
                            <i class="fas fa-chart-bar"></i> Generate Report
                        </button>
                    </div>
                </div>
                
                <div class="project-selector">
                    <label for="history-project-filter">Filter by Project:</label>
                    <select id="history-project-filter">
                        <option value="all">All Projects</option>
                        <!-- Projects will be populated dynamically -->
                    </select>
                </div>
                
                <div class="records-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th class="col-date">Date</th>
                                <th class="col-project">Project</th>
                                <th class="col-session-details">Session Details</th>
                                <th class="col-task-notes">Task Notes</th>
                                <th class="col-work-notes">Work Notes</th>
                                <th class="col-ideas">Ideas</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="history-table">
                            <!-- History rows will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Stats Section -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-sessions">0</div>
                <div class="stat-label">Total Sessions</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-focus-time">0h 0m</div>
                <div class="stat-label">Focus Time</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="tasks-completed">0</div>
                <div class="stat-label">Tasks Completed</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="productivity-score">0%</div>
                <div class="stat-label">Productivity</div>
            </div>
        </div>
        
        <footer>
            <p>FlowFocus Timer &copy; 2025 Wen-Ming Yang. All Rights Reserved. (v32) | Report History editable</p>
        </footer>
    </div>

    <!-- Status Bar (Bottom) -->
    <div class="status-bar" id="status-bar">
        <div class="status-bar-left">
            <div class="status-timer" id="status-timer">25:00</div>
            <div class="status-mode" id="status-mode">Focus</div>
            <div class="status-progress">
                <div class="status-progress-bar" id="status-progress-bar"></div>
            </div>
        </div>
        <div class="status-bar-right">
            <div class="status-controls">
                <button class="status-btn" id="status-start-btn">
                    <i class="fas fa-play"></i>
                </button>
                <button class="status-btn" id="status-pause-btn">
                    <i class="fas fa-pause"></i>
                </button>
                <button class="status-btn" id="status-skip-btn">
                    <i class="fas fa-forward"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Status Toggle Button -->
    <button class="status-toggle" id="status-toggle">
        <i class="fas fa-chevron-up"></i>
    </button>
    
    <!-- Floating Work Mode Button -->
    <button class="floating-work-mode" id="floating-work-mode">
        <i class="fas fa-briefcase"></i>
    </button>
    
    <!-- Floating Back to Main Button -->
    <button class="floating-back-main" id="floating-back-main">
        <i class="fas fa-home"></i>
    </button>
    
    <!-- Time Up Notification -->
    <div class="time-up-notification hidden" id="time-up-notification">
        Time's Up!
    </div>
    
    <!-- Quick Note Modal -->
    <div class="modal-overlay" id="quick-note-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Quick Note</h3>
                <button class="modal-close" id="close-quick-note-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-task-name" id="modal-task-name">Task Name</div>
                <textarea class="modal-notes-input" id="modal-notes-input" placeholder="Add your notes here..."></textarea>
                <p class="notes-help">Use bullet points for better organization (start each line with - or *)</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-quick-note">Cancel</button>
                <button class="btn btn-primary" id="save-quick-note">Save Note</button>
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div class="modal-overlay" id="report-modal">
        <div class="modal report-modal">
            <div class="modal-header">
                <h3 class="modal-title">Productivity Report</h3>
                <button class="modal-close" id="close-report-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-summary">
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <div class="summary-stat-value" id="report-total-sessions">0</div>
                            <div class="summary-stat-label">Total Sessions</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value" id="report-total-focus-time">0h 0m</div>
                            <div class="summary-stat-label">Focus Time</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value" id="report-tasks-completed">0</div>
                            <div class="summary-stat-label">Tasks Completed</div>
                        </div>
                        <div class="summary-stat">
                            <div class="summary-stat-value" id="report-productivity-score">0%</div>
                            <div class="summary-stat-label">Productivity</div>
                        </div>
                    </div>
                </div>
                
                <div class="report-section">
                    <h3 class="report-section-title">Project Breakdown</h3>
                    <div id="project-reports">
                        <!-- Project reports will be populated here -->
                    </div>
                </div>
                
                <div class="report-section">
                    <h3 class="report-section-title">Task Completion</h3>
                    <div id="task-reports">
                        <!-- Task reports will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-report">Close</button>
                <button class="btn btn-primary" id="export-report">
                    <i class="fas fa-download"></i> Export as PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Project Edit Modal -->
    <div class="modal-overlay" id="project-edit-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Edit Project</h3>
                <button class="modal-close" id="close-project-edit-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit-project-name">Project Name</label>
                    <input type="text" id="edit-project-name" class="task-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-project-edit">Cancel</button>
                <button class="btn btn-primary" id="save-project-edit">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const timerDisplay = document.getElementById('timer-display');
        const progressBar = document.getElementById('progress-bar');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const skipBtn = document.getElementById('skip-btn');
        const resetBtn = document.getElementById('reset-btn');
        const focusTimeInput = document.getElementById('focus-time');
        const breakTimeInput = document.getElementById('break-time');
        const soundToggle = document.getElementById('sound-toggle');
        const tickSoundToggle = document.getElementById('tick-sound-toggle');
        const taskInput = document.getElementById('task-input');
        const taskNotesInput = document.getElementById('task-notes-input');
        const addTaskBtn = document.getElementById('add-task-btn');
        const projectSelect = document.getElementById('project-select');
        const taskList = document.getElementById('task-list');
        const historyTable = document.getElementById('history-table');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        const generateReportBtn = document.getElementById('generate-report-btn');
        const historyProjectFilter = document.getElementById('history-project-filter');
        const totalSessionsEl = document.getElementById('total-sessions');
        const totalFocusTimeEl = document.getElementById('total-focus-time');
        const tasksCompletedEl = document.getElementById('tasks-completed');
        const productivityScoreEl = document.getElementById('productivity-score');
        const statusBar = document.getElementById('status-bar');
        const statusTimer = document.getElementById('status-timer');
        const statusMode = document.getElementById('status-mode');
        const statusProgressBar = document.getElementById('status-progress-bar');
        const statusStartBtn = document.getElementById('status-start-btn');
        const statusPauseBtn = document.getElementById('status-pause-btn');
        const statusSkipBtn = document.getElementById('status-skip-btn');
        const statusToggle = document.getElementById('status-toggle');
        const timeUpNotification = document.getElementById('time-up-notification');
        const quickNoteModal = document.getElementById('quick-note-modal');
        const modalTaskName = document.getElementById('modal-task-name');
        const modalNotesInput = document.getElementById('modal-notes-input');
        const closeQuickNoteModal = document.getElementById('close-quick-note-modal');
        const cancelQuickNote = document.getElementById('cancel-quick-note');
        const saveQuickNote = document.getElementById('save-quick-note');
        const reportModal = document.getElementById('report-modal');
        const closeReportModal = document.getElementById('close-report-modal');
        const closeReport = document.getElementById('close-report');
        const exportReport = document.getElementById('export-report');
        const reportTotalSessions = document.getElementById('report-total-sessions');
        const reportTotalFocusTime = document.getElementById('report-total-focus-time');
        const reportTasksCompleted = document.getElementById('report-tasks-completed');
        const reportProductivityScore = document.getElementById('report-productivity-score');
        const projectReports = document.getElementById('project-reports');
        const taskReports = document.getElementById('task-reports');
        const workModeBtn = document.getElementById('work-mode-btn');
        const workModeOverlay = document.getElementById('work-mode-overlay');
        const workHeaderTimer = document.getElementById('work-header-timer');
        const workHeaderMode = document.getElementById('work-header-mode');
        const workStartBtn = document.getElementById('work-start-btn');
        const workPauseBtn = document.getElementById('work-pause-btn');
        const workSkipBtn = document.getElementById('work-skip-btn');
        const workExitBtn = document.getElementById('work-exit-btn');
        const workCurrentTaskName = document.getElementById('work-current-task-name');
        const workTaskFocusTime = document.getElementById('work-task-focus-time');
        const workTaskCompleted = document.getElementById('work-task-completed');
        const workTaskTotal = document.getElementById('work-task-total');
        const workTaskList = document.getElementById('work-task-list');
        const workHistoryTable = document.getElementById('work-history-table');
        const workNotesInput = document.getElementById('work-notes-input');
        const saveWorkNotes = document.getElementById('save-work-notes');
        const clearWorkNotes = document.getElementById('clear-work-notes');
        const ideaInput = document.getElementById('idea-input');
        const addIdea = document.getElementById('add-idea');
        const clearIdeas = document.getElementById('clear-ideas');
        const ideasList = document.getElementById('ideas-list');
        const continueTasksList = document.getElementById('continue-tasks-list');
        const workTabs = document.querySelectorAll('.work-tab');
        const workTabContents = document.querySelectorAll('.work-tab-content');
        const projectList = document.getElementById('project-list');
        const addProjectInput = document.getElementById('add-project-input');
        const addProjectBtn = document.getElementById('add-project-btn');
        const projectEditModal = document.getElementById('project-edit-modal');
        const editProjectName = document.getElementById('edit-project-name');
        const closeProjectEditModal = document.getElementById('close-project-edit-modal');
        const cancelProjectEdit = document.getElementById('cancel-project-edit');
        const saveProjectEdit = document.getElementById('save-project-edit');
        const saveSessionBtn = document.getElementById('save-session-btn');
        const saveAllBtn = document.getElementById('save-all-btn');
        const loadDataBtn = document.getElementById('load-data-btn');
        
        // Add the floating work mode button
        const floatingWorkModeBtn = document.getElementById('floating-work-mode');
        const floatingBackMainBtn = document.getElementById('floating-back-main');
        
        // New elements for enhanced features
        const clearAllNotesIdeasBtn = document.getElementById('clear-all-notes-ideas');
        
        // Auto-save elements
        const workNotesSaveIndicator = document.getElementById('work-notes-save-indicator');
        const taskNotesSaveIndicator = document.getElementById('task-notes-save-indicator');

        // Expand Time elements
        const expand5MinBtn = document.getElementById('expand-5-min');
        const expand10MinBtn = document.getElementById('expand-10-min');

        // Timer state
        let timer;
        let isRunning = false;
        let isFocusMode = true;
        let timeLeft = 25 * 60; // 25 minutes in seconds
        let totalTime = 25 * 60;
        let sessions = [];
        let tasks = [];
        let projects = ['General']; // Start with just "General" project
        let currentTaskId = null;
        let currentSession = null;
        let workNotes = '';
        let ideas = [];
        let currentProjectEditId = null;
        let tickSound = null;
        let tickInterval = null;
        
        // Auto-save variables
        let workNotesSaveTimeout;
        let taskNotesSaveTimeout;

        // Initialize the app
        function init() {
            loadData();
            updateTimerDisplay();
            updateTaskList();
            updateHistoryTable();
            updateStats();
            updateContinueTasks();
            updateProjectList();
            updateProjectSelect();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize auto-save functionality
            initAutoSave();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Timer controls
            startBtn.addEventListener('click', startTimer);
            pauseBtn.addEventListener('click', pauseTimer);
            skipBtn.addEventListener('click', skipTimer);
            resetBtn.addEventListener('click', resetTimer);
            
            // Status bar controls
            statusStartBtn.addEventListener('click', startTimer);
            statusPauseBtn.addEventListener('click', pauseTimer);
            statusSkipBtn.addEventListener('click', skipTimer);
            
            // Timer settings
            focusTimeInput.addEventListener('change', updateTimerSettings);
            breakTimeInput.addEventListener('change', updateTimerSettings);
            
            // Sound settings
            soundToggle.addEventListener('change', saveData);
            tickSoundToggle.addEventListener('change', saveData);
            
            // Task management
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            
            // History and reports
            clearHistoryBtn.addEventListener('click', clearHistory);
            generateReportBtn.addEventListener('click', generateReport);
            historyProjectFilter.addEventListener('change', updateHistoryTable);
            
            // Status bar toggle
            statusToggle.addEventListener('click', toggleStatusBar);
            
            // Quick note modal
            closeQuickNoteModal.addEventListener('click', closeQuickNoteModalFunc);
            cancelQuickNote.addEventListener('click', closeQuickNoteModalFunc);
            saveQuickNote.addEventListener('click', saveQuickNoteFunc);
            
            // Report modal
            closeReportModal.addEventListener('click', closeReportModalFunc);
            closeReport.addEventListener('click', closeReportModalFunc);
            exportReport.addEventListener('click', exportReportAsPDF);
            
            // Work mode
            workModeBtn.addEventListener('click', enterWorkMode);
            workStartBtn.addEventListener('click', startTimer);
            workPauseBtn.addEventListener('click', pauseTimer);
            workSkipBtn.addEventListener('click', skipTimer);
            workExitBtn.addEventListener('click', exitWorkMode);
            
            // Work mode tabs
            workTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchWorkTab(tabId);
                });
            });
            
            // Work notes and ideas
            saveWorkNotes.addEventListener('click', saveWorkNotesFunc);
            clearWorkNotes.addEventListener('click', clearWorkNotesFunc);
            addIdea.addEventListener('click', addIdeaFunc);
            clearIdeas.addEventListener('click', clearIdeasFunc);
            
            // Project management
            addProjectBtn.addEventListener('click', addProject);
            addProjectInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addProject();
            });
            
            // Project edit modal
            closeProjectEditModal.addEventListener('click', closeProjectEditModalFunc);
            cancelProjectEdit.addEventListener('click', closeProjectEditModalFunc);
            saveProjectEdit.addEventListener('click', saveProjectEditFunc);
            
            // Save and load functionality
            saveSessionBtn.addEventListener('click', saveCurrentSession);
            saveAllBtn.addEventListener('click', saveAllData);
            loadDataBtn.addEventListener('click', loadDataFromFile);
            
            // Floating buttons
            floatingWorkModeBtn.addEventListener('click', toggleWorkMode);
            floatingBackMainBtn.addEventListener('click', exitWorkMode);
            
            // Enter key for idea input
            ideaInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    addIdeaFunc();
                }
            });
            
            // New clear all button
            clearAllNotesIdeasBtn.addEventListener('click', clearAllNotesIdeas);
            
            // Expand time buttons
            expand5MinBtn.addEventListener('click', expandTime5Min);
            expand10MinBtn.addEventListener('click', expandTime10Min);
            expand15MinBtn.addEventListener('click', expandTime15Min);
            
            // Initialize work mode
            updateWorkModeDisplay();
        }

        // Expand time functions
        function expandTime5Min(e) {
            e.preventDefault();
            expandTime(5);
        }

        function expandTime10Min(e) {
            e.preventDefault();
            expandTime(10);
        }

function expandTime15Min(e) {
    e.preventDefault();
    expandTime(15);
}

// Add 15-minute option functionality
const expand15MinBtn = document.getElementById('expand-15-min');
expand15MinBtn.addEventListener('click', function(e) {
    e.preventDefault();
    expandTime(15);
});

        function expandTime(minutes) {
            if (isRunning && isFocusMode) {
                timeLeft += minutes * 60;
                totalTime += minutes * 60;
                updateTimerDisplay();
                updateProgressBar();
                
                // Show a brief confirmation
                const originalText = document.querySelector('.expand-time-btn').innerHTML;
                document.querySelector('.expand-time-btn').innerHTML = `<i class="fas fa-check"></i> +${minutes}min`;
                
                setTimeout(() => {
                    document.querySelector('.expand-time-btn').innerHTML = originalText;
                }, 1500);
            }
        }

        // Initialize auto-save functionality
        function initAutoSave() {
            // Set up auto-save for work notes
            if (workNotesInput) {
                workNotesInput.addEventListener('input', function() {
                    clearTimeout(workNotesSaveTimeout);
                    showSaveIndicator(workNotesSaveIndicator, 'saving');
                    
                    workNotesSaveTimeout = setTimeout(() => {
                        workNotes = workNotesInput.value;
                        saveData();
                        showSaveIndicator(workNotesSaveIndicator, 'saved');
                    }, 1000);
                });
                
                // Also save on blur
                workNotesInput.addEventListener('blur', function() {
                    clearTimeout(workNotesSaveTimeout);
                    workNotes = workNotesInput.value;
                    saveData();
                    showSaveIndicator(workNotesSaveIndicator, 'saved');
                });
            }
            
            // Set up auto-save for task notes
            if (taskNotesInput) {
                taskNotesInput.addEventListener('input', function() {
                    clearTimeout(taskNotesSaveTimeout);
                    showSaveIndicator(taskNotesSaveIndicator, 'saving');
                    
                    taskNotesSaveTimeout = setTimeout(() => {
                        saveData();
                        showSaveIndicator(taskNotesSaveIndicator, 'saved');
                    }, 1000);
                });
                
                // Also save on blur
                taskNotesInput.addEventListener('blur', function() {
                    clearTimeout(taskNotesSaveTimeout);
                    saveData();
                    showSaveIndicator(taskNotesSaveIndicator, 'saved');
                });
            }
            
            // Show initial state
            showSaveIndicator(taskNotesSaveIndicator, 'saved');
        }

        // Show save status indicator
        function showSaveIndicator(saveIndicator, status) {
            if (!saveIndicator) return;
            
            // Remove all status classes
            saveIndicator.classList.remove('saving', 'saved', 'error', 'visible');
            
            // Add the current status class and make visible
            saveIndicator.classList.add(status, 'visible');
            
            // Update text based on status
            const saveText = saveIndicator.querySelector('.save-text');
            if (saveText) {
                switch(status) {
                    case 'saving':
                        saveText.textContent = 'Saving...';
                        break;
                    case 'saved':
                        saveText.textContent = 'Auto-save enabled';
                        break;
                    case 'error':
                        saveText.textContent = 'Error saving';
                        break;
                }
            }
            
            // If saved, keep visible for a moment then fade out
            if (status === 'saved') {
                setTimeout(() => {
                    saveIndicator.classList.remove('visible');
                }, 2000);
            }
        }

        // Clear all notes and ideas
        function clearAllNotesIdeas() {
            if (confirm("Are you sure you want to clear ALL Work Notes and Ideas? This action cannot be undone.")) {
                workNotes = '';
                ideas = [];
                workNotesInput.value = '';
                updateIdeasList();
                saveData();
                showTemporaryMessage("All notes and ideas cleared!", "success");
            }
        }

        // Toggle Work Mode function
        function toggleWorkMode() {
            if (workModeOverlay.classList.contains('active')) {
                exitWorkMode();
            } else {
                enterWorkMode();
            }
        }

        // Timer functions
// In the startTimer function, replace the currentSession creation code:
function startTimer() {
    if (!isRunning) {
        isRunning = true;
        timer = setInterval(updateTimer, 1000);
        
        // Start ticking sound if enabled
        if (tickSoundToggle.checked) {
            startTickingSound();
        }
        
        // Start a new session if not already running
        if (!currentSession) {
            // Only include tasks from the current project in the session
            const currentProject = projectSelect.value || 'General';
            const projectTasks = tasks.filter(t => t.project === currentProject && !t.completed);
            
            currentSession = {
                id: Date.now(),
                startTime: new Date(),
                type: isFocusMode ? 'focus' : 'break',
                duration: 0,
                tasks: [...projectTasks], // Only tasks from current project
                project: currentProject,
                workNotes: workNotes,
                ideas: [...ideas] // Store a copy of current ideas
            };
        }
        
        updateButtons();
    }
}

        function pauseTimer() {
            if (isRunning) {
                clearInterval(timer);
                isRunning = false;
                
                // Stop ticking sound
                stopTickingSound();
                
                updateButtons();
            }
        }

// Also update the skipTimer function to ensure consistency:
function skipTimer() {
    // Save current session if it exists
    if (currentSession) {
        currentSession.duration = isFocusMode ? 
            (parseInt(focusTimeInput.value) * 60) - timeLeft : 
            (parseInt(breakTimeInput.value) * 60) - timeLeft;
        
        // Update session data before saving - only tasks from this session
        // Don't update with all current tasks, keep the original session tasks
        currentSession.workNotes = workNotes;
        currentSession.ideas = [...ideas];
        
        // Only save focus sessions to history
        if (isFocusMode) {
            sessions.push(currentSession);
            saveData();
            updateHistoryTable();
            updateStats();
        }
        
        currentSession = null;
    }
    
    // Switch mode and reset timer
    isFocusMode = !isFocusMode;
    resetTimer();
    updateButtons();
    
    // Show notification when switching to break
    if (!isFocusMode) {
        showTimeUpNotification("Time for a break!");
    }
}

        function resetTimer() {
            clearInterval(timer);
            isRunning = false;
            
            // Stop ticking sound
            stopTickingSound();
            
            isFocusMode = true;
            timeLeft = parseInt(focusTimeInput.value) * 60;
            totalTime = timeLeft;
            updateTimerDisplay();
            updateProgressBar();
            updateButtons();
            
            // Reset current session
            currentSession = null;
        }

// And update the updateTimer function where session is saved:
function updateTimer() {
    timeLeft--;
    
    if (timeLeft <= 0) {
        clearInterval(timer);
        isRunning = false;
        
        // Stop ticking sound
        stopTickingSound();
        
        // Save session
        if (currentSession) {
            currentSession.duration = isFocusMode ? 
                parseInt(focusTimeInput.value) * 60 : 
                parseInt(breakTimeInput.value) * 60;
            
            // Don't update tasks with current state, keep original session tasks
            currentSession.workNotes = workNotes;
            currentSession.ideas = [...ideas];
            
            // Only save focus sessions to history
            if (isFocusMode) {
                sessions.push(currentSession);
                saveData();
                updateHistoryTable();
                updateStats();
            }
            
            currentSession = null;
        }
        
        // Show notification and switch mode
        if (isFocusMode) {
            showTimeUpNotification("Focus session completed!");
            isFocusMode = false;
            timeLeft = parseInt(breakTimeInput.value) * 60;
        } else {
            showTimeUpNotification("Break time is over!");
            isFocusMode = true;
            timeLeft = parseInt(focusTimeInput.value) * 60;
        }
        
        totalTime = timeLeft;
        updateTimerDisplay();
        updateProgressBar();
        updateButtons();
        
        // Play sound if enabled
        if (soundToggle.checked) {
            playNotificationSound();
        }
    } else {
        updateTimerDisplay();
        updateProgressBar();
    }
}

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerDisplay.textContent = display;
            statusTimer.textContent = display;
            workHeaderTimer.textContent = display;
            
            // Add time-up animation when less than 10 seconds
            if (timeLeft < 10) {
                timerDisplay.classList.add('time-up');
            } else {
                timerDisplay.classList.remove('time-up');
            }
        }

        function updateProgressBar() {
            const progress = ((totalTime - timeLeft) / totalTime) * 100;
            progressBar.style.width = `${progress}%`;
            statusProgressBar.style.width = `${progress}%`;
        }

        function updateTimerSettings() {
            if (!isRunning) {
                if (isFocusMode) {
                    timeLeft = parseInt(focusTimeInput.value) * 60;
                } else {
                    timeLeft = parseInt(breakTimeInput.value) * 60;
                }
                totalTime = timeLeft;
                updateTimerDisplay();
                updateProgressBar();
            }
        }

        function updateButtons() {
            // Main timer buttons
            startBtn.disabled = isRunning;
            pauseBtn.disabled = !isRunning;
            
            // Status bar buttons
            statusStartBtn.disabled = isRunning;
            statusPauseBtn.disabled = !isRunning;
            
            // Work mode buttons
            workStartBtn.disabled = isRunning;
            workPauseBtn.disabled = !isRunning;
            
            // Update mode indicator
            const modeIndicator = document.querySelector('.mode-indicator');
            if (isFocusMode) {
                modeIndicator.textContent = 'Focus Time';
                modeIndicator.className = 'mode-indicator focus-mode';
                statusMode.textContent = 'Focus';
                workHeaderMode.textContent = 'Focus Time';
            } else {
                modeIndicator.textContent = 'Break Time';
                modeIndicator.className = 'mode-indicator break-mode';
                statusMode.textContent = 'Break';
                workHeaderMode.textContent = 'Break Time';
            }
        }

        // Ticking sound functions
        function startTickingSound() {
            // Don't start if ticking sound is disabled
            if (!tickSoundToggle.checked) return;
            
            // Create audio context
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            
            // Create oscillator for ticking sound
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Configure oscillator for clock-like ticking
            oscillator.type = 'sine';
            oscillator.frequency.value = 1000; // High pitch for ticking sound
            
            // Configure gain for short, sharp ticks
            gainNode.gain.value = 0;
            
            // Start oscillator
            oscillator.start();
            
            // Store for later cleanup
            tickSound = {
                oscillator: oscillator,
                gainNode: gainNode,
                audioContext: audioContext
            };
            
            // Create ticking pattern
            tickInterval = setInterval(() => {
                if (!isRunning || !tickSoundToggle.checked) {
                    stopTickingSound();
                    return;
                }
                
                // Create a sharp tick sound
                const now = audioContext.currentTime;
                gainNode.gain.cancelScheduledValues(now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
            }, 1000);
        }

        function stopTickingSound() {
            if (tickInterval) {
                clearInterval(tickInterval);
                tickInterval = null;
            }
            
            if (tickSound) {
                tickSound.oscillator.stop();
                tickSound.audioContext.close();
                tickSound = null;
            }
        }

        // Clear functions for work notes and ideas
        function clearWorkNotesFunc() {
            if (confirm("Are you sure you want to clear all work notes?")) {
                workNotes = '';
                workNotesInput.value = '';
                saveData();
                showTemporaryMessage("Work notes cleared!", "success");
            }
        }

        function clearIdeasFunc() {
            if (confirm("Are you sure you want to clear all ideas?")) {
                ideas = [];
                updateIdeasList();
                saveData();
                showTemporaryMessage("All ideas cleared!", "success");
            }
        }

        // Save and load functions
        function saveCurrentSession() {
            if (currentSession) {
                // Update session data
                currentSession.duration = isFocusMode ? 
                    (parseInt(focusTimeInput.value) * 60) - timeLeft : 
                    (parseInt(breakTimeInput.value) * 60) - timeLeft;
                
                currentSession.tasks = [...tasks];
                currentSession.workNotes = workNotes;
                currentSession.ideas = [...ideas];
                
                // Add to sessions
                sessions.push(currentSession);
                saveData();
                updateHistoryTable();
                updateStats();
                
                // Show confirmation
                showTemporaryMessage("Session saved to history!", "success");
                
                // Reset current session
                currentSession = null;
            } else {
                showTemporaryMessage("No active session to save", "warning");
            }
        }

        function saveAllData() {
            const data = {
                tasks,
                sessions,
                projects,
                workNotes,
                ideas,
                settings: {
                    focusTime: parseInt(focusTimeInput.value),
                    breakTime: parseInt(breakTimeInput.value),
                    soundEnabled: soundToggle.checked,
                    tickSoundEnabled: tickSoundToggle.checked
                }
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'flowfocus-data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showTemporaryMessage("All data saved to file!", "success");
        }

        function loadDataFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // Load data
                        tasks = data.tasks || [];
                        sessions = data.sessions || [];
                        projects = data.projects || ['General'];
                        workNotes = data.workNotes || '';
                        ideas = data.ideas || [];
                        
                        if (data.settings) {
                            focusTimeInput.value = data.settings.focusTime || 25;
                            breakTimeInput.value = data.settings.breakTime || 5;
                            soundToggle.checked = data.settings.soundEnabled !== false;
                            tickSoundToggle.checked = data.settings.tickSoundEnabled !== false;
                        }
                        
                        // Update timer with loaded settings
                        timeLeft = parseInt(focusTimeInput.value) * 60;
                        totalTime = timeLeft;
                        updateTimerDisplay();
                        updateProgressBar();
                        
                        // Update UI
                        updateTaskList();
                        updateHistoryTable();
                        updateStats();
                        updateContinueTasks();
                        updateProjectList();
                        updateProjectSelect();
                        
                        // Update work notes textarea
                        workNotesInput.value = workNotes;
                        
                        showTemporaryMessage("Data loaded successfully!", "success");
                    } catch (error) {
                        showTemporaryMessage("Error loading data file", "warning");
                        console.error("Error loading data:", error);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Task management functions
        function addTask() {
            const name = taskInput.value.trim();
            const notes = taskNotesInput.value.trim();
            const project = projectSelect.value;
            
            if (name) {
                const task = {
                    id: Date.now(),
                    name,
                    notes,
                    project,
                    completed: false,
                    focusTime: 0,
                    createdAt: new Date()
                };
                
                tasks.push(task);
                saveData();
                updateTaskList();
                updateContinueTasks();
                
                // Clear inputs
                taskInput.value = '';
                taskNotesInput.value = '';
            }
        }

        function toggleTaskCompletion(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData();
                updateTaskList();
                updateContinueTasks();
                updateStats();
            }
        }

        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            saveData();
            updateTaskList();
            updateContinueTasks();
            updateStats();
        }

        function addQuickNote(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                modalTaskName.textContent = task.name;
                modalNotesInput.value = task.notes;
                currentTaskId = taskId;
                quickNoteModal.classList.add('active');
            }
        }

        function closeQuickNoteModalFunc() {
            quickNoteModal.classList.remove('active');
            currentTaskId = null;
        }

        function saveQuickNoteFunc() {
            if (currentTaskId) {
                const task = tasks.find(t => t.id === currentTaskId);
                if (task) {
                    task.notes = modalNotesInput.value;
                    saveData();
                    updateTaskList();
                    closeQuickNoteModalFunc();
                }
            }
        }

        function updateTaskList() {
            taskList.innerHTML = '';
            
            if (tasks.length === 0) {
                taskList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <p>No tasks yet. Add a task to get started!</p>
                    </div>
                `;
                return;
            }
            
            // Sort tasks: incomplete first, then by creation date
            const sortedTasks = [...tasks].sort((a, b) => {
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                return b.createdAt - a.createdAt;
            });
            
            sortedTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.completed ? 'task-completed' : ''}`;
                
                // Format notes with bullet points
                let notesHtml = '';
                if (task.notes) {
                    const notesLines = task.notes.split('\n').filter(line => line.trim());
                    notesHtml = notesLines.map(line => {
                        // Convert bullet points
                        const trimmedLine = line.trim();
                        if (trimmedLine.startsWith('-') || trimmedLine.startsWith('*')) {
                            return `<div class="task-note-line">${trimmedLine.substring(1).trim()}</div>`;
                        }
                        return `<div class="task-note-line">${trimmedLine}</div>`;
                    }).join('');
                }
                
                taskItem.innerHTML = `
                    <div class="task-header">
                        <div class="task-content">
                            <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                            <div class="task-details">
                                <div class="task-name">${task.name}</div>
                                <div class="task-project">Project: ${task.project}</div>
                                ${notesHtml ? `<div class="task-notes">${notesHtml}</div>` : ''}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="focus-on-btn" data-task-id="${task.id}">
                                <i class="fas fa-bullseye"></i> Focus On
                            </button>
                            <button class="quick-note-btn" data-task-id="${task.id}">
                                <i class="fas fa-sticky-note"></i> Notes
                            </button>
                            <button class="icon-btn delete-task" data-task-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                taskList.appendChild(taskItem);
            });
            
            // Add event listeners to task buttons
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const taskId = parseInt(e.target.closest('.task-item').querySelector('.focus-on-btn').getAttribute('data-task-id'));
                    toggleTaskCompletion(taskId);
                });
            });
            
            document.querySelectorAll('.quick-note-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = parseInt(e.target.closest('.quick-note-btn').getAttribute('data-task-id'));
                    addQuickNote(taskId);
                });
            });
            
            document.querySelectorAll('.focus-on-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = parseInt(e.target.closest('.focus-on-btn').getAttribute('data-task-id'));
                    setFocusTask(taskId);
                });
            });
            
            document.querySelectorAll('.delete-task').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = parseInt(e.target.closest('.delete-task').getAttribute('data-task-id'));
                    deleteTask(taskId);
                });
            });
            
            // Update work mode task list if in work mode
            if (workModeOverlay.classList.contains('active')) {
                updateWorkTaskList();
            }
        }

        function setFocusTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                currentTaskId = taskId;
                
                // If we're in work mode, update the display
                if (workModeOverlay.classList.contains('active')) {
                    updateWorkModeDisplay();
                }
                
                // Show a confirmation
                showTemporaryMessage(`Now focusing on: ${task.name}`, 'success');
            }
        }

        // Project management functions
        function addProject() {
            const name = addProjectInput.value.trim();
            if (name && !projects.includes(name)) {
                projects.push(name);
                saveData();
                updateProjectList();
                updateProjectSelect();
                addProjectInput.value = '';
                showTemporaryMessage(`Project "${name}" added!`, 'success');
            } else if (projects.includes(name)) {
                showTemporaryMessage('Project already exists!', 'warning');
            }
        }

        function editProject(projectName) {
            currentProjectEditId = projectName;
            editProjectName.value = projectName;
            projectEditModal.classList.add('active');
        }

        function deleteProject(projectName) {
            if (confirm(`Are you sure you want to delete project "${projectName}"? This will also remove all tasks in this project.`)) {
                // Remove project from projects array
                projects = projects.filter(p => p !== projectName);
                
                // Remove tasks associated with this project
                tasks = tasks.filter(t => t.project !== projectName);
                
                // Update sessions to change project to "General"
                sessions.forEach(session => {
                    if (session.project === projectName) {
                        session.project = 'General';
                    }
                });
                
                saveData();
                updateProjectList();
                updateProjectSelect();
                updateTaskList();
                updateHistoryTable();
                showTemporaryMessage(`Project "${projectName}" deleted!`, 'success');
            }
        }

        function updateProjectList() {
            projectList.innerHTML = '';
            
            if (projects.length === 0) {
                projectList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder"></i>
                        <p>No projects yet. Add your first project!</p>
                    </div>
                `;
                return;
            }
            
            projects.forEach(project => {
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                
                projectItem.innerHTML = `
                    <div class="project-name">${project}</div>
                    <div class="project-actions">
                        <button class="icon-btn edit-project" data-project="${project}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="icon-btn delete-project" data-project="${project}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                projectList.appendChild(projectItem);
            });
            
            // Add event listeners to project buttons
            document.querySelectorAll('.edit-project').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const projectName = e.target.closest('.edit-project').getAttribute('data-project');
                    editProject(projectName);
                });
            });
            
            document.querySelectorAll('.delete-project').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const projectName = e.target.closest('.delete-project').getAttribute('data-project');
                    deleteProject(projectName);
                });
            });
        }

        function updateProjectSelect() {
            // Clear and repopulate project select
            projectSelect.innerHTML = '';
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project;
                option.textContent = project;
                projectSelect.appendChild(option);
            });
            
            // Also update history project filter
            historyProjectFilter.innerHTML = '<option value="all">All Projects</option>';
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project;
                option.textContent = project;
                historyProjectFilter.appendChild(option);
            });
        }

        function closeProjectEditModalFunc() {
            projectEditModal.classList.remove('active');
            currentProjectEditId = null;
        }

        function saveProjectEditFunc() {
            if (currentProjectEditId) {
                const newName = editProjectName.value.trim();
                if (newName && !projects.includes(newName)) {
                    // Update project name in projects array
                    const index = projects.indexOf(currentProjectEditId);
                    if (index !== -1) {
                        projects[index] = newName;
                    }
                    
                    // Update tasks with the new project name
                    tasks.forEach(task => {
                        if (task.project === currentProjectEditId) {
                            task.project = newName;
                        }
                    });
                    
                    // Update sessions with the new project name
                    sessions.forEach(session => {
                        if (session.project === currentProjectEditId) {
                            session.project = newName;
                        }
                    });
                    
                    saveData();
                    updateProjectList();
                    updateProjectSelect();
                    updateTaskList();
                    updateHistoryTable();
                    closeProjectEditModalFunc();
                    showTemporaryMessage(`Project renamed to "${newName}"!`, 'success');
                } else if (projects.includes(newName)) {
                    showTemporaryMessage('Project name already exists!', 'warning');
                }
            }
        }

        // History and stats functions
// Update the updateHistoryTable function to call the editable functions
function updateHistoryTable() {
    historyTable.innerHTML = '';
    workHistoryTable.innerHTML = '';
    
    const projectFilter = historyProjectFilter.value;
    const filteredSessions = projectFilter === 'all' 
        ? sessions 
        : sessions.filter(s => s.project === projectFilter);
    
    if (filteredSessions.length === 0) {
        historyTable.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <i class="fas fa-history"></i>
                    <p>No session history yet. Complete a focus session to see it here!</p>
                </td>
            </tr>
        `;
        
        workHistoryTable.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <i class="fas fa-history"></i>
                    <p>No session history yet. Complete a focus session to see it here!</p>
                </td>
            </tr>
        `;
        return;
    }
    
    // Sort sessions by date (newest first)
    const sortedSessions = [...filteredSessions].sort((a, b) => 
        new Date(b.startTime) - new Date(a.startTime)
    );
    
    sortedSessions.forEach(session => {
        const date = new Date(session.startTime);
        const dateStr = date.toLocaleDateString();
        const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        // Format session details
        const focusTime = Math.floor(session.duration / 60);
        const breakTime = Math.floor((session.duration * 0.2) / 60); // Estimate break time
        const completedTasks = session.tasks ? session.tasks.filter(t => t.completed).length : 0;
        const totalTasks = session.tasks ? session.tasks.length : 0;
        
        // Format tasks for session details
        let tasksHtml = '';
        if (session.tasks && session.tasks.length > 0) {
            session.tasks.forEach(task => {
                tasksHtml += `
                    <div class="session-task-item">
                        <div class="session-task-content">
                            <div class="session-task-details">
                                <div class="${task.completed ? 'session-task-completed' : ''}">
                                    ${task.name}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Format task notes
        let taskNotesHtml = '';
        if (session.tasks && session.tasks.length > 0) {
            session.tasks.forEach(task => {
                if (task.notes && task.notes.trim() !== '') {
                    taskNotesHtml += `
                        <div style="margin-bottom: 10px;">
                            <div><strong>${task.name}:</strong></div>
                            ${task.notes.split('\n').map(note => 
                                note.trim() !== '' ? `<div class="task-note-bullet">${note}</div>` : ''
                            ).join('')}
                        </div>
                    `;
                }
            });
        }
        
        // Format work notes
        const workNotes = session.workNotes || '';
        const workNotesHtml = workNotes.split('\n').map(line => 
            line.trim() !== '' ? `<div>${line}</div>` : ''
        ).join('');
        
        // Format ideas
        const ideas = session.ideas || [];
        const ideasHtml = ideas.map(idea => 
            `<div class="idea-item">
                <div class="idea-content">${idea.content}</div>
            </div>`
        ).join('');
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <div>${dateStr}</div>
                <div style="font-size: 0.8rem; color: var(--gray);">${timeStr}</div>
            </td>
            <td>${session.project}</td>
            <td class="session-details-cell">
                <div><strong>Focus:</strong> ${focusTime} min</div>
                <div><strong>Break:</strong> ${breakTime} min</div>
                <div><strong>Tasks:</strong> ${completedTasks}/${totalTasks} completed</div>
                ${tasksHtml ? `<div style="margin-top: 8px;"><strong>Task Details:</strong>${tasksHtml}</div>` : ''}
            </td>
            <td class="task-notes-cell">
                ${taskNotesHtml || '<div style="color: var(--gray); font-style: italic;">No task notes</div>'}
            </td>
            <td class="work-notes-cell">
                ${workNotesHtml || '<div style="color: var(--gray); font-style: italic;">No work notes</div>'}
            </td>
            <td class="ideas-cell">
                ${ideasHtml || '<div style="color: var(--gray); font-style: italic;">No ideas</div>'}
            </td>
            <td>
                <button class="icon-btn delete-session" data-session-id="${session.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        
        historyTable.appendChild(row);
        
        // Also add to work history table
        const workRow = row.cloneNode(true);
        workHistoryTable.appendChild(workRow);
    });
    
    // Add event listeners to delete buttons
    document.querySelectorAll('.delete-session').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const sessionId = parseInt(e.target.closest('.delete-session').getAttribute('data-session-id'));
            deleteSession(sessionId);
        });
    });
    
    // Make fields editable
    makeHistoryFieldsEditable();
    makeWorkHistoryFieldsEditable();
}

// Add some CSS for better editing experience
const style = document.createElement('style');
style.textContent = `
    [contenteditable="true"]:focus {
        outline: 2px solid var(--primary);
        background-color: rgba(67, 97, 238, 0.05);
        border-radius: 4px;
        padding: 4px;
    }
    
    .work-notes-cell[contenteditable="true"]:empty:before,
    .ideas-cell[contenteditable="true"]:empty:before,
    .task-notes-cell[contenteditable="true"]:empty:before {
        content: "Click to edit...";
        color: var(--gray);
        font-style: italic;
    }
`;
document.head.appendChild(style);

        function deleteSession(sessionId) {
            sessions = sessions.filter(s => s.id !== sessionId);
            saveData();
            updateHistoryTable();
            updateStats();
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all session history? This action cannot be undone.')) {
                sessions = [];
                saveData();
                updateHistoryTable();
                updateStats();
            }
        }

        function updateStats() {
            // Total sessions
            totalSessionsEl.textContent = sessions.length;
            
            // Total focus time
            const totalFocusMinutes = sessions.reduce((total, session) => 
                total + Math.floor(session.duration / 60), 0
            );
            const hours = Math.floor(totalFocusMinutes / 60);
            const minutes = totalFocusMinutes % 60;
            totalFocusTimeEl.textContent = `${hours}h ${minutes}m`;
            
            // Tasks completed
            const completedTasks = tasks.filter(t => t.completed).length;
            tasksCompletedEl.textContent = completedTasks;
            
            // Productivity score (simplified)
            const totalTasks = tasks.length;
            const productivity = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            productivityScoreEl.textContent = `${productivity}%`;
        }

        function generateReport() {
            // Update report stats
            reportTotalSessions.textContent = sessions.length;
            
            const totalFocusMinutes = sessions.reduce((total, session) => 
                total + Math.floor(session.duration / 60), 0
            );
            const hours = Math.floor(totalFocusMinutes / 60);
            const minutes = totalFocusMinutes % 60;
            reportTotalFocusTime.textContent = `${hours}h ${minutes}m`;
            
            const completedTasks = tasks.filter(t => t.completed).length;
            reportTasksCompleted.textContent = completedTasks;
            
            const totalTasks = tasks.length;
            const productivity = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            reportProductivityScore.textContent = `${productivity}%`;
            
            // Generate project breakdown
            projectReports.innerHTML = '';
            const projectStats = {};
            
            sessions.forEach(session => {
                if (!projectStats[session.project]) {
                    projectStats[session.project] = {
                        sessions: 0,
                        focusTime: 0,
                        tasks: 0,
                        completedTasks: 0
                    };
                }
                
                projectStats[session.project].sessions++;
                projectStats[session.project].focusTime += Math.floor(session.duration / 60);
                
                if (session.tasks) {
                    projectStats[session.project].tasks += session.tasks.length;
                    projectStats[session.project].completedTasks += session.tasks.filter(t => t.completed).length;
                }
            });
            
            Object.keys(projectStats).forEach(project => {
                const projectData = projectStats[project];
                const projectEl = document.createElement('div');
                projectEl.className = 'project-report';
                
                projectEl.innerHTML = `
                    <div class="project-header">
                        <div class="project-name">${project}</div>
                        <div class="project-stats">
                            <div class="project-stat">
                                <div class="project-stat-value">${projectData.sessions}</div>
                                <div class="project-stat-label">Sessions</div>
                            </div>
                            <div class="project-stat">
                                <div class="project-stat-value">${projectData.focusTime}m</div>
                                <div class="project-stat-label">Focus Time</div>
                            </div>
                            <div class="project-stat">
                                <div class="project-stat-value">${projectData.completedTasks}/${projectData.tasks}</div>
                                <div class="project-stat-label">Tasks Done</div>
                            </div>
                        </div>
                    </div>
                `;
                
                projectReports.appendChild(projectEl);
            });
            
            // Generate task completion report
            taskReports.innerHTML = '';
            const incompleteTasks = tasks.filter(t => !t.completed);
            const completedTasksList = tasks.filter(t => t.completed);
            
            if (incompleteTasks.length > 0) {
                const incompleteSection = document.createElement('div');
                incompleteSection.innerHTML = `<h4>Incomplete Tasks (${incompleteTasks.length})</h4>`;
                
                incompleteTasks.forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'task-report-item';
                    
                    taskEl.innerHTML = `
                        <div class="task-report-header">
                            <div class="task-report-name">${task.name}</div>
                            <div class="task-report-status incomplete">Incomplete</div>
                        </div>
                        <div class="task-report-project">Project: ${task.project}</div>
                        ${task.notes ? `
                            <div class="task-report-notes">
                                ${task.notes.split('\n').map(note => 
                                    `<div class="note-highlight">${note}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                    `;
                    
                    incompleteSection.appendChild(taskEl);
                });
                
                taskReports.appendChild(incompleteSection);
            }
            
            if (completedTasksList.length > 0) {
                const completedSection = document.createElement('div');
                completedSection.innerHTML = `<h4>Completed Tasks (${completedTasksList.length})</h4>`;
                
                completedTasksList.forEach(task => {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'task-report-item';
                    
                    taskEl.innerHTML = `
                        <div class="task-report-header">
                            <div class="task-report-name">${task.name}</div>
                            <div class="task-report-status">Completed</div>
                        </div>
                        <div class="task-report-project">Project: ${task.project}</div>
                        ${task.notes ? `
                            <div class="task-report-notes">
                                ${task.notes.split('\n').map(note => 
                                    `<div>${note}</div>`
                                ).join('')}
                            </div>
                        ` : ''}
                    `;
                    
                    completedSection.appendChild(taskEl);
                });
                
                taskReports.appendChild(completedSection);
            }
            
            // Show the report modal
            reportModal.classList.add('active');
        }

        function closeReportModalFunc() {
            reportModal.classList.remove('active');
        }

        function exportReportAsPDF() {
            // In a real app, this would generate a PDF
            alert('In a full implementation, this would generate and download a PDF report.');
        }

        // Status bar functions
        function toggleStatusBar() {
            statusBar.classList.toggle('hidden');
            const icon = statusToggle.querySelector('i');
            if (statusBar.classList.contains('hidden')) {
                icon.className = 'fas fa-chevron-down';
            } else {
                icon.className = 'fas fa-chevron-up';
            }
        }

        // Notification functions
        function showTimeUpNotification(message) {
            timeUpNotification.textContent = message;
            timeUpNotification.classList.remove('hidden');
            
            setTimeout(() => {
                timeUpNotification.classList.add('hidden');
            }, 3000);
        }

        function showTemporaryMessage(message, type = 'info') {
            // Create a temporary message element
            const messageEl = document.createElement('div');
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'var(--success)' : 'var(--primary)'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: var(--shadow);
                z-index: 1005;
                font-weight: 500;
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                document.body.removeChild(messageEl);
            }, 3000);
        }

        function playNotificationSound() {
            // Create audio context for sound notification
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            } catch (e) {
                console.log("Audio context not supported");
            }
        }

        // Work mode functions
        function enterWorkMode() {
            workModeOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            floatingWorkModeBtn.classList.add('in-work-mode');
            floatingWorkModeBtn.innerHTML = '<i class="fas fa-times"></i>';
            floatingBackMainBtn.classList.add('active');
            updateWorkModeDisplay();
        }

        function exitWorkMode() {
            workModeOverlay.classList.remove('active');
            document.body.style.overflow = 'auto';
            floatingWorkModeBtn.classList.remove('in-work-mode');
            floatingWorkModeBtn.innerHTML = '<i class="fas fa-briefcase"></i>';
            floatingBackMainBtn.classList.remove('active');
        }

        function updateWorkModeDisplay() {
            // Update current task
            if (currentTaskId) {
                const task = tasks.find(t => t.id === currentTaskId);
                if (task) {
                    workCurrentTaskName.textContent = task.name;
                } else {
                    workCurrentTaskName.textContent = 'No task selected';
                }
            } else {
                workCurrentTaskName.textContent = 'No task selected';
            }
            
            // Update task stats
            const completedTasks = tasks.filter(t => t.completed).length;
            workTaskCompleted.textContent = completedTasks;
            workTaskTotal.textContent = tasks.length;
            
            // Calculate focus time for current task
            if (currentTaskId) {
                const task = tasks.find(t => t.id === currentTaskId);
                if (task) {
                    workTaskFocusTime.textContent = `${task.focusTime} min`;
                } else {
                    workTaskFocusTime.textContent = '0 min';
                }
            } else {
                workTaskFocusTime.textContent = '0 min';
            }
            
            // Update task list
            updateWorkTaskList();
            
            // Update history table
            updateHistoryTable();
            
            // Update work notes and ideas
            workNotesInput.value = workNotes;
            updateIdeasList();
        }

        function updateWorkTaskList() {
            workTaskList.innerHTML = '';
            
            if (tasks.length === 0) {
                workTaskList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <p>No tasks yet. Add a task to get started!</p>
                    </div>
                `;
                return;
            }
            
            // Show only incomplete tasks in work mode
            const incompleteTasks = tasks.filter(t => !t.completed);
            
            if (incompleteTasks.length === 0) {
                workTaskList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>All tasks completed! Great job!</p>
                    </div>
                `;
                return;
            }
            
            incompleteTasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.id === currentTaskId ? 'active-task' : ''}`;
                
                // Format notes with bullet points
                let notesHtml = '';
                if (task.notes) {
                    const notesLines = task.notes.split('\n').filter(line => line.trim());
                    notesHtml = notesLines.map(line => {
                        // Convert bullet points
                        const trimmedLine = line.trim();
                        if (trimmedLine.startsWith('-') || trimmedLine.startsWith('*')) {
                            return `<div class="task-note-line">${trimmedLine.substring(1).trim()}</div>`;
                        }
                        return `<div class="task-note-line">${trimmedLine}</div>`;
                    }).join('');
                }
                
                taskItem.innerHTML = `
                    <div class="task-header">
                        <div class="task-content">
                            <input type="checkbox" class="task-checkbox">
                            <div class="task-details">
                                <div class="task-name">${task.name}</div>
                                <div class="task-project">Project: ${task.project}</div>
                                ${notesHtml ? `<div class="task-notes">${notesHtml}</div>` : ''}
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="focus-on-btn" data-task-id="${task.id}">
                                <i class="fas fa-bullseye"></i> Focus
                            </button>
                            <button class="quick-note-btn" data-task-id="${task.id}">
                                <i class="fas fa-sticky-note"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                workTaskList.appendChild(taskItem);
            });
            
            // Add event listeners to task buttons
            document.querySelectorAll('#work-task-list .task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const taskId = parseInt(e.target.closest('.task-item').querySelector('.focus-on-btn').getAttribute('data-task-id'));
                    toggleTaskCompletion(taskId);
                    updateWorkModeDisplay();
                });
            });
            
            document.querySelectorAll('#work-task-list .quick-note-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = parseInt(e.target.closest('.quick-note-btn').getAttribute('data-task-id'));
                    addQuickNote(taskId);
                });
            });
            
            document.querySelectorAll('#work-task-list .focus-on-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = parseInt(e.target.closest('.focus-on-btn').getAttribute('data-task-id'));
                    setFocusTask(taskId);
                    updateWorkModeDisplay();
                });
            });
        }

        function switchWorkTab(tabId) {
            // Update tabs
            workTabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Update tab content
            workTabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId) {
                    content.classList.add('active');
                }
            });
        }

        function saveWorkNotesFunc() {
            workNotes = workNotesInput.value;
            saveData();
            showTemporaryMessage('Work notes saved!', 'success');
        }

        function addIdeaFunc() {
            const idea = ideaInput.value.trim();
            if (idea) {
                ideas.push({
                    id: Date.now(),
                    content: idea,
                    createdAt: new Date()
                });
                ideaInput.value = '';
                updateIdeasList();
                saveData();
                showTemporaryMessage('Idea added!', 'success');
            }
        }

        function updateIdeasList() {
            ideasList.innerHTML = '';
            
            if (ideas.length === 0) {
                ideasList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-lightbulb"></i>
                        <p>No ideas yet. Add your first idea!</p>
                    </div>
                `;
                return;
            }
            
            // Sort ideas by date (newest first)
            const sortedIdeas = [...ideas].sort((a, b) => 
                new Date(b.createdAt) - new Date(a.createdAt)
            );
            
            sortedIdeas.forEach(idea => {
                const ideaEl = document.createElement('div');
                ideaEl.className = 'idea-item';
                
                ideaEl.innerHTML = `
                    <div class="idea-header">
                        <div class="idea-content">${idea.content}</div>
                        <div class="idea-actions">
                            <button class="icon-btn delete-idea" data-idea-id="${idea.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                ideasList.appendChild(ideaEl);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-idea').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const ideaId = parseInt(e.target.closest('.delete-idea').getAttribute('data-idea-id'));
                    deleteIdea(ideaId);
                });
            });
        }

        function deleteIdea(ideaId) {
            ideas = ideas.filter(i => i.id !== ideaId);
            updateIdeasList();
            saveData();
        }

        function updateContinueTasks() {
            continueTasksList.innerHTML = '';
            
            // Get incomplete tasks
            const incompleteTasks = tasks.filter(t => !t.completed);
            
            if (incompleteTasks.length === 0) {
                continueTasksList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>All tasks completed!</p>
                    </div>
                `;
                return;
            }
            
            // Show only the first 3 tasks
            const tasksToShow = incompleteTasks.slice(0, 3);
            
            tasksToShow.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'continue-task-item';
                
                taskEl.innerHTML = `
                    <div class="continue-task-info">
                        <div class="continue-task-name">${task.name}</div>
                        <div class="continue-task-project">${task.project}</div>
                    </div>
                    <div class="continue-task-actions">
                        <button class="focus-on-btn" data-task-id="${task.id}">
                            <i class="fas fa-bullseye"></i> Focus
                        </button>
                    </div>
                `;
                
                continueTasksList.appendChild(taskEl);
            });
            
            // Add event listeners to focus buttons
            document.querySelectorAll('#continue-tasks-list .focus-on-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = parseInt(e.target.closest('.focus-on-btn').getAttribute('data-task-id'));
                    setFocusTask(taskId);
                });
            });
        }

        // Data persistence functions
        function saveData() {
            const data = {
                tasks,
                sessions,
                projects,
                workNotes,
                ideas,
                settings: {
                    focusTime: parseInt(focusTimeInput.value),
                    breakTime: parseInt(breakTimeInput.value),
                    soundEnabled: soundToggle.checked,
                    tickSoundEnabled: tickSoundToggle.checked
                }
            };
            localStorage.setItem('flowfocus-data', JSON.stringify(data));
        }

        function loadData() {
            const data = JSON.parse(localStorage.getItem('flowfocus-data'));
            
            if (data) {
                tasks = data.tasks || [];
                sessions = data.sessions || [];
                projects = data.projects || ['General']; // Default to just "General"
                workNotes = data.workNotes || '';
                ideas = data.ideas || [];
                
                if (data.settings) {
                    focusTimeInput.value = data.settings.focusTime || 25;
                    breakTimeInput.value = data.settings.breakTime || 5;
                    soundToggle.checked = data.settings.soundEnabled !== false;
                    tickSoundToggle.checked = data.settings.tickSoundEnabled !== false;
                }
                
                // Update timer with loaded settings
                timeLeft = parseInt(focusTimeInput.value) * 60;
                totalTime = timeLeft;
                updateTimerDisplay();
                updateProgressBar();
                
                // Update work notes textarea
                workNotesInput.value = workNotes;
            }
        }

// Add this function to enable editing for history records
function makeHistoryFieldsEditable() {
    // Make project field editable
    document.querySelectorAll('#history-table td:nth-child(2)').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'project', this.textContent);
        });
    });

    // Make work notes field editable
    document.querySelectorAll('.work-notes-cell').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.style.minHeight = '50px';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'workNotes', this.innerHTML);
        });
    });

    // Make ideas field editable
    document.querySelectorAll('.ideas-cell').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.style.minHeight = '50px';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'ideas', this.innerHTML);
        });
    });

    // Make task notes field editable
    document.querySelectorAll('.task-notes-cell').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.style.minHeight = '50px';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'taskNotes', this.innerHTML);
        });
    });
}

// Add function to update session field
function updateSessionField(sessionId, field, value) {
    const session = sessions.find(s => s.id === sessionId);
    if (session) {
        if (field === 'project') {
            session.project = value;
        } else if (field === 'workNotes') {
            session.workNotes = value;
        } else if (field === 'ideas') {
            // Parse ideas from HTML content
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = value;
            const ideaElements = tempDiv.querySelectorAll('.idea-item');
            session.ideas = Array.from(ideaElements).map(ideaEl => {
                return {
                    id: Date.now() + Math.random(),
                    content: ideaEl.querySelector('.idea-content').textContent,
                    createdAt: new Date()
                };
            });
        } else if (field === 'taskNotes') {
            // Update task notes in session tasks
            if (session.tasks) {
                // This is a simplified implementation - you might want to make it more robust
                session.tasks.forEach(task => {
                    if (task.notes) {
                        // Update task notes logic here
                    }
                });
            }
        }
        
        saveData();
        showTemporaryMessage('Session updated!', 'success');
    }
}

// Also make work history table editable (for work mode)
function makeWorkHistoryFieldsEditable() {
    // Make project field editable
    document.querySelectorAll('#work-history-table td:nth-child(2)').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'project', this.textContent);
        });
    });

    // Make work notes field editable
    document.querySelectorAll('#work-history-table .work-notes-cell').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.style.minHeight = '50px';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'workNotes', this.innerHTML);
        });
    });

    // Make ideas field editable
    document.querySelectorAll('#work-history-table .ideas-cell').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.style.minHeight = '50px';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'ideas', this.innerHTML);
        });
    });

    // Make task notes field editable
    document.querySelectorAll('#work-history-table .task-notes-cell').forEach(cell => {
        cell.setAttribute('contenteditable', 'true');
        cell.style.cursor = 'text';
        cell.style.minHeight = '50px';
        cell.addEventListener('blur', function() {
            const sessionId = parseInt(this.closest('tr').querySelector('.delete-session').getAttribute('data-session-id'));
            updateSessionField(sessionId, 'taskNotes', this.innerHTML);
        });
    });
}



        // Initialize the app
        init();
    </script>
</body>
</html>