<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biomedical Grant Proposal Assistant</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --biomed: #9b59b6;
            --rationale: #1abc9c;
            --gap: #e67e22;
            --hypothesis: #3498db;
            --aims: #9b59b6;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding-bottom: 60px; /* Space for footer */
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--biomed) 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .biomed-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--biomed);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .logic-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .logic-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex: 1;
            min-width: 100px;
            position: relative;
        }
        
        .logic-step:not(:last-child)::after {
            content: 'â†’';
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: var(--biomed);
        }
        
        .step-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
            font-size: 0.9rem;
        }
        
        .literature-icon { background-color: var(--rationale); }
        .data-icon { background-color: #3498db; }
        .gap-icon { background-color: var(--gap); }
        .hypothesis-icon { background-color: var(--hypothesis); }
        .aims-icon { background-color: var(--aims); }
        
        .progress-container {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            position: relative;
            max-width: 100%;
            overflow: hidden;
        }
        
        .progress-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 4px;
            width: 100%;
            background-color: #ddd;
            z-index: 1;
        }
        
        .progress-bar {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            height: 4px;
            width: 0%;
            background-color: var(--biomed);
            z-index: 2;
            transition: width 0.3s ease;
        }
        
        .step {
            width: 36px;
            height: 36px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #ddd;
            z-index: 3;
            transition: all 0.3s ease;
            font-weight: bold;
            cursor: pointer;
        }
        
        .step.active {
            border-color: var(--biomed);
            background-color: var(--biomed);
            color: white;
        }
        
        .step.completed {
            border-color: var(--success);
            background-color: var(--success);
            color: white;
        }
        
        .step-label {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.75rem;
            text-align: center;
            width: 80px;
            cursor: pointer;
        }
        
        .step-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 0;
        }
        
        .content-section {
            background-color: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            font-size: 1.8rem;
        }
        
        .rationale-section {
            border-left: 4px solid var(--rationale);
            padding-left: 15px;
            margin: 20px 0;
        }
        
        .rationale-section h3 {
            color: var(--rationale);
        }
        
        .gap-section {
            border-left: 4px solid var(--gap);
            padding-left: 15px;
            margin: 20px 0;
        }
        
        .gap-section h3 {
            color: var(--gap);
        }
        
        .hypothesis-section {
            border-left: 4px solid var(--hypothesis);
            padding-left: 15px;
            margin: 20px 0;
        }
        
        .hypothesis-section h3 {
            color: var(--hypothesis);
        }
        
        .aims-section {
            border-left: 4px solid var(--aims);
            padding-left: 15px;
            margin: 20px 0;
        }
        
        .aims-section h3 {
            color: var(--aims);
        }
        
        .biomed-section {
            border-left: 4px solid var(--biomed);
            padding-left: 15px;
            margin: 20px 0;
        }
        
        .biomed-section h3 {
            color: var(--biomed);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 24px;
            background-color: var(--biomed);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #8e44ad;
        }
        
        .btn-rationale {
            background-color: var(--rationale);
        }
        
        .btn-rationale:hover {
            background-color: #16a085;
        }
        
        .btn-gap {
            background-color: var(--gap);
        }
        
        .btn-gap:hover {
            background-color: #d35400;
        }
        
        .btn-hypothesis {
            background-color: var(--hypothesis);
        }
        
        .btn-hypothesis:hover {
            background-color: #2980b9;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--biomed);
            color: var(--biomed);
        }
        
        .btn-outline:hover {
            background-color: rgba(155, 89, 182, 0.1);
        }
        
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .file-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .idea-card {
            background-color: var(--light);
            border-left: 4px solid var(--biomed);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .rationale-card {
            background-color: #e8f8f5;
            border-left: 4px solid var(--rationale);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .gap-card {
            background-color: #fef9e7;
            border-left: 4px solid var(--gap);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .hypothesis-card {
            background-color: #ebf5fb;
            border-left: 4px solid var(--hypothesis);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .idea-card h3, .rationale-card h3, .gap-card h3, .hypothesis-card h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .brainstorming-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .brainstorming-area {
                grid-template-columns: 1fr;
            }
            
            .step-label {
                font-size: 0.7rem;
                width: 70px;
            }
            
            .logic-flow {
                flex-direction: column;
                gap: 20px;
            }
            
            .logic-step:not(:last-child)::after {
                display: none;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .content-section {
                padding: 20px;
            }
            
            .file-controls {
                flex-direction: column;
            }
        }
        
        .brainstorm-section {
            margin-bottom: 20px;
        }
        
        .prompt-box {
            background-color: #f8f9fa;
            border: 1px dashed #ccc;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .rationale-prompt {
            background-color: #e8f6f3;
            border: 1px dashed var(--rationale);
        }
        
        .gap-prompt {
            background-color: #fdebd0;
            border: 1px dashed var(--gap);
        }
        
        .hypothesis-prompt {
            background-color: #d6eaf8;
            border: 1px dashed var(--hypothesis);
        }
        
        .idea-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .proposal-section {
            margin-bottom: 30px;
        }
        
        .proposal-section h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .proposal-content {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            min-height: 150px;
            border: 1px solid #e9ecef;
        }
        
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .hidden {
            display: none;
        }
        
        .success-message {
            background-color: var(--success);
            color: white;
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            margin-top: 20px;
        }
        
        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .methodology-item {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .methodology-item:hover {
            background-color: #e9ecef;
        }
        
        .methodology-item.selected {
            background-color: var(--biomed);
            color: white;
            border-color: var(--biomed);
        }
        
        .biomed-resources {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .resource-card {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
        }
        
        .resource-card h4 {
            margin-bottom: 10px;
            color: var(--biomed);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .model-system-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .model-system {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .model-system:hover {
            background-color: #e9ecef;
        }
        
        .model-system.selected {
            background-color: var(--biomed);
            color: white;
            border-color: var(--biomed);
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--biomed);
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .collaboration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .collaboration-item {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
        }
        
        .literature-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }
        
        .literature-table th, .literature-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .literature-table th {
            background-color: var(--rationale);
            color: white;
        }
        
        .literature-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .preliminary-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .preliminary-results {
                grid-template-columns: 1fr;
            }
        }
        
        .result-card {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
        }
        
        .rationale-summary {
            background-color: #e8f8f5;
            border: 1px solid var(--rationale);
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .gap-summary {
            background-color: #fef9e7;
            border: 1px solid var(--gap);
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .hypothesis-summary {
            background-color: #ebf5fb;
            border: 1px solid var(--hypothesis);
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .aim-summary {
            background-color: #f4ecf7;
            border: 1px solid var(--aims);
            padding: 20px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .logic-connector {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--biomed);
        }
        
        .connector-text {
            flex: 1;
            font-style: italic;
        }
        
        .connector-arrow {
            font-size: 1.5rem;
            color: var(--biomed);
            margin: 0 15px;
        }
        
        .aim-box {
            background-color: #f4ecf7;
            border: 1px solid var(--aims);
            padding: 20px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .aim-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .aim-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--aims);
        }
        
        footer {
            background-color: var(--primary);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-radius: 0 0 8px 8px;
        }
        
        .footer-text {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Save Dialog Styles */
        .save-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .save-dialog.active {
            display: flex;
        }
        
        .save-dialog-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
        }
        
        .save-dialog h3 {
            margin-bottom: 20px;
            color: var(--primary);
        }
        
        .save-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .save-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .save-option:hover {
            border-color: var(--biomed);
            background-color: rgba(155, 89, 182, 0.05);
        }
        
        .save-option.selected {
            border-color: var(--biomed);
            background-color: rgba(155, 89, 182, 0.1);
        }
        
        .save-option-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--biomed);
            color: white;
            font-weight: bold;
        }
        
        .save-option-text {
            flex: 1;
        }
        
        .save-option-text h4 {
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .save-option-text p {
            font-size: 0.9rem;
            color: #666;
        }
        
        .save-dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="biomed-badge">BIOMEDICAL RESEARCH</div>
            <h1>Biomedical Grant Proposal Assistant</h1>
            <p class="subtitle">Build your proposal on a foundation of strong rationale and preliminary evidence</p>
        </header>
        
        <div class="file-controls">
            <button class="btn" id="save-proposal">Save Proposal</button>
            <button class="btn btn-outline" id="load-proposal">Load Proposal</button>
            <input type="file" id="file-input" accept=".json" style="display: none;">
        </div>
        
        <div class="logic-flow">
            <div class="logic-step">
                <div class="step-icon literature-icon">1</div>
                <div class="step-text">Literature Support</div>
            </div>
            <div class="logic-step">
                <div class="step-icon data-icon">2</div>
                <div class="step-text">Preliminary Data</div>
            </div>
            <div class="logic-step">
                <div class="step-icon gap-icon">3</div>
                <div class="step-text">Research Gap</div>
            </div>
            <div class="logic-step">
                <div class="step-icon hypothesis-icon">4</div>
                <div class="step-text">Central Hypothesis</div>
            </div>
            <div class="logic-step">
                <div class="step-icon aims-icon">5</div>
                <div class="step-text">Specific Aims</div>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
            <div class="step-container">
                <div class="step active" id="step-1" data-step="1">1</div>
                <div class="step-label" data-step="1">Literature & Data</div>
            </div>
            <div class="step-container">
                <div class="step" id="step-2" data-step="2">2</div>
                <div class="step-label" data-step="2">Gap & Hypothesis</div>
            </div>
            <div class="step-container">
                <div class="step" id="step-3" data-step="3">3</div>
                <div class="step-label" data-step="3">Specific Aims</div>
            </div>
            <div class="step-container">
                <div class="step" id="step-4" data-step="4">4</div>
                <div class="step-label" data-step="4">Methodology</div>
            </div>
            <div class="step-container">
                <div class="step" id="step-5" data-step="5">5</div>
                <div class="step-label" data-step="5">Review & Export</div>
            </div>
        </div>
        
        <!-- Step 1: Literature & Preliminary Data -->
        <div class="content-section active" id="section-1">
            <h2>Literature Support & Preliminary Data</h2>
            <p>Build the foundation of your proposal with established knowledge and your own preliminary findings.</p>
            
            <div class="rationale-section">
                <h3>Literature Support</h3>
                <p>Document key literature that establishes the current state of knowledge in your field:</p>
                
                <table class="literature-table">
                    <thead>
                        <tr>
                            <th>Citation</th>
                            <th>Key Finding</th>
                            <th>Relevance to Your Project</th>
                        </tr>
                    </thead>
                    <tbody id="literature-table-body">
                        <tr>
                            <td><input type="text" placeholder="Author, Year, Journal" class="citation-input"></td>
                            <td><textarea placeholder="Key finding from this study" rows="2"></textarea></td>
                            <td><textarea placeholder="How this supports your rationale" rows="2"></textarea></td>
                        </tr>
                    </tbody>
                </table>
                <button class="btn btn-outline" id="add-literature">+ Add Another Reference</button>
                
                <div class="form-group">
                    <label for="literature-synthesis">Literature Synthesis</label>
                    <textarea id="literature-synthesis" placeholder="Synthesize the literature to establish what is currently known in your field. What are the key established facts?"></textarea>
                </div>
            </div>
            
            <div class="rationale-section">
                <h3>Preliminary Results</h3>
                <p>Document your preliminary data that provides initial evidence for your research direction:</p>
                
                <div class="preliminary-results">
                    <div class="result-card">
                        <h4>Experimental Results</h4>
                        <div class="form-group">
                            <label for="prelim-data">Describe your preliminary experimental data:</label>
                            <textarea id="prelim-data" placeholder="What experiments have you already conducted? What do the results show?"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="data-interpretation">Interpretation of Results</label>
                            <textarea id="data-interpretation" placeholder="How do these results provide initial support for your research direction?"></textarea>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h4>Method Validation & Feasibility</h4>
                        <div class="form-group">
                            <label for="method-validation">Methodology Validation</label>
                            <textarea id="method-validation" placeholder="What methods have you validated? Show that your approaches work."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="feasibility">Feasibility Evidence</label>
                            <textarea id="feasibility" placeholder="What evidence demonstrates that you can complete the proposed work?"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="logic-connector">
                <div class="connector-text">Based on the literature and preliminary data, we can now identify the specific research gap...</div>
                <div class="connector-arrow">â†’</div>
            </div>
            
            <div class="btn-container">
                <div></div>
                <button class="btn btn-gap" id="next-1">Next: Research Gap & Hypothesis</button>
            </div>
        </div>
        
        <!-- Step 2: Research Gap & Hypothesis -->
        <div class="content-section" id="section-2">
            <h2>Define Research Gap & Central Hypothesis</h2>
            <p>Identify the specific knowledge gap and formulate your central hypothesis based on the evidence.</p>
            
            <div class="gap-section">
                <h3>Research Gap Identification</h3>
                
                <div class="gap-summary">
                    <p><strong>How to identify a compelling research gap:</strong></p>
                    <ol>
                        <li>Review what is established (from literature)</li>
                        <li>Identify what is missing or contradictory</li>
                        <li>Consider how your preliminary data points to this gap</li>
                        <li>Formulate the specific unanswered question</li>
                    </ol>
                </div>
                
                <div class="form-group">
                    <label for="established-knowledge">Established Knowledge (from literature)</label>
                    <textarea id="established-knowledge" placeholder="Summarize what is currently known based on your literature review"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="knowledge-gap">Specific Knowledge Gap</label>
                    <textarea id="knowledge-gap" placeholder="What specific question remains unanswered? What contradiction needs resolution?"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="gap-justification">Justification of Gap Importance</label>
                    <textarea id="gap-justification" placeholder="Why is addressing this gap important for advancing the field?"></textarea>
                </div>
            </div>
            
            <div class="logic-connector">
                <div class="connector-text">Based on this research gap, we can now formulate the central hypothesis...</div>
                <div class="connector-arrow">â†’</div>
            </div>
            
            <div class="hypothesis-section">
                <h3>Central Hypothesis Formulation</h3>
                
                <div class="hypothesis-summary">
                    <p><strong>Characteristics of a strong hypothesis:</strong></p>
                    <ul>
                        <li>Directly addresses the research gap</li>
                        <li>Is testable and falsifiable</li>
                        <li>Is supported by preliminary data</li>
                        <li>Leads to specific, measurable predictions</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label for="central-hypothesis">Central Hypothesis</label>
                    <textarea id="central-hypothesis" placeholder="State your central, testable hypothesis that addresses the research gap"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="hypothesis-rationale">Rationale for Hypothesis</label>
                    <textarea id="hypothesis-rationale" placeholder="Explain how your hypothesis is supported by literature and preliminary data"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="hypothesis-predictions">Key Predictions</label>
                    <textarea id="hypothesis-predictions" placeholder="What specific predictions does your hypothesis generate?"></textarea>
                </div>
            </div>
            
            <div class="logic-connector">
                <div class="connector-text">Based on this central hypothesis, we can now design specific aims to test it...</div>
                <div class="connector-arrow">â†’</div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-outline" id="prev-2">Previous</button>
                <button class="btn btn-hypothesis" id="next-2">Next: Specific Aims</button>
            </div>
        </div>
        
        <!-- Step 3: Specific Aims -->
        <div class="content-section" id="section-3">
            <h2>Design Specific Aims</h2>
            <p>Create specific, measurable aims that directly test your central hypothesis.</p>
            
            <div class="aims-section">
                <h3>Specific Aims Development</h3>
                
                <div class="aim-summary">
                    <p><strong>Characteristics of effective specific aims:</strong></p>
                    <ul>
                        <li>Each aim directly tests part of the central hypothesis</li>
                        <li>Aims are focused and achievable within the project timeline</li>
                        <li>Each aim has clear, measurable outcomes</li>
                        <li>Aims are logically connected and build upon each other</li>
                    </ul>
                </div>
                
                <div id="aims-container">
                    <div class="aim-box" id="aim-1">
                        <div class="aim-header">
                            <div class="aim-title">Specific Aim 1</div>
                        </div>
                        <div class="form-group">
                            <label for="aim1-title">Aim Title</label>
                            <input type="text" id="aim1-title" placeholder="Brief, descriptive title for this aim">
                        </div>
                        <div class="form-group">
                            <label for="aim1-description">Aim Description</label>
                            <textarea id="aim1-description" placeholder="What will you do in this aim? Be specific about experiments and approaches."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="aim1-rationale">Rationale</label>
                            <textarea id="aim1-rationale" placeholder="How does this aim test part of your central hypothesis?"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="aim1-outcomes">Expected Outcomes</label>
                            <textarea id="aim1-outcomes" placeholder="What specific results do you expect? How will you interpret them?"></textarea>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-outline" id="add-aim">+ Add Another Aim</button>
                
                <div class="form-group">
                    <label for="aims-integration">Aims Integration</label>
                    <textarea id="aims-integration" placeholder="How do your aims work together to comprehensively test your central hypothesis?"></textarea>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-outline" id="prev-3">Previous</button>
                <button class="btn" id="next-3">Next: Methodology</button>
            </div>
        </div>
        
        <!-- Step 4: Methodology -->
        <div class="content-section" id="section-4">
            <h2>Research Methodology</h2>
            <p>Define the experimental approaches and techniques you will use to accomplish your specific aims.</p>
            
            <div class="biomed-section">
                <h3>Model Systems</h3>
                <p>Select the primary model system(s) for your research:</p>
                <div class="model-system-grid">
                    <div class="model-system" data-system="cell-culture">Cell Culture</div>
                    <div class="model-system" data-system="animal-model">Animal Model</div>
                    <div class="model-system" data-system="organoid">Organoids</div>
                    <div class="model-system" data-system="yeast">Yeast</div>
                    <div class="model-system" data-system="drosophila">Drosophila</div>
                    <div class="model-system" data-system="c-elegans">C. elegans</div>
                    <div class="model-system" data-system="zebrafish">Zebrafish</div>
                    <div class="model-system" data-system="mouse">Mouse</div>
                    <div class="model-system" data-system="human-tissue">Human Tissue</div>
                    <div class="model-system" data-system="other">Other</div>
                </div>
                <div class="form-group">
                    <label for="model-justification">Justification for Model System Selection</label>
                    <textarea id="model-justification" placeholder="Explain why your chosen model system is appropriate for your research question"></textarea>
                </div>
            </div>
            
            <div class="biomed-section">
                <h3>Experimental Approaches</h3>
                <p>Select the primary methodologies you will employ:</p>
                <div class="methodology-grid">
                    <div class="methodology-item" data-method="genomics">Genomics</div>
                    <div class="methodology-item" data-method="transcriptomics">Transcriptomics</div>
                    <div class="methodology-item" data-method="proteomics">Proteomics</div>
                    <div class="methodology-item" data-method="crispr">CRISPR/Cas9</div>
                    <div class="methodology-item" data-method="microscopy">Live-cell Imaging</div>
                    <div class="methodology-item" data-method="flow-cytometry">Flow Cytometry</div>
                    <div class="methodology-item" data-method="western">Western Blot</div>
                    <div class="methodology-item" data-method="pcr">qPCR/RT-PCR</div>
                    <div class="methodology-item" data-method="mass-spec">Mass Spectrometry</div>
                    <div class="methodology-item" data-method="sequencing">Sequencing</div>
                    <div class="methodology-item" data-method="chip">ChIP</div>
                    <div class="methodology-item" data-method="other-method">Other</div>
                </div>
                <div class="form-group">
                    <label for="method-details">Methodology Details and Justification</label>
                    <textarea id="method-details" placeholder="Provide details on your selected methodologies and justify their use"></textarea>
                </div>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-outline" id="prev-4">Previous</button>
                <button class="btn" id="next-4">Next: Review & Export</button>
            </div>
        </div>
        
        <!-- Step 5: Review & Export -->
        <div class="content-section" id="section-5">
            <h2>Review and Export Your Proposal</h2>
            <p>Review your complete biomedical research proposal and export it for submission.</p>
            
            <div class="proposal-section">
                <h3>Complete Proposal Preview</h3>
                <div class="proposal-content" id="proposal-preview">
                    <!-- Proposal content will be compiled here -->
                </div>
            </div>
            
            <div class="export-options">
                <button class="btn" id="export-doc">Export as Document</button>
                <button class="btn" id="export-pdf">Export as PDF</button>
                <button class="btn btn-outline" id="save-draft">Save Draft</button>
            </div>
            
            <div class="btn-container">
                <button class="btn btn-outline" id="prev-5">Previous</button>
                <button class="btn" id="finish-proposal">Finish</button>
            </div>
            
            <div id="success-message" class="success-message hidden">
                <h3>Congratulations!</h3>
                <p>Your biomedical research grant proposal has been successfully developed. Good luck with your submission!</p>
            </div>
        </div>
        
        <footer>
            <p class="footer-text">Copyright 2025 for Dr. Wen-Ming Yang. All Rights Reserved</p>
        </footer>
    </div>

    <!-- Save Dialog -->
    <div class="save-dialog" id="save-dialog">
        <div class="save-dialog-content">
            <h3>Save Your Proposal</h3>
            <p>Choose how you'd like to save your proposal:</p>
            
            <div class="save-options">
                <div class="save-option" data-option="download">
                    <div class="save-option-icon">â†“</div>
                    <div class="save-option-text">
                        <h4>Download File</h4>
                        <p>Save to your computer as a JSON file that you can share or backup</p>
                    </div>
                </div>
                
                <div class="save-option" data-option="browser">
                    <div class="save-option-icon">ðŸ’¾</div>
                    <div class="save-option-text">
                        <h4>Save to Browser</h4>
                        <p>Store in your browser for quick access (data stays on this device)</p>
                    </div>
                </div>
            </div>
            
            <div class="save-dialog-buttons">
                <button class="btn btn-outline" id="cancel-save">Cancel</button>
                <button class="btn" id="confirm-save">Save Proposal</button>
            </div>
        </div>
    </div>

    <script>
        // Current step tracking
        let currentStep = 1;
        const totalSteps = 5;
        let aimCount = 1;
        
        // DOM Elements
        const progressBar = document.getElementById('progress-bar');
        const stepElements = document.querySelectorAll('.step');
        const stepLabels = document.querySelectorAll('.step-label');
        const sectionElements = document.querySelectorAll('.content-section');
        const nextButtons = document.querySelectorAll('[id^="next-"]');
        const prevButtons = document.querySelectorAll('[id^="prev-"]');
        const saveDialog = document.getElementById('save-dialog');
        const saveOptions = document.querySelectorAll('.save-option');
        let selectedSaveOption = 'download';
        
        // Initialize progress bar
        updateProgressBar();
        
        // Next button event listeners
        nextButtons.forEach(button => {
            button.addEventListener('click', goToNextStep);
        });
        
        // Previous button event listeners
        prevButtons.forEach(button => {
            button.addEventListener('click', goToPrevStep);
        });
        
        // Step navigation via clicking on steps - ALLOW ANY STEP TO BE CLICKED
        stepElements.forEach(step => {
            step.addEventListener('click', function() {
                const stepNumber = parseInt(this.getAttribute('data-step'));
                currentStep = stepNumber;
                updateUI();
            });
        });
        
        stepLabels.forEach(label => {
            label.addEventListener('click', function() {
                const stepNumber = parseInt(this.getAttribute('data-step'));
                currentStep = stepNumber;
                updateUI();
            });
        });
        
        // Step navigation functions
        function goToNextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateUI();
            }
        }
        
        function goToPrevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateUI();
            }
        }
        
        function updateUI() {
            // Update progress bar
            updateProgressBar();
            
            // Update step indicators
            stepElements.forEach((step, index) => {
                if (index + 1 < currentStep) {
                    step.classList.remove('active');
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
            
            // Update content sections
            sectionElements.forEach((section, index) => {
                if (index + 1 === currentStep) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            
            // Update proposal preview in the last step
            if (currentStep === 5) {
                updateProposalPreview();
            }
        }
        
        function updateProgressBar() {
            const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            progressBar.style.width = `${progressPercentage}%`;
        }
        
        // Save option selection
        saveOptions.forEach(option => {
            option.addEventListener('click', function() {
                saveOptions.forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedSaveOption = this.getAttribute('data-option');
            });
        });
        
        // Save dialog functionality
        document.getElementById('save-proposal').addEventListener('click', function() {
            // Select the first option by default
            saveOptions[0].classList.add('selected');
            selectedSaveOption = 'download';
            
            saveDialog.classList.add('active');
        });
        
        document.getElementById('cancel-save').addEventListener('click', function() {
            saveDialog.classList.remove('active');
        });
        
        document.getElementById('confirm-save').addEventListener('click', function() {
            saveDialog.classList.remove('active');
            
            if (selectedSaveOption === 'download') {
                downloadProposal();
            } else if (selectedSaveOption === 'browser') {
                saveToBrowser();
            }
        });
        
        // Literature table functionality
        document.getElementById('add-literature').addEventListener('click', function() {
            const tableBody = document.getElementById('literature-table-body');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" placeholder="Author, Year, Journal" class="citation-input"></td>
                <td><textarea placeholder="Key finding from this study" rows="2"></textarea></td>
                <td><textarea placeholder="How this supports your rationale" rows="2"></textarea></td>
            `;
            tableBody.appendChild(newRow);
        });
        
        // Add aim functionality
        document.getElementById('add-aim').addEventListener('click', function() {
            aimCount++;
            const aimsContainer = document.getElementById('aims-container');
            const newAim = document.createElement('div');
            newAim.className = 'aim-box';
            newAim.id = `aim-${aimCount}`;
            newAim.innerHTML = `
                <div class="aim-header">
                    <div class="aim-title">Specific Aim ${aimCount}</div>
                </div>
                <div class="form-group">
                    <label for="aim${aimCount}-title">Aim Title</label>
                    <input type="text" id="aim${aimCount}-title" placeholder="Brief, descriptive title for this aim">
                </div>
                <div class="form-group">
                    <label for="aim${aimCount}-description">Aim Description</label>
                    <textarea id="aim${aimCount}-description" placeholder="What will you do in this aim? Be specific about experiments and approaches."></textarea>
                </div>
                <div class="form-group">
                    <label for="aim${aimCount}-rationale">Rationale</label>
                    <textarea id="aim${aimCount}-rationale" placeholder="How does this aim test part of your central hypothesis?"></textarea>
                </div>
                <div class="form-group">
                    <label for="aim${aimCount}-outcomes">Expected Outcomes</label>
                    <textarea id="aim${aimCount}-outcomes" placeholder="What specific results do you expect? How will you interpret them?"></textarea>
                </div>
            `;
            
            // Insert before the "Add Another Aim" button
            this.parentNode.insertBefore(newAim, this);
        });
        
        // Model system selection
        const modelSystems = document.querySelectorAll('.model-system');
        modelSystems.forEach(system => {
            system.addEventListener('click', function() {
                this.classList.toggle('selected');
            });
        });
        
        // Methodology selection
        const methodologyItems = document.querySelectorAll('.methodology-item');
        methodologyItems.forEach(item => {
            item.addEventListener('click', function() {
                this.classList.toggle('selected');
            });
        });
        
        // Update proposal preview
        function updateProposalPreview() {
            const preview = document.getElementById('proposal-preview');
            let compiledProposal = '';
            
            // Get project basics
            const projectTitle = document.getElementById('project-title') ? document.getElementById('project-title').value : '[Project Title]';
            
            compiledProposal += `<h2>${projectTitle}</h2>`;
            
            // Get literature information
            const literatureSynthesis = document.getElementById('literature-synthesis') ? document.getElementById('literature-synthesis').value : '';
            const establishedKnowledge = document.getElementById('established-knowledge') ? document.getElementById('established-knowledge').value : '';
            
            if (literatureSynthesis) {
                compiledProposal += `<h3>Literature Review</h3><p>${literatureSynthesis}</p>`;
            }
            
            if (establishedKnowledge) {
                compiledProposal += `<h3>Established Knowledge</h3><p>${establishedKnowledge}</p>`;
            }
            
            // Get preliminary data
            const prelimData = document.getElementById('prelim-data') ? document.getElementById('prelim-data').value : '';
            if (prelimData) {
                compiledProposal += `<h3>Preliminary Data</h3><p>${prelimData}</p>`;
            }
            
            // Get gap and hypothesis
            const knowledgeGap = document.getElementById('knowledge-gap') ? document.getElementById('knowledge-gap').value : '';
            const centralHypothesis = document.getElementById('central-hypothesis') ? document.getElementById('central-hypothesis').value : '';
            
            if (knowledgeGap) {
                compiledProposal += `<h3>Research Gap</h3><p>${knowledgeGap}</p>`;
            }
            
            if (centralHypothesis) {
                compiledProposal += `<h3>Central Hypothesis</h3><p>${centralHypothesis}</p>`;
            }
            
            // Get specific aims
            for (let i = 1; i <= aimCount; i++) {
                const aimTitle = document.getElementById(`aim${i}-title`) ? document.getElementById(`aim${i}-title`).value : '';
                const aimDescription = document.getElementById(`aim${i}-description`) ? document.getElementById(`aim${i}-description`).value : '';
                
                if (aimTitle || aimDescription) {
                    compiledProposal += `<h3>Specific Aim ${i}</h3>`;
                    if (aimTitle) compiledProposal += `<h4>${aimTitle}</h4>`;
                    if (aimDescription) compiledProposal += `<p>${aimDescription}</p>`;
                }
            }
            
            // Get selected model systems
            const selectedModels = Array.from(document.querySelectorAll('.model-system.selected'))
                .map(model => model.textContent)
                .join(', ');
            if (selectedModels) {
                compiledProposal += `<h3>Model Systems</h3><p>${selectedModels}</p>`;
            }
            
            // Get selected methodologies
            const selectedMethods = Array.from(document.querySelectorAll('.methodology-item.selected'))
                .map(method => method.textContent)
                .join(', ');
            if (selectedMethods) {
                compiledProposal += `<h3>Methodologies</h3><p>${selectedMethods}</p>`;
            }
            
            preview.innerHTML = compiledProposal || '<p>Your proposal content will appear here once you complete the previous sections.</p>';
        }
        
        // Download proposal functionality
        function downloadProposal() {
            const proposalData = collectProposalData();
            const dataStr = JSON.stringify(proposalData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            // Create download link
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            
            // Generate filename with timestamp
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const projectTitle = document.getElementById('project-title')?.value || 'biomedical_grant_proposal';
            const filename = `${projectTitle.replace(/\s+/g, '_')}_${timestamp}.json`;
            
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Proposal downloaded successfully!');
        }
        
        // Save to browser functionality
        function saveToBrowser() {
            const proposalData = collectProposalData();
            localStorage.setItem('biomedicalGrantProposal', JSON.stringify(proposalData));
            alert('Proposal saved to browser storage! You can reload it anytime.');
        }
        
        // Load proposal functionality
        document.getElementById('load-proposal').addEventListener('click', function() {
            document.getElementById('file-input').click();
        });
        
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const proposalData = JSON.parse(e.target.result);
                    loadProposalData(proposalData);
                    alert('Proposal loaded successfully!');
                } catch (error) {
                    alert('Error loading proposal: Invalid file format');
                }
            };
            reader.readAsText(file);
        });
        
        // Collect all proposal data
        function collectProposalData() {
            const data = {
                currentStep: currentStep,
                aimCount: aimCount,
                // Basic project info
                projectTitle: document.getElementById('project-title')?.value || '',
                researchQuestion: document.getElementById('research-question')?.value || '',
                hypothesis: document.getElementById('hypothesis')?.value || '',
                biologicalProblem: document.getElementById('biological-problem')?.value || '',
                knowledgeGap: document.getElementById('knowledge-gap')?.value || '',
                potentialImpact: document.getElementById('potential-impact')?.value || '',
                
                // Literature data
                literatureSynthesis: document.getElementById('literature-synthesis')?.value || '',
                establishedKnowledge: document.getElementById('established-knowledge')?.value || '',
                
                // Preliminary data
                prelimData: document.getElementById('prelim-data')?.value || '',
                dataInterpretation: document.getElementById('data-interpretation')?.value || '',
                methodValidation: document.getElementById('method-validation')?.value || '',
                feasibility: document.getElementById('feasibility')?.value || '',
                
                // Hypothesis data
                centralHypothesis: document.getElementById('central-hypothesis')?.value || '',
                hypothesisRationale: document.getElementById('hypothesis-rationale')?.value || '',
                hypothesisPredictions: document.getElementById('hypothesis-predictions')?.value || '',
                gapJustification: document.getElementById('gap-justification')?.value || '',
                
                // Aims data
                aimsIntegration: document.getElementById('aims-integration')?.value || '',
                aims: []
            };
            
            // Collect aims data
            for (let i = 1; i <= aimCount; i++) {
                const aim = {
                    title: document.getElementById(`aim${i}-title`)?.value || '',
                    description: document.getElementById(`aim${i}-description`)?.value || '',
                    rationale: document.getElementById(`aim${i}-rationale`)?.value || '',
                    outcomes: document.getElementById(`aim${i}-outcomes`)?.value || ''
                };
                data.aims.push(aim);
            }
            
            // Collect methodology data
            data.modelJustification = document.getElementById('model-justification')?.value || '';
            data.methodDetails = document.getElementById('method-details')?.value || '';
            
            // Collect selected model systems
            data.selectedModels = Array.from(document.querySelectorAll('.model-system.selected'))
                .map(model => model.textContent);
                
            // Collect selected methodologies
            data.selectedMethods = Array.from(document.querySelectorAll('.methodology-item.selected'))
                .map(method => method.textContent);
            
            return data;
        }
        
        // Load proposal data
        function loadProposalData(data) {
            // Restore basic navigation state
            currentStep = data.currentStep || 1;
            aimCount = data.aimCount || 1;
            
            // Restore basic project info
            if (document.getElementById('project-title')) document.getElementById('project-title').value = data.projectTitle || '';
            if (document.getElementById('research-question')) document.getElementById('research-question').value = data.researchQuestion || '';
            if (document.getElementById('hypothesis')) document.getElementById('hypothesis').value = data.hypothesis || '';
            if (document.getElementById('biological-problem')) document.getElementById('biological-problem').value = data.biologicalProblem || '';
            if (document.getElementById('knowledge-gap')) document.getElementById('knowledge-gap').value = data.knowledgeGap || '';
            if (document.getElementById('potential-impact')) document.getElementById('potential-impact').value = data.potentialImpact || '';
            
            // Restore literature data
            if (document.getElementById('literature-synthesis')) document.getElementById('literature-synthesis').value = data.literatureSynthesis || '';
            if (document.getElementById('established-knowledge')) document.getElementById('established-knowledge').value = data.establishedKnowledge || '';
            
            // Restore preliminary data
            if (document.getElementById('prelim-data')) document.getElementById('prelim-data').value = data.prelimData || '';
            if (document.getElementById('data-interpretation')) document.getElementById('data-interpretation').value = data.dataInterpretation || '';
            if (document.getElementById('method-validation')) document.getElementById('method-validation').value = data.methodValidation || '';
            if (document.getElementById('feasibility')) document.getElementById('feasibility').value = data.feasibility || '';
            
            // Restore hypothesis data
            if (document.getElementById('central-hypothesis')) document.getElementById('central-hypothesis').value = data.centralHypothesis || '';
            if (document.getElementById('hypothesis-rationale')) document.getElementById('hypothesis-rationale').value = data.hypothesisRationale || '';
            if (document.getElementById('hypothesis-predictions')) document.getElementById('hypothesis-predictions').value = data.hypothesisPredictions || '';
            if (document.getElementById('gap-justification')) document.getElementById('gap-justification').value = data.gapJustification || '';
            
            // Restore aims data
            if (document.getElementById('aims-integration')) document.getElementById('aims-integration').value = data.aimsIntegration || '';
            
            // Restore aims
            const aimsContainer = document.getElementById('aims-container');
            if (aimsContainer) {
                // Clear existing aims except the first one
                while (aimsContainer.children.length > 1) {
                    aimsContainer.removeChild(aimsContainer.lastChild);
                }
                
                // Restore additional aims
                for (let i = 2; i <= aimCount; i++) {
                    const addAimButton = document.getElementById('add-aim');
                    addAimButton.click();
                }
                
                // Populate aim data
                data.aims.forEach((aim, index) => {
                    const aimNumber = index + 1;
                    if (document.getElementById(`aim${aimNumber}-title`)) document.getElementById(`aim${aimNumber}-title`).value = aim.title || '';
                    if (document.getElementById(`aim${aimNumber}-description`)) document.getElementById(`aim${aimNumber}-description`).value = aim.description || '';
                    if (document.getElementById(`aim${aimNumber}-rationale`)) document.getElementById(`aim${aimNumber}-rationale`).value = aim.rationale || '';
                    if (document.getElementById(`aim${aimNumber}-outcomes`)) document.getElementById(`aim${aimNumber}-outcomes`).value = aim.outcomes || '';
                });
            }
            
            // Restore methodology data
            if (document.getElementById('model-justification')) document.getElementById('model-justification').value = data.modelJustification || '';
            if (document.getElementById('method-details')) document.getElementById('method-details').value = data.methodDetails || '';
            
            // Restore selected model systems
            document.querySelectorAll('.model-system').forEach(system => {
                system.classList.remove('selected');
                if (data.selectedModels && data.selectedModels.includes(system.textContent)) {
                    system.classList.add('selected');
                }
            });
            
            // Restore selected methodologies
            document.querySelectorAll('.methodology-item').forEach(item => {
                item.classList.remove('selected');
                if (data.selectedMethods && data.selectedMethods.includes(item.textContent)) {
                    item.classList.add('selected');
                }
            });
            
            // Update UI
            updateUI();
        }
        
        // Export functionality
        document.getElementById('export-doc').addEventListener('click', function() {
            alert('Document export functionality would be implemented here. In a real application, this would generate a Word document with proper biomedical formatting.');
        });
        
        document.getElementById('export-pdf').addEventListener('click', function() {
            alert('PDF export functionality would be implemented here. In a real application, this would generate a PDF file suitable for grant submission.');
        });
        
        document.getElementById('save-draft').addEventListener('click', function() {
            saveToBrowser();
        });
        
        document.getElementById('finish-proposal').addEventListener('click', function() {
            document.getElementById('success-message').classList.remove('hidden');
        });
        
        // Load from localStorage on page load if available - WITHOUT AUTO-POPUP
        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('biomedicalGrantProposal');
            // Just load the data silently if available, don't show popup
            if (savedData) {
                try {
                    const proposalData = JSON.parse(savedData);
                    loadProposalData(proposalData);
                } catch (error) {
                    console.error('Error loading saved proposal:', error);
                }
            }
        });
    </script>
</body>
</html>