<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlowChat - Enhanced Workflow Integration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: #333;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            height: 97vh;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .workflow-guide {
            width: 300px;
            background: #f8f9ff;
            border-right: 1px solid #e0e6ff;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .workflow-guide.collapsed {
            width: 50px;
            padding: 20px 5px;
        }
        
        .workflow-guide.collapsed .guide-content {
            display: none;
        }
        
        .workflow-guide.collapsed .guide-header h2 {
            writing-mode: vertical-lr;
            transform: rotate(180deg);
            text-align: center;
            margin: 0 auto;
            font-size: 1rem;
        }
        
        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .guide-header h2 {
            font-size: 1.2rem;
            color: #6e8efb;
        }
        
        .toggle-guide {
            background: #6e8efb;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .workflow-step {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #6e8efb;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .workflow-step.active {
            border-left: 4px solid #4caf50;
            background: #f0f9ff;
        }
        
        .workflow-step.completed {
            border-left: 4px solid #9e9e9e;
            opacity: 0.8;
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .step-title {
            font-weight: 600;
            font-size: 1rem;
        }
        
        .step-status {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            background: #f0f4ff;
        }
        
        .step-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .step-timer {
            font-size: 0.8rem;
            color: #6e8efb;
            font-weight: 500;
        }
        
        .step-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .step-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            background: #6e8efb;
            color: white;
        }
        
        .step-btn.skip {
            background: #9e9e9e;
        }
        
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: #6e8efb;
            color: white;
            padding: 12px 20px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
        }
        
        h1 {
            font-size: 1.7rem;
            margin-bottom: 3px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 50px;
        }
        
        .toggle-text {
            margin-right: 6px;
            font-size: 0.75rem;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 18px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 18px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #3a3af4;
        }
        
        input:checked + .slider:before {
            transform: translateX(18px);
        }
        
        .status-indicator {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="rgba(240, 244, 255, 0.6)"/><path d="M0 50 L100 50" stroke="rgba(200, 210, 255, 0.3)" stroke-width="1"/><path d="M50 0 L50 100" stroke="rgba(200, 210, 255, 0.3)" stroke-width="1"/></svg>');
        }
        
        .message {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 16px;
            position: relative;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: #6e8efb;
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .app-message {
            background: #f0f4ff;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .message-actions {
            position: absolute;
            top: 4px;
            right: 8px;
            display: none;
        }
        
        .message:hover .message-actions {
            display: flex;
            gap: 6px;
        }
        
        .action-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: scale(1.1);
        }
        
        .edit-textarea {
            width: 100%;
            background: transparent;
            border: 1px dashed rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            padding: 8px;
            color: inherit;
            font-family: inherit;
            resize: none;
            min-height: 70px;
        }
        
        .input-area {
            padding: 12px 15px;
            background: white;
            border-top: 1px solid #e0e6ff;
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }
        
        #user-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #e0e6ff;
            border-radius: 50px;
            font-size: 0.95rem;
            outline: none;
            transition: border-color 0.3s;
        }
        
        #user-input:focus {
            border-color: #6e8efb;
        }
        
        #send-btn {
            width: 46px;
            height: 46px;
            border-radius: 50%;
            background: #6e8efb;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            transition: background 0.3s;
        }
        
        #send-btn:hover {
            background: #5a7ce7;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: #f8f9ff;
            border-top: 1px solid #e0e6ff;
            flex-shrink: 0;
        }
        
        .control-btn {
            background: white;
            border: 2px solid #e0e6ff;
            padding: 6px 12px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        .control-btn:hover {
            border-color: #6e8efb;
            color: #6e8efb;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background: #f0f4ff;
            border-top: 1px solid #e0e6ff;
            font-size: 0.8rem;
            color: #5c6bc0;
            flex-shrink: 0;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-weight: 700;
            font-size: 1rem;
            margin-top: 2px;
        }
        
        .timestamp {
            font-size: 0.6rem;
            opacity: 0.7;
            margin-top: 4px;
        }
        
        .user-timestamp {
            text-align: left;
        }
        
        .app-timestamp {
            text-align: right;
        }
        
        .highlight {
            background-color: #ffeb3b;
            padding: 0 2px;
            border-radius: 3px;
        }
        
        .highlight-controls {
            display: flex;
            gap: 4px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .highlight-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .highlight-btn:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        .search-container {
            padding: 8px 15px;
            background: #f8f9ff;
            border-bottom: 1px solid #e0e6ff;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        #search-input {
            flex: 1;
            padding: 7px 12px;
            border: 1px solid #e0e6ff;
            border-radius: 50px;
            font-size: 0.85rem;
            outline: none;
            display: none; /* Hidden by default */
        }
        
        #search-btn {
            background: #6e8efb;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 0 12px;
            cursor: pointer;
            font-size: 0.85rem;
            display: none; /* Hidden by default */
        }
        
        .typing-indicator {
            display: none;
            padding: 8px 15px;
            background: #f0f4ff;
            border-radius: 18px;
            align-self: flex-end;
            margin-bottom: 5px;
            font-style: italic;
            color: #666;
            font-size: 0.9rem;
        }
        
        .typing-indicator i {
            margin-right: 5px;
            color: #6e8efb;
        }
        
        .sidebar-toggle {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #6e8efb;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            
            .workflow-guide {
                width: 100%;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid #e0e6ff;
            }
            
            .workflow-guide.collapsed {
                width: 100%;
                max-height: 50px;
                padding: 10px;
            }
            
            .workflow-guide.collapsed .guide-header h2 {
                writing-mode: horizontal-tb;
                transform: none;
                margin: 0;
            }
            
            .sidebar-toggle {
                display: flex;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                height: 98vh;
                border-radius: 15px;
            }
            
            header {
                flex-direction: column;
                gap: 8px;
                padding: 10px 15px;
            }
            
            .header-left, .header-right {
                width: 100%;
                justify-content: center;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .message {
                max-width: 85%;
                padding: 8px 12px;
            }
            
            .controls {
                flex-wrap: wrap;
                gap: 6px;
                justify-content: center;
            }
            
            .control-btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .message-actions {
                display: flex !important;
                opacity: 0.7;
                top: -6px;
                right: 4px;
            }
            
            .search-container {
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="sidebar-toggle" id="mobile-toggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="main-content">
            <div class="workflow-guide" id="workflow-guide">
                <div class="guide-header">
                    <h2>Workflow Guide</h2>
                    <button class="toggle-guide" id="toggle-guide">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                </div>
                <div class="guide-content">
                    <div class="workflow-step active" id="step-1">
                        <div class="step-header">
                            <div class="step-title">1. Set Intentions</div>
                            <div class="step-status">Active</div>
                        </div>
                        <div class="step-description">What do you want to accomplish in this session?</div>
                        <div class="step-timer">Suggested: 5 minutes</div>
                        <div class="step-actions">
                            <button class="step-btn" onclick="completeStep(1)">Complete</button>
                            <button class="step-btn skip" onclick="skipStep(1)">Skip</button>
                        </div>
                    </div>
                    
                    <div class="workflow-step" id="step-2">
                        <div class="step-header">
                            <div class="step-title">2. Brainstorm Ideas</div>
                            <div class="step-status">Pending</div>
                        </div>
                        <div class="step-description">Jot down all relevant thoughts and ideas</div>
                        <div class="step-timer">Suggested: 10 minutes</div>
                        <div class="step-actions">
                            <button class="step-btn" onclick="completeStep(2)">Complete</button>
                            <button class="step-btn skip" onclick="skipStep(2)">Skip</button>
                        </div>
                    </div>
                    
                    <div class="workflow-step" id="step-3">
                        <div class="step-header">
                            <div class="step-title">3. Organize Thoughts</div>
                            <div class="step-status">Pending</div>
                        </div>
                        <div class="step-description">Group related ideas and create structure</div>
                        <div class="step-timer">Suggested: 8 minutes</div>
                        <div class="step-actions">
                            <button class="step-btn" onclick="completeStep(3)">Complete</button>
                            <button class="step-btn skip" onclick="skipStep(3)">Skip</button>
                        </div>
                    </div>
                    
                    <div class="workflow-step" id="step-4">
                        <div class="step-header">
                            <div class="step-title">4. Deep Work</div>
                            <div class="step-status">Pending</div>
                        </div>
                        <div class="step-description">Focus on your most important task</div>
                        <div class="step-timer">Suggested: 25 minutes</div>
                        <div class="step-actions">
                            <button class="step-btn" onclick="completeStep(4)">Complete</button>
                            <button class="step-btn skip" onclick="skipStep(4)">Skip</button>
                        </div>
                    </div>
                    
                    <div class="workflow-step" id="step-5">
                        <div class="step-header">
                            <div class="step-title">5. Review & Refine</div>
                            <div class="step-status">Pending</div>
                        </div>
                        <div class="step-description">Evaluate your work and make improvements</div>
                        <div class="step-timer">Suggested: 7 minutes</div>
                        <div class="step-actions">
                            <button class="step-btn" onclick="completeStep(5)">Complete</button>
                            <button class="step-btn skip" onclick="skipStep(5)">Skip</button>
                        </div>
                    </div>
                    
                    <div class="workflow-step" id="step-6">
                        <div class="step-header">
                            <div class="step-title">6. Plan Next Steps</div>
                            <div class="step-status">Pending</div>
                        </div>
                        <div class="step-description">What will you do in your next session?</div>
                        <div class="step-timer">Suggested: 5 minutes</div>
                        <div class="step-actions">
                            <button class="step-btn" onclick="completeStep(6)">Complete</button>
                            <button class="step-btn skip" onclick="skipStep(6)">Skip</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="chat-section">
                <header>
                    <div class="header-left">
                        <h1>FlowChat</h1>
                        <p class="subtitle">Guided workflow for deep focus</p>
                    </div>
                    <div class="header-right">
                        <div class="toggle-container">
                            <span class="toggle-text">Chatbot:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="chatbot-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="status-indicator" id="chatbot-status">ON</div>
                    </div>
                </header>
                
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search messages...">
                    <button id="search-btn"><i class="fas fa-search"></i></button>
                </div>
                
                <div class="chat-container" id="chat-container">
                    <div class="message app-message">
                        <div class="message-actions">
                            <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                        <p>Welcome to FlowChat! I see you're starting with <strong>Step 1: Set Intentions</strong>. What would you like to accomplish in this session?</p>
                        <div class="timestamp app-timestamp">Just now</div>
                    </div>
                    
                    <div class="typing-indicator" id="typing-indicator">
                        <i class="fas fa-circle-notch fa-spin"></i>FlowChat is typing...
                    </div>
                </div>
                
                <div class="input-area">
                    <input type="text" id="user-input" placeholder="Type your thoughts or tasks here..." autocomplete="off">
                    <button id="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <div class="controls">
                    <div class="control-btn" id="theme-btn">
                        <i class="fas fa-moon"></i>
                        <span>Dark Mode</span>
                    </div>
                    <div class="control-btn" id="save-btn">
                        <i class="fas fa-save"></i>
                        <span>Save Session</span>
                    </div>
                    <div class="control-btn" id="clear-btn">
                        <i class="fas fa-trash"></i>
                        <span>Clear Chat</span>
                    </div>
                    <div class="control-btn" id="export-btn">
                        <i class="fas fa-download"></i>
                        <span>Export</span>
                    </div>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <span>Messages</span>
                        <span class="stat-value" id="message-count">1</span>
                    </div>
                    <div class="stat-item">
                        <span>Words</span>
                        <span class="stat-value" id="word-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Focus Time</span>
                        <span class="stat-value" id="time-active">0m</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Workflow management
        let currentStep = 1;
        const totalSteps = 6;
        let sidebarCollapsed = false;
        
        // Step-specific guidance messages
        const stepGuidance = {
            1: [
                "Great! You've set your intentions. What specific outcome are you hoping to achieve?",
                "Nice work clarifying your intentions. What would make this session successful for you?",
                "Intentions set! What's the most important thing to focus on first?"
            ],
            2: [
                "Good job brainstorming! Which of these ideas seems most promising to you?",
                "You've generated some great ideas. Which one are you most excited to explore?",
                "Brainstorming complete! Are there any patterns or themes emerging from your ideas?"
            ],
            3: [
                "Well done organizing your thoughts! How does this structure support your goals?",
                "You've created a good structure. What's the logical flow of your work?",
                "Organization complete! Does this structure help clarify your next steps?"
            ],
            4: [
                "Excellent deep work session! What did you accomplish during this focused time?",
                "You maintained good focus! What was the most valuable insight from this session?",
                "Deep work complete! How did this focused time move you toward your goals?"
            ],
            5: [
                "Good review! What improvements will make the biggest impact?",
                "You've identified some good refinements. What's now clearer than before?",
                "Review complete! How has your work evolved through this process?"
            ],
            6: [
                "Great planning! What are you most looking forward to in your next session?",
                "You've set clear next steps. What will you start with next time?",
                "Planning complete! How do these next steps build on today's progress?"
            ]
        };
        
        // Step transition questions
        const transitionQuestions = {
            1: "Now let's move to brainstorming. What ideas come to mind for your project?",
            2: "Ready to organize your thoughts? How might you group these ideas together?",
            3: "Time for deep work! What's the first task you'll focus on?",
            4: "Let's review what you've accomplished. What stands out as most valuable?",
            5: "Finally, let's plan next steps. What will you focus on in your next session?",
            6: "You've completed all steps! Would you like to start a new session or continue working?"
        };

        // Toggle workflow guide
        function toggleSidebar() {
            const guide = document.getElementById('workflow-guide');
            const toggleBtn = document.getElementById('toggle-guide');
            const mobileToggleBtn = document.getElementById('mobile-toggle');
            
            guide.classList.toggle('collapsed');
            sidebarCollapsed = guide.classList.contains('collapsed');
            
            if (sidebarCollapsed) {
                toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                mobileToggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
            } else {
                toggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                mobileToggleBtn.innerHTML = '<i class="fas fa-times"></i>';
            }
        }
        
        document.getElementById('toggle-guide').addEventListener('click', toggleSidebar);
        document.getElementById('mobile-toggle').addEventListener('click', toggleSidebar);

        function completeStep(stepNumber) {
            // Mark current step as completed
            document.getElementById(`step-${stepNumber}`).classList.remove('active');
            document.getElementById(`step-${stepNumber}`).classList.add('completed');
            document.querySelector(`#step-${stepNumber} .step-status`).textContent = 'Completed';
            
            // Show typing indicator
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'block';
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Generate guidance for completed step
            const guidanceMessages = stepGuidance[stepNumber];
            const randomGuidance = guidanceMessages[Math.floor(Math.random() * guidanceMessages.length)];
            
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                
                // Add guidance message
                const messageEl = document.createElement('div');
                messageEl.classList.add('message', 'app-message');
                messageEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>${randomGuidance}</p>
                    <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(messageEl);
                addMessageListeners(messageEl);
                messages++;
                messageCount.textContent = messages;
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Now show the transition to the next step
                if (stepNumber < totalSteps) {
                    setTimeout(() => {
                        showNextStepTransition(stepNumber);
                    }, 1500);
                } else {
                    // All steps completed
                    setTimeout(() => {
                        const messageEl = document.createElement('div');
                        messageEl.classList.add('message', 'app-message');
                        messageEl.innerHTML = `
                            <div class="message-actions">
                                <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                            <p>Congratulations! You've completed all workflow steps. Would you like to start a new session?</p>
                            <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                        `;
                        chatContainer.appendChild(messageEl);
                        addMessageListeners(messageEl);
                        messages++;
                        messageCount.textContent = messages;
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 1500);
                }
            }, 1500);
        }
        
        function showNextStepTransition(stepNumber) {
            currentStep = stepNumber + 1;
            
            // Activate the next step
            document.getElementById(`step-${currentStep}`).classList.add('active');
            document.querySelector(`#step-${currentStep} .step-status`).textContent = 'Active';
            
            // Show typing indicator
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'block';
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Get transition question
            const transitionQuestion = transitionQuestions[stepNumber];
            
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                
                // Add transition message
                const messageEl = document.createElement('div');
                messageEl.classList.add('message', 'app-message');
                messageEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>${transitionQuestion}</p>
                    <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(messageEl);
                addMessageListeners(messageEl);
                messages++;
                messageCount.textContent = messages;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 1500);
        }
        
        function skipStep(stepNumber) {
            document.getElementById(`step-${stepNumber}`).classList.remove('active');
            document.getElementById(`step-${stepNumber}`).classList.add('completed');
            document.querySelector(`#step-${stepNumber} .step-status`).textContent = 'Skipped';
            
            // Add message about skipping step
            setTimeout(() => {
                const messageEl = document.createElement('div');
                messageEl.classList.add('message', 'app-message');
                messageEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>Okay, let's move on to the next step.</p>
                    <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(messageEl);
                addMessageListeners(messageEl);
                messages++;
                messageCount.textContent = messages;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 800);
            
            if (stepNumber < totalSteps) {
                currentStep = stepNumber + 1;
                document.getElementById(`step-${currentStep}`).classList.add('active');
                document.querySelector(`#step-${currentStep} .step-status`).textContent = 'Active';
                
                // Add a message about the next step
                const transitionQuestion = transitionQuestions[stepNumber];
                
                setTimeout(() => {
                    const messageEl = document.createElement('div');
                    messageEl.classList.add('message', 'app-message');
                    messageEl.innerHTML = `
                        <div class="message-actions">
                            <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                        <p>${transitionQuestion}</p>
                        <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                    `;
                    chatContainer.appendChild(messageEl);
                    addMessageListeners(messageEl);
                    messages++;
                    messageCount.textContent = messages;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 1800);
            }
        }
        
        // Chat functionality
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const messageCount = document.getElementById('message-count');
            const wordCount = document.getElementById('word-count');
            const timeActive = document.getElementById('time-active');
            const themeBtn = document.getElementById('theme-btn');
            const saveBtn = document.getElementById('save-btn');
            const clearBtn = document.getElementById('clear-btn');
            const exportBtn = document.getElementById('export-btn');
            const chatbotToggle = document.getElementById('chatbot-toggle');
            const chatbotStatus = document.getElementById('chatbot-status');
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const typingIndicator = document.getElementById('typing-indicator');
            
            let messages = 1;
            let words = 0;
            let activeMinutes = 0;
            let activeSeconds = 0;
            let isDarkMode = false;
            let chatbotEnabled = true;
            let conversationHistory = [];
            
            // Update chatbot status text
            function updateChatbotStatus() {
                chatbotStatus.textContent = chatbotEnabled ? 'ON' : 'OFF';
                chatbotStatus.style.background = chatbotEnabled ? 
                    'rgba(76, 175, 80, 0.3)' : 'rgba(244, 67, 54, 0.3)';
                
                // Add a status message when toggling
                const statusEl = document.createElement('div');
                statusEl.classList.add('message', 'app-message');
                statusEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>Chatbot responses are now ${chatbotEnabled ? 'enabled' : 'disabled'}.</p>
                    <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(statusEl);
                addMessageListeners(statusEl);
                messages++;
                messageCount.textContent = messages;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // Toggle chatbot on/off
            chatbotToggle.addEventListener('change', function() {
                chatbotEnabled = this.checked;
                updateChatbotStatus();
            });
            
            // Focus timer
            setInterval(() => {
                activeSeconds++;
                if (activeSeconds >= 60) {
                    activeSeconds = 0;
                    activeMinutes++;
                }
                timeActive.textContent = `${activeMinutes}m`;
            }, 1000);
            
            // Search functionality
            searchBtn.addEventListener('click', searchMessages);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchMessages();
                }
            });
            
            function searchMessages() {
                const term = searchInput.value.trim().toLowerCase();
                if (term === '') return;
                
                const messageElements = chatContainer.querySelectorAll('.message');
                let found = false;
                
                messageElements.forEach(msg => {
                    const text = msg.querySelector('p').textContent.toLowerCase();
                    if (text.includes(term)) {
                        msg.style.backgroundColor = msg.classList.contains('user-message') 
                            ? '#8faefc' : '#e0e8ff';
                        msg.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        found = true;
                        
                        // Reset background after 3 seconds
                        setTimeout(() => {
                            msg.style.backgroundColor = '';
                        }, 3000);
                    }
                });
                
                if (!found) {
                    const noResultsEl = document.createElement('div');
                    noResultsEl.classList.add('message', 'app-message');
                    noResultsEl.innerHTML = `
                        <div class="message-actions">
                            <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                        <p>No messages found containing "${term}"</p>
                        <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                    `;
                    chatContainer.appendChild(noResultsEl);
                    addMessageListeners(noResultsEl);
                    messages++;
                    messageCount.textContent = messages;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            }
            
            // Add event listeners to message actions
            function addMessageListeners(messageEl) {
                const editBtn = messageEl.querySelector('.action-btn:first-child');
                const deleteBtn = messageEl.querySelector('.action-btn:last-child');
                
                if (editBtn) {
                    editBtn.addEventListener('click', function() {
                        const messageText = messageEl.querySelector('p').innerHTML;
                        const isUserMessage = messageEl.classList.contains('user-message');
                        messageEl.innerHTML = `
                            <textarea class="edit-textarea">${stripHtml(messageText)}</textarea>
                            <div class="highlight-controls">
                                <button class="highlight-btn" data-color="#ffeb3b">Yellow Highlight</button>
                                <button class="highlight-btn" data-color="#a7e9ff">Blue Highlight</button>
                                <button class="highlight-btn" data-color="#ffb3ba">Pink Highlight</button>
                            </div>
                            <button class="action-btn save-edit" title="Save"><i class="fas fa-check"></i></button>
                            <button class="action-btn cancel-edit" title="Cancel"><i class="fas fa-times"></i></button>
                            <div class="timestamp ${isUserMessage ? 'user-timestamp' : 'app-timestamp'}">${getCurrentTime()} (editing)</div>
                        `;
                        
                        const saveBtn = messageEl.querySelector('.save-edit');
                        const cancelBtn = messageEl.querySelector('.cancel-edit');
                        const textarea = messageEl.querySelector('.edit-textarea');
                        const highlightBtns = messageEl.querySelectorAll('.highlight-btn');
                        
                        // Add highlight functionality
                        highlightBtns.forEach(btn => {
                            btn.addEventListener('click', function() {
                                const color = this.dataset.color;
                                if (textarea.selectionStart !== textarea.selectionEnd) {
                                    const selected = textarea.value.substring(textarea.selectionStart, textarea.selectionEnd);
                                    const before = textarea.value.substring(0, textarea.selectionStart);
                                    const after = textarea.value.substring(textarea.selectionEnd);
                                    textarea.value = before + `<span class="highlight" style="background-color: ${color}">${selected}</span>` + after;
                                }
                            });
                        });
                        
                        saveBtn.addEventListener('click', function() {
                            const newText = textarea.value;
                            messageEl.innerHTML = `
                                <div class="message-actions">
                                    <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                                    <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                                <p>${newText}</p>
                                <div class="timestamp ${isUserMessage ? 'user-timestamp' : 'app-timestamp'}">${getCurrentTime()} (edited)</div>
                            `;
                            addMessageListeners(messageEl);
                            updateWordCount();
                        });
                        
                        cancelBtn.addEventListener('click', function() {
                            messageEl.innerHTML = `
                                <div class="message-actions">
                                    <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                                    <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                                <p>${messageText}</p>
                                <div class="timestamp ${isUserMessage ? 'user-timestamp' : 'app-timestamp'}">${getCurrentTime()}</div>
                            `;
                            addMessageListeners(messageEl);
                        });
                        
                        textarea.focus();
                    });
                }
                
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', function() {
                        messageEl.remove();
                        messages--;
                        messageCount.textContent = messages;
                        updateWordCount();
                    });
                }
            }
            
            // Strip HTML tags for editing
            function stripHtml(html) {
                const tmp = document.createElement('div');
                tmp.innerHTML = html;
                return tmp.textContent || tmp.innerText || '';
            }
            
            // Update word count
            function updateWordCount() {
                let allText = '';
                document.querySelectorAll('.message p').forEach(p => {
                    allText += ' ' + stripHtml(p.innerHTML);
                });
                words = countWords(allText);
                wordCount.textContent = words;
            }
            
            // Generate more human-like chatbot response
            function generateResponse(userMessage) {
                // Add to conversation history
                conversationHistory.push({ role: 'user', content: userMessage });
                
                // Keep only the last 10 exchanges to maintain context
                if (conversationHistory.length > 20) {
                    conversationHistory = conversationHistory.slice(-20);
                }
                
                // Check for specific patterns and respond accordingly
                const lowerMsg = userMessage.toLowerCase();
                
                // Greeting detection
                if (/(hi|hello|hey|greetings|good morning|good afternoon|good evening)/.test(lowerMsg) && 
                    !/(task|work|question|help)/.test(lowerMsg)) {
                    const greetings = [
                        "Hello there! How's your workflow going today?",
                        "Hi! What are you working on right now?",
                        "Hey! Ready to dive into some focused work?",
                        "Greetings! What's on your mind today?"
                    ];
                    return greetings[Math.floor(Math.random() * greetings.length)];
                }
                
                // Task-related messages
                if (/(task|todo|to-do|need to|must do|have to)/.test(lowerMsg)) {
                    const taskResponses = [
                        "I've noted that task. What's your plan for tackling it?",
                        "That sounds like an important task. How will you approach it?",
                        "Task added to your mental list. What's the first step?",
                        "Good to define your tasks clearly. What's the priority for this?"
                    ];
                    return taskResponses[Math.floor(Math.random() * taskResponses.length)];
                }
                
                // Question detection
                if (/(\?|question|wonder|curious|not sure)/.test(lowerMsg)) {
                    const questionResponses = [
                        "That's an interesting question. Have you considered breaking it down into smaller parts?",
                        "I appreciate your curiosity. What aspects are you most uncertain about?",
                        "Questions are great for clarifying thinking. What led you to this question?",
                        "That's a thoughtful question. How might you approach finding an answer?"
                    ];
                    return questionResponses[Math.floor(Math.random() * questionResponses.length)];
                }
                
                // Problem or challenge
                if (/(problem|issue|challenge|difficult|struggl|stuck|block)/.test(lowerMsg)) {
                    const problemResponses = [
                        "It sounds like you're facing a challenge. What have you tried so far?",
                        "Challenges are opportunities in disguise. How can you break this down?",
                        "I understand this is difficult. What's one small step you could take?",
                        "It's okay to feel stuck sometimes. Would explaining it differently help?"
                    ];
                    return problemResponses[Math.floor(Math.random() * problemResponses.length)];
                }
                
                // Progress or success
                if (/(progress|success|achievement|done|finished|completed|accomplish)/.test(lowerMsg)) {
                    const progressResponses = [
                        "That's great progress! How does it feel to have moved forward?",
                        "Congratulations on your progress! What did you learn in the process?",
                        "Well done! How will you build on this success?",
                        "Excellent work! What's the next milestone you're aiming for?"
                    ];
                    return progressResponses[Math.floor(Math.random() * progressResponses.length)];
                }
                
                // Feeling or emotion
                if (/(feel|frustrated|tired|excited|motivated|overwhelm|anxious|happy)/.test(lowerMsg)) {
                    const feelingResponses = [
                        "I appreciate you sharing how you're feeling. How is that impacting your work?",
                        "Thanks for being open about your state of mind. What might help you right now?",
                        "I hear you. How is this emotional state affecting your focus?",
                        "Your awareness of your feelings is valuable. What do you need to move forward?"
                    ];
                    return feelingResponses[Math.floor(Math.random() * feelingResponses.length)];
                }
                
                // Help request
                if (/(help|support|advice|guidance|assistance)/.test(lowerMsg)) {
                    const helpResponses = [
                        "I'm here to help you think through this. What specifically would be most useful?",
                        "I'd be happy to support your process. What area do you need help with?",
                        "Let's work through this together. What part is most challenging?",
                        "I'm here to assist. Could you tell me more about what you need help with?"
                    ];
                    return helpResponses[Math.floor(Math.random() * helpResponses.length)];
                }
                
                // Default responses for other inputs
                const defaultResponses = [
                    "Thanks for sharing. How would you like to proceed with this?",
                    "I appreciate your update. What are your thoughts on the next steps?",
                    "That's interesting. How does this fit into your larger goals?",
                    "I see. What aspect of this would you like to explore further?",
                    "Noted. How does this connect to what you were working on before?",
                    "Thanks for the update. What's capturing your attention most right now?",
                    "I understand. What would be a productive way to move forward?",
                    "That makes sense. How can I best support your workflow today?"
                ];
                
                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            }
            
            // Send message function
            function sendMessage() {
                const text = userInput.value.trim();
                if (text === '') return;
                
                // Create user message
                const userMessageEl = document.createElement('div');
                userMessageEl.classList.add('message', 'user-message');
                userMessageEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>${text}</p>
                    <div class="timestamp user-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(userMessageEl);
                addMessageListeners(userMessageEl);
                
                // Update stats
                messages++;
                words += countWords(text);
                messageCount.textContent = messages;
                wordCount.textContent = words;
                
                // Clear input
                userInput.value = '';
                
                // Auto-scroll to bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Only generate response if chatbot is enabled
                if (chatbotEnabled) {
                    // Show typing indicator
                    typingIndicator.style.display = 'block';
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // Simulate app response after a short delay
                    setTimeout(() => {
                        typingIndicator.style.display = 'none';
                        
                        const appMessageEl = document.createElement('div');
                        appMessageEl.classList.add('message', 'app-message');
                        
                        // Generate response
                        const response = generateResponse(text);
                        
                        appMessageEl.innerHTML = `
                            <div class="message-actions">
                                <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                                <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                            <p>${response}</p>
                            <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                        `;
                        chatContainer.appendChild(appMessageEl);
                        addMessageListeners(appMessageEl);
                        
                        // Add to conversation history
                        conversationHistory.push({ role: 'assistant', content: response });
                        
                        // Update message count
                        messages++;
                        messageCount.textContent = messages;
                        
                        // Auto-scroll to bottom
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }, 1500 + Math.random() * 1000); // Random delay to simulate typing
                }
            }
            
            // Send message on button click
            sendBtn.addEventListener('click', sendMessage);
            
            // Send message on Enter key
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Theme toggle
            themeBtn.addEventListener('click', function() {
                isDarkMode = !isDarkMode;
                if (isDarkMode) {
                    document.body.style.background = 'linear-gradient(135deg, #2c3e50, #1a1a2e)';
                    themeBtn.innerHTML = '<i class="fas fa-sun"></i><span>Light Mode</span>';
                } else {
                    document.body.style.background = 'linear-gradient(135deg, #6e8efb, #a777e3)';
                    themeBtn.innerHTML = '<i class="fas fa-moon"></i><span>Dark Mode</span>';
                }
            });
            
            // Save session
            saveBtn.addEventListener('click', function() {
                const alertEl = document.createElement('div');
                alertEl.classList.add('message', 'app-message');
                alertEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>Your session has been saved locally!</p>
                    <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(alertEl);
                addMessageListeners(alertEl);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                messages++;
                messageCount.textContent = messages;
            });
            
            // Clear chat
            clearBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the chat? This cannot be undone.')) {
                    while (chatContainer.children.length > 2) { // Keep typing indicator
                        chatContainer.removeChild(chatContainer.lastChild);
                    }
                    // Remove any messages except the first one and typing indicator
                    if (chatContainer.children.length > 1 && 
                        !chatContainer.children[0].classList.contains('typing-indicator')) {
                        chatContainer.removeChild(chatContainer.children[0]);
                    }
                    messages = 1;
                    words = 0;
                    messageCount.textContent = messages;
                    wordCount.textContent = words;
                    conversationHistory = [];
                    
                    const alertEl = document.createElement('div');
                    alertEl.classList.add('message', 'app-message');
                    alertEl.innerHTML = `
                        <div class="message-actions">
                            <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                        <p>Chat cleared. Where would you like to start fresh?</p>
                        <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                    `;
                    chatContainer.insertBefore(alertEl, typingIndicator);
                    addMessageListeners(alertEl);
                    messages++;
                    messageCount.textContent = messages;
                }
            });
            
            // Export chat
            exportBtn.addEventListener('click', function() {
                const alertEl = document.createElement('div');
                alertEl.classList.add('message', 'app-message');
                alertEl.innerHTML = `
                    <div class="message-actions">
                        <button class="action-btn" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="action-btn" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    <p>Export feature would save your chat as a text file in a real application.</p>
                    <div class="timestamp app-timestamp">${getCurrentTime()}</div>
                `;
                chatContainer.appendChild(alertEl);
                addMessageListeners(alertEl);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                messages++;
                messageCount.textContent = messages;
            });
            
            // Helper functions
            function getCurrentTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            function countWords(text) {
                return text.split(/\s+/).filter(word => word.length > 0).length;
            }
            
            // Add listeners to initial message
            addMessageListeners(document.querySelector('.message'));
            
            // Focus input field on load
            userInput.focus();
        });
    </script>
</body>
</html>